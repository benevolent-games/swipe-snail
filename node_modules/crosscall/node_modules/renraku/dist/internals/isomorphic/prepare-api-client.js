import { err } from "../../errors.js";
import { jsonCall } from "./json-call.js";
export const prepareApiClient = ({ fetch }) => (function apiClient({ url, shape, }) {
    const client = {};
    for (const topic of Object.keys(shape)) {
        client[topic] = {};
        // attach method callers
        for (const [key, value] of Object.entries(shape[topic])) {
            if (value === "method") {
                const func = key;
                client[topic][func] = async ({ headers }, ...params) => jsonCall({
                    url,
                    fetch,
                    headers,
                    data: { topic, func, params },
                });
            }
            else
                throw err(400, `unknown shape item "${value}"`);
        }
    }
    return client;
});
//# sourceMappingURL=prepare-api-client.js.map