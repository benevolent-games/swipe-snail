!function(){"use strict";function e(e){for(const t of e)if(!"0123456789abcdef".includes(t))return!1;return!0}var t,i,n,a=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i},o=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class r{constructor(e){t.set(this,void 0),i.set(this,void 0),a(this,t,e,"f"),a(this,i,function(e){let t="";for(const i of new Uint8Array(e))t+=("0"+(255&i).toString(16)).slice(-2);return t}(e),"f")}static fromBinary(e){return new r(e)}static fromString(t){const i=function(t){const i=t.toLowerCase();if(!e(i))throw new Error("decodeHex: invalid hex");const n=[];for(let e=0;e<i.length;e+=2)n.push(parseInt(i.substr(e,2),16));return new Uint8Array(n).buffer}(t);return new r(i)}static isId(t){return 64===t.length&&function(t){return e(t.toLowerCase())}(t)}get binary(){return o(this,t,"f")}get string(){return o(this,i,"f")}toBinary(){return o(this,t,"f")}toString(){return o(this,i,"f")}equals(e){return"string"==typeof e?o(this,i,"f")===e:o(this,i,"f")===e.toString()}}t=new WeakMap,i=new WeakMap,function(e){var t;(t=e.Type||(e.Type={}))[t.Create=0]="Create",t[t.Update=1]="Update",t[t.Delete=2]="Delete"}(n||(n={}));const s="__serialized_type__";function l(...e){return["and",...e]}function c(...e){return["or",...e]}function d(...e){return e.length?{conditions:c(...e.map((e=>({equal:e}))))}:{conditions:!1}}function u(e,t){return{conditions:c(...e.map((e=>({equal:t(e)}))))}}async function p(e,t,i){let n=await e.readOne(t);return n||(n=await i(),await e.create(n)),n}function h(){const e=new Map;return{read:async t=>e.get(t),async write(t,i){e.set(t,i)},async delete(t){e.delete(t)}}}var m;const f="undefined"!=typeof process&&"node"===(null===(m=null===process||void 0===process?void 0:process.release)||void 0===m?void 0:m.name);async function b({isNode:e=f}={}){const t=e?await(async()=>{const e=await import("crypto");return t=>e.randomBytes(t).buffer})():e=>crypto.getRandomValues(new Uint8Array(e)).buffer,i=e?await(async()=>{const e=await import("crypto");return(t,i)=>e.timingSafeEqual(Buffer.from(t,"utf8"),Buffer.from(i,"utf8"))})():(e,t)=>(console.warn("insecure compare"),e===t);function n(){const e=t(8),i=new Int8Array(e);i[7]=63,i[6]|=240;return new DataView(e).getFloat64(0,!0)-1}function a(e){return e[Math.floor(n()*e.length)]}return{random:n,compare:i,randomId:function(){const e=t(32);return new r(e)},randomBuffer:t,randomSample:a,randomSequence:function(e,t){const i=[];for(;i.length<e;){const e=a(t);i.push(e)}return i.join("")}}}function g(e){const t={};for(const[i,n]of Object.entries(e))t[i]=n instanceof r?{[s]:"Id",value:n.toString()}:n;return t}function v(e){const t={};for(const[i,n]of Object.entries(e))if(n&&"object"==typeof n&&n[s]){if("Id"!==n[s])throw new Error(`unknown serialized type "${n[s]}"`);t[i]=r.fromString(n.value)}else t[i]=n;return t}var w,y=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i},x=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class I{constructor(e){w.set(this,void 0),y(this,w,e,"f")}async save(e,t){return x(this,w,"f").write(e,t.map(g))}async load(e){var t;return(null!==(t=await x(this,w,"f").read(e))&&void 0!==t?t:[]).map(v)}}function k(e,t){const i={};for(const[n,a]of Object.entries(e))i[n]=t(a,n);return i}function $(e,t){if(!Object.keys(t).length)return!0;let i=0;const n=(t,n)=>{t&&!function(e,t,i){let n=0;for(const[a,o]of Object.entries(t))i(e[a],o)||(n+=1);return!n}(e,t,n)&&(i+=1)},a=e=>e instanceof r?e.string:e,o=e=>null!=e,s=(e,t)=>a(e)===a(t),l=(e,t)=>e>t,c=(e,t)=>e>=t,d=(e,t)=>e<t,u=(e,t)=>e<=t,p=(e,t)=>e.includes(t),h=(e,t)=>"string"==typeof t?e.includes(t):t.test(e);function m(e){return(t,i)=>!e(t,i)}return n(t.set,o),n(t.equal,s),n(t.greater,l),n(t.greatery,c),n(t.less,d),n(t.lessy,u),n(t.listed,p),n(t.search,h),n(t.notSet,m(o)),n(t.notEqual,m(s)),n(t.notGreater,m(l)),n(t.notGreatery,m(c)),n(t.notLess,m(d)),n(t.notLessy,m(u)),n(t.notListed,m(p)),n(t.notSearch,m(h)),!i}function S(e,t){return function t(i){if(!1===i)return!0;const[n,...a]=i,o=a.filter((e=>!!e));if(0===o.length)throw new Error("empty and/or conditions are not allowed");const r="and"===n;let s=r;const l=e=>s=r?s&&e:s||e;for(const i of o)if(!1===i||Array.isArray(i))l(t(i));else{l($(e,i))}return s}(t.conditions)}function P({rows:e,operation:t}){switch(t.type){case n.Type.Create:return[...e,...t.rows];case n.Type.Update:{let i=[],n=[];for(const a of e)S(a,t.update)?i.push(a):n.push(a);const{write:a,whole:o,upsert:r}=t.update;if(a&&i.length)i=i.map((e=>({...e,...a})));else if(r)i.length?i=i.map((e=>({...e,...r}))):i.push({...r});else{if(!o)throw new Error("invalid update");i=[],i=[o]}return[...i,...n]}case n.Type.Delete:return e.filter((e=>!S(e,t.conditional)));default:throw new Error("invalid operation")}}async function A({shape:e,rowStorage:t,action:i,makeTableName:a}){const o=[],r=function e(i,r){return k(i,((i,s)=>{const l=[...r,s],c=a(l);let d;return"boolean"==typeof i?(u=async function(){d||(d=await t.load(c))},p={async create(...e){const t={type:n.Type.Create,path:l,rows:e};d=P({operation:t,rows:d}),o.push(t)},async read(e){const t=d.filter((t=>S(t,e))),{order:i,offset:n=0,limit:a=1e3}=e;if(i)for(const[e,n]of Object.entries(i))t.sort(((t,i)=>"ascend"===n?t[e]>i[e]?1:-1:t[e]>i[e]?-1:1));return t.slice(n,n+a)},async update(e){const t={type:n.Type.Update,path:l,update:e};d=P({operation:t,rows:d}),o.push(t)},async delete(e){const t={type:n.Type.Delete,path:l,conditional:e};d=P({operation:t,rows:d}),o.push(t)},count:async e=>d.filter((t=>S(t,e))).length,async average({fields:e,...t}){const i=d.filter((e=>S(e,t)));return n=e,a=(e,t)=>{let n=0,a=0;for(const e of i){const i=e[t];"number"!=typeof i||isNaN(i)||(n+=i,a+=1)}return a>0?n/a:0},Object.fromEntries(Object.entries(n).map((([e,t])=>[e,a(t,e)])));var n,a},readOne:async e=>d.find((t=>S(t,e)))},k(p,(e=>async(...t)=>(await u(),e(...t))))):e(i,l);var u,p}))}(e,[]);let s=!1;const l=await i({tables:r,async abort(){s=!0}});if(!s){const e=new Map;for(const{path:i}of o){const n=a(i),o=await t.load(n);e.set(n,o)}for(const t of o){const i=a(t.path),n=P({operation:t,rows:e.get(i)});e.set(i,n)}for(const[i,n]of e.entries())await t.save(i,n)}return l}function O(e){return e.join("_")}function M({shape:e,flexStorage:t,makeTableName:i=O}){const n=new I(t),a=function(e){let t=Promise.resolve();return async(...i)=>{const n=t.then((()=>e(...i)));return t=n.catch((()=>{})),n}}(A);return{tables:function t(o,r){return k(o,((o,s)=>{const l=[...r,s];function c(t){return async(...o)=>a({shape:e,rowStorage:n,action:async({tables:e})=>function(e,t){return t.reduce(((e,t)=>e&&e[t]||void 0),e)}(e,l)[t](...o),makeTableName:i})}return"boolean"==typeof o?{create:c("create"),read:c("read"),update:c("update"),delete:c("delete"),count:c("count"),average:c("average"),readOne:c("readOne")}:t(o,l)}))}(e,[]),transaction:async t=>a({shape:e,rowStorage:n,action:t,makeTableName:i})}}function C({table:e,fallbackRows:t}){const{tables:{fallbackTable:i}}=function({shape:e,makeTableName:t}){return M({shape:e,flexStorage:h(),makeTableName:t})}({shape:{fallbackTable:!0}});let n=!1;async function a(){n||(n=!0,await i.create(...t))}return{create:e.create,delete:e.delete,update:e.update,async read(t){await a();const[n,o]=await Promise.all([i.read(t),e.read(t)]);return[...n,...o]},async readOne(t){var n;return await a(),null!==(n=await e.readOne(t))&&void 0!==n?n:await i.readOne(t)},async count(t){await a();const[n,o]=await Promise.all([i.count(t),e.count(t)]);return n+o}}}function E(e){return"function"==typeof e.create}function _(e,t){return{tables:t(e.tables),transaction:async i=>e.transaction((async({tables:e,abort:n})=>i({tables:t(e),abort:n})))}}function R({table:e,constraint:t}){const i=e=>e?l({equal:t},e):l({equal:t});return{create:async(...i)=>e.create(...i.map((e=>({...e,...t})))),read:async t=>e.read({...t,conditions:i(t.conditions)}),readOne:async t=>e.readOne({...t,conditions:i(t.conditions)}),async update(n){const a=n;return e.update({...n,conditions:i(n.conditions),upsert:a.upsert?{...a.upsert,...t}:void 0,whole:a.whole?{...a.whole,...t}:void 0,write:a.write?{...a.write,...t}:void 0})},delete:async t=>e.delete({...t,conditions:i(t.conditions)}),count:async t=>e.count({...t,conditions:i(t.conditions)})}}function T({tables:e,constraint:t}){return function e(i){return k(i,(i=>E(i)?R({constraint:t,table:i}):e(i)))}(e)}w=new WeakMap;function D({connection:e,frontend:t}){const{loginService:i}=e.remote.auth.users;i.sendLoginLink=function(e,t){return(...i)=>t(e,...i)}(i.sendLoginLink,(async(i,...n)=>{await i(...n);const a=e.backend.emails.recallLatestLoginEmail();console.log("mock: logging in..."),await((e=0)=>new Promise((t=>setTimeout(t,e))))(1e3),await t.models.accessModel.login(a.loginToken),console.log(`mock: logged in as ${a.to}`)}));const n=e.backend.prepareNotesDepositBox(r.fromString(t.appId));window.fakeNote=async i=>{var a,o;const r=null===(o=null===(a=t.models.accessModel.getAccess())||void 0===a?void 0:a.user)||void 0===o?void 0:o.userId,s={from:void 0,details:{},text:"this is a message note "+e.backend.rando.randomId().toString().slice(0,8),title:"this is a message title "+e.backend.rando.randomId().toString().slice(0,8),type:"message",to:r,...i};if(s.to){const{noteId:e}=await n.sendNote(s);console.log(`note sent! ${e}`)}else console.warn("who do you want to send this note to?\n('to' user id was not provided)")}}class q extends Error{constructor(){super(...arguments),this.name=this.constructor.name}}class L extends q{constructor(e,t){super(t),this.code=e}}const j=Symbol("is_service"),U=(e={})=>({forService:t=>N(t,[],e),forApi:t=>({withMetaMap(i,n=(async()=>{})){const a=z(((t,i,a)=>N(t,a,e).withMeta(i,n)));return a(t,i)},withAuthMap(i){const n=z(((t,i,n)=>N(t,n,e).withAuth(i)));return n(t,i)}})});function N(e,t,i){function n(n){const a={};return new Proxy({},{set:(e,t,i)=>(a[t]=i,!0),get:(o,r)=>{var s;return null!==(s=a[r])&&void 0!==s?s:async(...a)=>{const o=await n(),s=e.expose(o)[r];if(s)return i.spike?i.spike([...t,r].join("."),s,...a):s(...a);throw new L(400,`renraku remote method "${r}" not found`)}}})}return{withMeta:(t,i=(async()=>{}))=>n((async()=>e.policy(await t(),await i()))),withAuth:e=>n(e)}}function z(e){return function t(i,n,a=[]){return function(e,t){const i={};for(const[n,a]of Object.entries(e))i[n]=t(a,n);return i}(i,((i,o)=>{const r=[...a,o];if(i[j]){return e(i,n[o],r)}{const e=i,a=n[o];return t(e,a,r)}}))}}const B=()=>({policy:e=>({expose:t=>({[j]:j,expose:t,policy:e})})});function V(){let e=[];return{publish:async(...t)=>{const i=e.map((e=>e(...t)));await Promise.all(i)},subscribe:t=>(e.push(t),()=>{e=e.filter((e=>e!==t))}),dispose:()=>{e=[]}}}const W="function"==typeof atob;const H=Object.freeze({encode:e=>{const t=function(e){return W?btoa(e):Buffer.from(e).toString("base64")}(e);return function(e){return e+Array((4-e.length%4)%4+1).join("=")}(t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))},decode:e=>function(e){return W?atob(e):Buffer.from(e,"base64").toString("binary")}(e.replace(/-/g,"+").replace(/_/g,"/"))});const F=function(e){const[t,i]=e.split(".");return{header:Q(t),data:Q(i)}};function Q(e){return JSON.parse(decodeURIComponent(H.decode(e).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}function X(e){return!!e&&!function({exp:e,iat:t}){const i=1e3*e,n=1e3*(e-t)/10,a=n>6e4?6e4:n;return Date.now()>i-a}(F(e).data)}const K=e=>F(e).data.payload;function Y({appId:e,storage:t}){let i;async function n(){return{accessToken:await i.getValidAccessToken()}}return{metaMap:{auth:{apps:{appService:n,appEditService:n},permissions:{permissionsService:n},users:{greenService:async()=>{},loginService:n,personalService:n,userService:n}},example:{exampleService:n},administrative:{roleAssignmentService:n},questions:{questionsModerationService:n,questionsPostingService:n,questionsReadingService:n,questionsAnsweringService:n},videos:{dacastService:n,contentService:n},notes:{notesService:n},store:{billing:n,connect:n,subscriptions:{listing:n,planning:n,shopping:n}}},installAuthMediator:function({greenService:n}){return i=function({appId:e,storage:t,greenService:i}){const n=V(),a=V(),o=`auth-tokens-${e}`,r=async()=>{var e;return null!==(e=await t.read(o))&&void 0!==e?e:{accessToken:void 0,refreshToken:void 0}},s=async e=>t.write(o,e);async function l(e){const t=K(e.accessToken);return await s(e),await n.publish(),await a.publish(t),t}async function c(t){const n=await i.authorize({appId:e,refreshToken:t,scope:{core:!0}});return{access:await l({accessToken:n,refreshToken:t}),accessToken:n}}const d=async()=>{const{accessToken:e,refreshToken:t}=await r();return X(e)?{accessToken:e,access:K(e)}:X(t)?c(t):c(void 0)};return{subscribeToAccessChange:a.subscribe,subscribeToTokenChange:n.subscribe,async initialize(){const{access:e}=await d();return await a.publish(e),e},getValidAccess:async()=>(await d()).access,getValidAccessToken:async()=>(await d()).accessToken,login:async e=>l(e),logout:async()=>(await s({accessToken:void 0,refreshToken:void 0}),(await d()).access),async reauthorize(){const e=await r();return await s({...e,accessToken:void 0}),(await d()).access}}}({appId:e,storage:t,greenService:n}),i}}}async function G(e){const t=Date.now(),i=await e;return[Date.now()-t,i]}function J({api:e,appId:t,storage:i,headers:n,logging:a}){const{metaMap:o,installAuthMediator:r}=Y({appId:t,storage:i});let s;const l=U({spike:async(e,t,...i)=>{const[n]=await G(async function(e){if(e){const{min:t,max:i}=e;if(t>i)throw new Error("invalid mock latency (min cannot exceed max)");const n=i-t,a=t+Math.random()*n;return new Promise((e=>setTimeout(e,a)))}}(s)),[o,r]=await G(t(...i));return a&&console.log(`ðŸ“¡ ${e}() ${o}ms + mock ${n}ms`),r}}).forApi(e).withMetaMap(o,(async()=>n));return{remote:l,authMediator:r({greenService:l.auth.users.greenService}),setMockLatency:function(e){s=e}}}async function Z({appId:e,appOrigin:t,storage:i,backend:n}){const{remote:a,authMediator:o,setMockLatency:r}=J({appId:e,storage:i,logging:!0,api:n.api,headers:{origin:t}});return function({appId:e,authMediator:t}){const i=new BroadcastChannel("tokenChangeEvent");t.subscribeToTokenChange((()=>i.postMessage({appId:e}))),i.onmessage=i=>{i.data.appId===e&&t.initialize()}}({appId:e,authMediator:o}),{remote:a,authMediator:o,setMockLatency:r}}!function(e){var t=[];function i(i){var n=this,a="$BroadcastChannel$"+(i=String(i))+"$";t[a]=t[a]||[],t[a].push(this),this._name=i,this._id=a,this._closed=!1,this._mc=new MessageChannel,this._mc.port1.start(),this._mc.port2.start(),e.addEventListener("storage",(function(t){if(t.storageArea===e.localStorage&&null!=t.newValue&&""!==t.newValue&&t.key.substring(0,a.length)===a){var i=JSON.parse(t.newValue);n._mc.port2.postMessage(i)}}))}i.prototype={get name(){return this._name},postMessage:function(i){var n=this;if(this._closed){var a=new Error;throw a.name="InvalidStateError",a}var o=JSON.stringify(i),r=this._id+String(Date.now())+"$"+String(Math.random());e.localStorage.setItem(r,o),setTimeout((function(){e.localStorage.removeItem(r)}),500),t[this._id].forEach((function(e){e!==n&&e._mc.port2.postMessage(JSON.parse(o))}))},close:function(){if(!this._closed){this._closed=!0,this._mc.port1.close(),this._mc.port2.close();var e=t[this._id].indexOf(this);t[this._id].splice(e,1)}},get onmessage(){return this._mc.port1.onmessage},set onmessage(e){this._mc.port1.onmessage=e},addEventListener:function(){return this._mc.port1.addEventListener.apply(this._mc.port1,arguments)},removeEventListener:function(){return this._mc.port1.removeEventListener.apply(this._mc.port1,arguments)},dispatchEvent:function(){return this._mc.port1.dispatchEvent.apply(this._mc.port1,arguments)}},e.BroadcastChannel=e.BroadcastChannel||i}(self);const ee=6e4,te=36e5,ie=24*te;function ne(){const e=new Map;return{subscribe(...t){if(t.length){const i=Symbol();return e.set(i,t),()=>{e.delete(i)}}},async publish(...t){await Promise.all(Array.from(e.values()).flat().map((e=>e(...t))))},clear(){e.clear()}}}function ae(e){let t;return async function(...i){if(t)return t;{t=e(...i);const n=await t;return t=void 0,n}}}var oe;!function(e){var t;(t=e.Mode||(e.Mode={}))[t.None=0]="None",t[t.Loading=1]="Loading",t[t.Error=2]="Error",t[t.Ready=3]="Ready"}(oe||(oe={}));const re={none:()=>({mode:oe.Mode.None}),loading:()=>({mode:oe.Mode.Loading}),error:e=>({mode:oe.Mode.Error,reason:e}),ready:e=>({mode:oe.Mode.Ready,value:e}),replaceValue:(e,t)=>e.mode===oe.Mode.Ready?{...e,value:t}:e,isNone:e=>e.mode===oe.Mode.None,isLoading:e=>e.mode===oe.Mode.Loading,isError:e=>e.mode===oe.Mode.Error,isReady:e=>e.mode===oe.Mode.Ready,value:e=>e.mode===oe.Mode.Ready?e.value:void 0,select(e,t){switch(e.mode){case oe.Mode.None:return t.none();case oe.Mode.Loading:return t.loading();case oe.Mode.Error:return t.error(e.reason);case oe.Mode.Ready:return t.ready(e.value)}},async operation({promise:e,errorReason:t="an error occurred",setOp:i}){await i(re.loading());try{const t=await e;return await i(re.ready(t)),t}catch(e){throw await i(re.error(t)),e}},mode:e=>re.select(e,{none:()=>"none",loading:()=>"loading",error:()=>"error",ready:()=>"ready"}),combine(...e){const t=!!e.find((e=>e.mode===oe.Mode.Error)),i=!!e.find((e=>e.mode===oe.Mode.Loading)),n=!!e.find((e=>e.mode!==oe.Mode.Ready));return t?{mode:oe.Mode.Error,reason:"error"}:i?{mode:oe.Mode.Loading}:n?{mode:oe.Mode.None}:{mode:oe.Mode.Ready,value:void 0}},debug:e=>re.select(e,{none:()=>["<op {mode: None}>"],loading:()=>["<op {mode: Loading}>"],error:e=>[`<op {mode: Error, reason: "${e}"}>`],ready:e=>["<op {mode: Ready, value: ",e,"}>"]})};function se(e){return null==e}function le(e,t){let i=e;for(const e of t)if(i=i[e],se(i))break;return i}function ce(e,t){const i={};for(const[n,a]of Object.entries(e))i[n]=t(a,n);return i}function de(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}const ue=Symbol("symbolToAllowProxyIntoState");function pe(e,t=ue){return de(e)&&!e[t]?ce(e,(e=>pe(e,t))):e}function he(e,t){let i,n,a=[];function o(){i=void 0,n&&clearTimeout(n),n=void 0,a=[]}return o(),(...r)=>{i=r,n&&clearTimeout(n);const s=new Promise(((e,t)=>{a.push({resolve:e,reject:t})}));return n=setTimeout((()=>{Promise.resolve().then((()=>t(...i))).then((e=>{for(const{resolve:t}of a)t(e);o()})).catch((e=>{for(const{reject:t}of a)t(e);o()}))}),e),s}}class me extends Error{constructor(){super(...arguments),this.name=this.constructor.name}}class fe extends me{}class be extends me{}function ge(e,t){for(const i of e){let e=!1;if(t.length===i.length){for(let n=0;n<t.length;n++)if(t[n]!==i[n]){e=!0;break}if(!e)return!0}}return!1}function ve(e,t){for(const i of e){let e=!1;if(t.length<=i.length){for(let n=0;n<t.length;n++)if(t[n]!==i[n]){e=!0;break}if(!e)return!0}}return!1}function we(e,t){for(const i of e){let e=!1;if(t.length>=i.length){for(let n=0;n<i.length;n++)if(i[n]!==t[n]){e=!0;break}if(!e)return!0}}return!1}function ye(e){const t=pe(e,ue);let i,n=!1;const a=new Map,o=new Set;function r(e){const t=[];for(const[,i]of a)i.flip?we(i.paths,e)&&t.push(i):ve(i.paths,e)&&t.push(i);return t}const s=p(t,!0,[]),l=p(t,!1,[]);let c=[];const d=he(1,(()=>{for(const e of c){n=!0;try{for(const e of o)e(l);for(const{observer:t,reaction:i}of r(e))i?i(t(l)):t(l)}finally{n=!1}}c=[]}));let u=Promise.resolve();function p(e,a,o){return new Proxy(e,{get(e,n){var r;const s=[...o,n];i&&(ge(i.paths,s)||i.paths.push(s));const l=null!==(r=le(t,s))&&void 0!==r?r:le(e,[n]);return de(l)?p(l,a,s):l},set(e,r,s){const l=[...o,r];if(a){if(i||n)throw new be("forbidden state circularity");return s!==le(t,l)&&(function(e,t,i){const n=[...t],a=n.pop();let o=e;for(const e of n){if("object"!=typeof o[e])throw new Error("unable to write property to object tree containing undefined");o=o[e]}o[a]=i}(t,l,pe(s,ue)),function(e){ge(c,e)||c.push(e),u=d()}(l)),!0}throw new fe(`state is read-only here, cannot set ${l.join(".")}`)}})}const h=new Set,m=new Set;return{state:s,writable:s,readable:l,readonly:l,subscribe(e){o.add(e);const t=()=>o.delete(e);return m.add(t),t},track(e,t,{flip:n=!1}={}){const o=Symbol();i={paths:[],flip:n,observer:e,reaction:t},a.set(o,i),e(l),i=void 0;const r=()=>a.delete(o);return h.add(r),r},unsubscribeAll(){for(const e of m)e();m.clear()},untrackAll(){for(const e of h)e();h.clear()},async wait(){await u}}}const xe={"view all chats":"985dc13378d1129e4dd6303fe9e52dff97d53568ce10814805f481159c788710","participate in all chats":"bd0c8dfdf3eef893a5d9f8b5d0a6cad19ad80e949ebd70428f0d7525099cdd10"},Ie={"moderate all chats":"693d969777a3998de6f9a4a5583917f4e672bb96ed08c571fc7486593ca98993"},ke={...xe,...Ie};function $e(e,t){const i={};for(const n of Object.keys(e))i[n]=t;return i}function Se(e,t){return $e(t,{active:e,immutable:!0})}const Pe={"control stripe account":"f236bd2175fbecf7925483884b8c2a2ffe0dd2f0a864cbd638046f6fc58944b5","manage store":"bea0ef0db58a0d8c9ab96bb9b14f889a19893064361b0877626b510b798c6fb8","give away freebies":"c2712efd490c67b44946bc6e1bbe82aee5b8ede384cff614ba7435d429993ec6"},Ae={...Pe},Oe={"view all videos":"22f380eb0c5c7463b8a16fcdfc2f5e58257d38f94972924e70d27a08fabb5506","moderate videos":"1b19013344a59cb49bfd9bddc8dd817a9e4cfa29003437021df24bdc832ec246"},Me={...Oe},Ce={"read questions":"5b19b929648cbbe26c052a5016892b370f048eead1e6a303a50b7f5234ec5161","post questions":"aeaae6139d05f77193ca7c272a65977c70cb188f3070359866237a5ade84ba15","like questions":"5490898c541d733956b28664e7536673842e73b289fc45ab9caf143138c14a3e","report questions":"f2f89d433f398b267e320e0e3b9929eb3934af5c02f7e3fb2e032fd19399ad21",...xe},Ee={"edit any profile":"4240ca0331e8679a444c6c4c6a803d8a12893f1554460af426064b980164c8ee","customize permissions":"f380d9b4d1001da8dc86a6e0b6a0721b92ed8060c52cd4ba433e76cbd9efe6b5","answer questions":"afaa00f7bc9ab09d3bbc61a26f6d9bc666cd9bb7ac270ebbdeba3cf4dd3ab9a9","moderate questions":"f6a3152a13f313a60f84d82ba8f7765afb19f70c04ef14688d802237a5d2ab5e","view stats":"092866ae6378833e43ec7001188aa1829d4cf2858e42da0ad3f44a2fedbcb07b","administrate user roles":"a072e9dd003a762e7d693658d8ac724be352b18da240843f691595c89020e350",...Oe,...Pe,...Ie},_e={"edit any app":"e5fadb4b03badd6699b355ec43e1d150d6f4df81ecc291b5b742f06ebe62a0f8","view platform stats":"eec7d2ddc20df6080c4166a3dea0b2643b483ce61326cbefad95e45824810692"},Re={},Te=!0,De=!1,qe={privileges:{...Ce,...Ee,universal:"c1cb5ac1000af6081ff47e80804de7542b57a1425c3faac8153e708aaf79271a",banned:"ffff9ebcbe8f69f3520ec574f5a1489a70bf04521d7a85fcbd25c54cc22802f1"},roles:{everybody:{roleId:"aaaa777dc7d7e9b5e9e0386abf0cf2f059cda4f71779cc910b85e8f504452b23",public:!0,assignable:!1,hasPrivileges:{...Se(De,Ce),...Se(De,Ee),universal:{active:!0,immutable:!0},banned:{active:!1,immutable:!0},"read questions":{active:!0,immutable:!1},"view all chats":{active:!0,immutable:!1}}},authenticated:{roleId:"bbbb642d549d06113953a01fb52a8e010150edc502b929395bfb32d250d44b1c",public:!1,assignable:!1,hasPrivileges:{...function(e,t){return $e(t,{active:e,immutable:!1})}(Te,Ce),...Se(De,Ee),universal:{active:!1,immutable:!0},banned:{active:!1,immutable:!0}}},banned:{roleId:"dead633608412f8eefbb40f4678ef2bafaeb7883d09a6094dafe5f69dd6a8684",public:!0,assignable:!0,hasPrivileges:{...Se(De,Ce),...Se(De,Ee),universal:{active:!1,immutable:!0},banned:{active:!0,immutable:!0}}},technician:{roleId:"9999d97119a83ea3853273a93e24ae0a1f2a994eccb21dacacab6ff860d8d869",public:!0,assignable:!1,hasPrivileges:{...Se(Te,Ce),...Se(Te,Ee),universal:{active:!1,immutable:!0},banned:{active:!1,immutable:!0}}}}},Le={privileges:{...qe.privileges,..._e},roles:{...qe.roles,everybody:{...qe.roles.everybody,hasPrivileges:{...qe.roles.everybody.hasPrivileges,...Se(De,_e)}},authenticated:{...qe.roles.authenticated,hasPrivileges:{...qe.roles.authenticated.hasPrivileges,...Se(De,_e)}},banned:{...qe.roles.banned,hasPrivileges:{...qe.roles.banned.hasPrivileges,...Se(De,_e)}},technician:{...qe.roles.technician,hasPrivileges:{...qe.roles.technician.hasPrivileges,...Se(Te,Ce),...Se(Te,_e)}}}},je={privileges:{...qe.privileges,...Re},roles:{...qe.roles,everybody:{...qe.roles.everybody,hasPrivileges:{...qe.roles.everybody.hasPrivileges,...Se(De,Re)}},authenticated:{...qe.roles.authenticated,hasPrivileges:{...qe.roles.authenticated.hasPrivileges,...Se(De,Re)}},banned:{...qe.roles.banned,hasPrivileges:{...qe.roles.banned.hasPrivileges,...Se(De,Re)}},admin:{roleId:"d21e66058b95b3b2e80c1a00c82abd56b8ec7a4b20f0424c2a00cc6ba352efeb",public:!0,assignable:!1,hasPrivileges:{...Se(Te,Re),...Se(Te,Ce),...Se(Te,Ee),universal:{active:!1,immutable:!0},banned:{active:!1,immutable:!0}}},technician:{...qe.roles.technician,hasPrivileges:{...qe.roles.technician.hasPrivileges,...Se(Te,Re)}}}};function Ue(e){return{moderateAllChats:e.includes(ke["moderate all chats"]),participateInAllChats:e.includes(ke["moderate all chats"])||e.includes(ke["participate in all chats"]),viewAllChats:e.includes(ke["moderate all chats"])||e.includes(ke["participate in all chats"])||e.includes(ke["view all chats"]),banned:e.includes(je.privileges.banned)}}const Ne={posts:!0,mutes:!0,roomStatuses:!0,roomUsers:!0};var ze;function Be({state:e,reconnect:t,disconnect:i}){async function n(){return re.isReady(e.readable.connectionOp)?re.value(e.readable.connectionOp):t()}const a=new Map,o=new Map;function r(t){let i=o.get(t);return i||(i=n().then((e=>e.serverside.chatServer.roomSubscribe(t).then((()=>e)))).then((i=>function({label:e,serverside:t,state:i}){const n=()=>i.readable.cache.rooms[e],a=()=>re.value(i.readable.accessOp);return{get posts(){var e,t;return null!==(t=null===(e=n())||void 0===e?void 0:e.posts)&&void 0!==t?t:[]},get status(){var e,t;return null!==(t=null===(e=n())||void 0===e?void 0:e.status)&&void 0!==t?t:ze.Offline},get muted(){return i.readable.cache.mutedUserIds},get weAreMuted(){const{user:{userId:e}}=a();return i.readable.cache.mutedUserIds.includes(e)},get weAreBanned(){const{permit:{privileges:e}}=a();return e.includes(je.privileges.banned)},setRoomStatus(i){t.chatServer.setRoomStatus(e,i)},post(i){t.chatServer.post(e,i)},remove(i){t.chatServer.remove(e,i)},clear(){t.chatServer.clear(e)},mute(e){t.chatServer.mute([e])},unmute(e){t.chatServer.unmute([e])},unmuteAll(){t.chatServer.unmuteAll()}}}({label:t,state:e,serverside:i.serverside}))),o.set(t,i)),i}return{getRoomSession:async function(e){const t=function(e){let t=a.get(e);return t||(t=new Set,a.set(e,t)),t}(e),s=Symbol();return t.add(s),{dispose:function(){t.delete(s),0===t.size&&function(e){const t=o.get(e);n().then((i=>t.then((t=>{i.serverside.chatServer.roomUnsubscribe(e)})))).then((()=>{if(o.delete(e),0===o.size)return i()}))}(e)},room:await r(e)}},updateAuthSituation:async function(e){e?o.size>0&&await n():0===o.size&&await i()}}}!function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online"}(ze||(ze={}));function Ve({chatConnect:e,getChatMeta:t}){const i=ne(),n=ye({accessOp:re.none(),connectionOp:re.none(),cache:{mutedUserIds:[],roomStats:{},rooms:{}}}),a=(({state:e,onChange:t})=>({chatClient:B().policy((async()=>{})).expose((()=>{async function i(){await e.wait(),t()}return{async roomStatusChanged(t,n){e.writable.cache={...e.writable.cache,rooms:{...e.writable.cache.rooms,[t]:{...e.writable.cache.rooms[t],status:n}}},await i()},async postsAdded(t,n){var a,o;e.writable.cache={...e.writable.cache,rooms:{...e.writable.cache.rooms,[t]:{...e.writable.cache.rooms[t],posts:[...null!==(o=null===(a=e.writable.cache.rooms[t])||void 0===a?void 0:a.posts)&&void 0!==o?o:[],...n].slice(0,50)}}},await i()},async postsRemoved(t,n){var a,o;e.writable.cache={...e.writable.cache,rooms:{...e.writable.cache.rooms,[t]:{...e.writable.cache.rooms[t],posts:(null!==(o=null===(a=e.writable.cache.rooms[t])||void 0===a?void 0:a.posts)&&void 0!==o?o:[]).filter((e=>!n.includes(e.postId)))}}},await i()},async roomCleared(t){e.writable.cache={...e.writable.cache,rooms:{...e.writable.cache.rooms,[t]:{...e.writable.cache.rooms[t],posts:[]}}},await i()},async usersMuted(t){e.writable.cache={...e.writable.cache,mutedUserIds:[...e.writable.cache.mutedUserIds,...t]},await i()},async usersUnmuted(t){e.writable.cache={...e.writable.cache,mutedUserIds:e.writable.cache.mutedUserIds.filter((e=>!t.includes(e)))},await i()},async unmuteAll(){e.writable.cache={...e.writable.cache,mutedUserIds:[]},await i()}}}))}))({state:n,onChange:i.publish}),o=function({state:e,intervalDuration:t}){let i;function n(){clearInterval(i),i=void 0}return{startInterval(a){n(),i=setInterval((async()=>{const t=await a.serverside.chatServer.getStats();e.writable.cache.roomStats=t}),t)},stopInterval:n}}({state:n,intervalDuration:2e3}),r=ae((async function(){var i;const r=null!==(i=re.value(n.readable.connectionOp))&&void 0!==i?i:await re.operation({setOp:e=>n.writable.connectionOp=e,promise:e({clientsideApi:a,handleDisconnect:()=>n.writable.connectionOp=re.none()})}),s=await t();return await r.serverside.chatServer.updateUserMeta(s),o.startInterval(r),r}));async function s(){o.stopInterval();const e=re.value(n.readable.connectionOp);e&&(e.disconnect(),n.writable.connectionOp=re.none())}const l=Be({state:n,reconnect:r,disconnect:s});return{state:n.readable,subscribe:n.subscribe,subscribeToChange:i.subscribe,get allowance(){var e;const t=re.value(n.readable.accessOp);return Ue(null!==(e=null==t?void 0:t.permit.privileges)&&void 0!==e?e:[])},async updateAccessOp(e){n.writable.accessOp=e;const i=re.value(e);await l.updateAuthSituation(!!i);const a=re.value(n.readable.connectionOp);if(a){const e=await t();await a.serverside.chatServer.updateUserMeta(e)}},session:l.getRoomSession,disconnect:s,reconnect:r}}function We(){const e=new Map;return{subscribe(t){const i=Symbol();return e.set(i,t),()=>{e.delete(i)}},publish:t=>{for(const[,i]of e)i(t)},clear(){e.clear()}}}function He({notesService:e}){const t=ye({accessOp:re.none(),statsOp:re.none()}),i=We(),n=We();function a(){var e;return!!(null===(e=re.value(t.readable.accessOp))||void 0===e?void 0:e.user)}function o(){var e;return null!==(e=re.value(t.readable.statsOp))&&void 0!==e?e:{newCount:0,oldCount:0}}const r=ae((async function(){return re.operation({promise:e.getNotesStats(),setOp:e=>t.writable.statsOp=e})}));let s=!1;return{initialize:async function(){if(!s&&(s=!0,a()))return r()},state:t.readable,stateSubscribe:t.subscribe,async updateAccessOp(e){t.writable.accessOp=e,a()&&await async function(){if(s)return r()}(),i.publish(re.value(e))},get isLoggedIn(){return a()},get stats(){return o()},propagateChangeToOtherTabs:n,loadStats:r,overwriteStatsOp(e){t.writable.statsOp=e},createNotesCacheDetails:(()=>{const t=function({propagateChangeToOtherTabs:e,notesService:t,getStats:i,loadStats:n,getIsLoggedIn:a}){async function o(e){return t.getNewNotes(e)}async function r(e){return t.getOldNotes(e)}async function s(i,a){await t.markNotesNewOrOld({old:i,noteIds:a}),await n(),e.publish(void 0)}return function(){const l=ye({old:!1,pageNumber:1,pageSize:10,notesOp:re.none()});function c(){l.writable.pageNumber=1,l.writable.pageSize=10}async function d(){if(!a())return l.writable.notesOp=re.ready([]),[];const{old:e,pageNumber:t,pageSize:i}=l.readable,n={offset:(t-1)*i,limit:i};await re.operation({setOp:e=>l.writable.notesOp=e,promise:e?r(n):o(n)})}function u(){const{old:e,pageSize:t}=l.readable,{oldCount:n,newCount:a}=i(),o=e?n:a;return Math.ceil(o/t)}const p=()=>l.writable.pageNumber<u(),h=()=>l.writable.pageNumber>1;return{subscribe:l.subscribe,cacheState:l.readable,async loginStatusChanged(){c(),await d()},get notes(){return re.value(l.readable.notesOp)},fetchAppropriateNotes:d,async switchTabNew(){l.writable.old=!1,c(),await d()},async switchTabOld(){l.writable.old=!0,c(),await d()},get isNextPageAvailable(){return p()},get isPreviousPageAvailable(){return h()},async nextPage(){if(!p())throw new Error("no next page");l.writable.pageNumber+=1,await d()},async previousPage(){if(!h())throw new Error("no previous page");l.writable.pageNumber-=1,await d()},async markAllNotesOld(){await t.markAllNotesOld(),await n(),e.publish(void 0),await d()},async markSpecificNoteOld(e){await s(!0,[e]),l.readable.pageNumber>u()&&l.readable.pageNumber>1&&(l.writable.pageNumber-=1),await d()},async markSpecificNoteNew(e){await s(!1,[e]),l.readable.pageNumber>u()&&l.readable.pageNumber>1&&(l.writable.pageNumber-=1),await d()},get totalPages(){return u()}}}}({notesService:e,propagateChangeToOtherTabs:n,getStats:o,loadStats:r,getIsLoggedIn:a});return()=>{const e=t();return{cache:e,setup:()=>i.subscribe((()=>e.loginStatusChanged()))}}})()}}function Fe({dacastService:e}){const t=We(),i=ye({accessOp:re.none(),linkedAccountOp:re.none()});let n=!1;async function a(){n&&(()=>{const e=re.value(i.readable.accessOp);return e&&e.permit.privileges.includes(Me["moderate videos"])})()&&await async function(){return re.operation({promise:e.getLink(),setOp:e=>i.writable.linkedAccountOp=e})}()}return{state:i.readable,subscribe:i.subscribe,onLinkChange:t.subscribe,async updateAccessOp(e){i.writable.accessOp=e,i.writable.linkedAccountOp=re.none(),await a()},async initialize(){n||(n=!0,await a())},get linkedAccount(){return re.value(i.readable.linkedAccountOp)},linkAccount:async({apiKey:n})=>re.operation({setOp:e=>i.writable.linkedAccountOp=e,promise:e.setLink({apiKey:n}).then((e=>(t.publish(e),e)))}),unlinkAccount:async()=>re.operation({setOp:e=>i.writable.linkedAccountOp=e,promise:e.clearLink().then((()=>t.publish(void 0)))})}}function Qe(e){const t=Fe(e),i=function({contentService:e}){const t=ye({accessOp:re.none(),catalogOp:re.none(),viewsOp:re.none(),privilegesOp:re.none(),showsOp:re.none()}),i=new Set,n=new Set;function a(){return re.value(t.readable.accessOp)}let o=!1;async function r(){o=!0;const i=a();i&&i.permit.privileges.includes(Me["moderate videos"])&&await re.operation({promise:e.fetchModerationData(),setOp:e=>{var i,n,a;const o=re.value(e);t.writable.catalogOp=re.replaceValue(e,null!==(i=null==o?void 0:o.catalog)&&void 0!==i?i:[]),t.writable.viewsOp=re.replaceValue(e,null!==(n=null==o?void 0:o.views)&&void 0!==n?n:[]),t.writable.privilegesOp=re.replaceValue(e,null!==(a=null==o?void 0:o.privileges)&&void 0!==a?a:[])}})}async function s(r){var s;if(o=!0,i.add(r),!a()||n.has(r))return;n.add(r);const l=null!==(s=re.value(t.readable.showsOp))&&void 0!==s?s:[];let c;return await re.operation({setOp:e=>t.writable.showsOp=e,promise:e.getShows({labels:[r]}).then((e=>e[0])).then((e=>c=e)).then((e=>[...l.filter((e=>e.label!==r)),...e?[e]:[{label:r,details:void 0}]]))}),n.delete(r),c}async function l(){if(o=!0,!a())return;const r=Array.from(i).filter((e=>!n.has(e)));if(r.length){for(const e of r)n.add(e);await re.operation({setOp:e=>t.writable.showsOp=e,promise:e.getShows({labels:r}).then((e=>e.filter((e=>!!e))))});for(const e of r)n.delete(e)}}return{state:t.readable,subscribe:t.subscribe,async updateAccessOp(e){t.writable.accessOp=e,t.writable.catalogOp=re.none(),t.writable.viewsOp=re.none(),o&&(await r(),await l())},async onVideoHostingUpdate(){o&&(await r(),await l())},async initializeForModerationData(){o||await r()},async initializeForVideo(e){o||await r(),await s(e)},get allowance(){const e=re.value(t.readable.accessOp),i=t=>!!e&&e.permit.privileges.includes(Me[t]);return{canModerateVideos:i("moderate videos"),canViewAllVideos:i("moderate videos")||i("view all videos")}},get catalog(){var e;return null!==(e=re.value(t.readable.catalogOp))&&void 0!==e?e:[]},get views(){var e;return null!==(e=re.value(t.readable.viewsOp))&&void 0!==e?e:[]},get privileges(){var e;return null!==(e=re.value(t.readable.privilegesOp))&&void 0!==e?e:[]},get shows(){var e;return null!==(e=re.value(t.readable.showsOp))&&void 0!==e?e:[]},getView(e){var i;return(null!==(i=re.value(t.readable.viewsOp))&&void 0!==i?i:[]).find((t=>t.label===e))},getPrivilege(e){var i;return(null!==(i=re.value(t.readable.privilegesOp))&&void 0!==i?i:[]).find((t=>t.privilegeId===e))},getShow(e){var i;return(null!==(i=re.value(t.readable.showsOp))&&void 0!==i?i:[]).find((t=>t.label===e))},async setView(i){var n;const a=null!==(n=re.value(t.readable.viewsOp))&&void 0!==n?n:[];await re.operation({setOp:e=>t.writable.viewsOp=e,promise:e.writeView(i).then((()=>[...a.filter((e=>e.label!==i.label)),{...i.reference,label:i.label,privileges:i.privileges}]))}),await s(i.label)},async deleteView(i){var n,a;const o=null!==(n=re.value(t.readable.viewsOp))&&void 0!==n?n:[];await re.operation({setOp:e=>t.writable.viewsOp=e,promise:e.deleteView({label:i}).then((()=>o.filter((e=>e.label!==i))))});const r=null!==(a=re.value(t.readable.showsOp))&&void 0!==a?a:[];t.writable.showsOp=re.replaceValue(t.readable.showsOp,r.filter((e=>e.label!==i)))}}}(e);return t.onLinkChange(i.onVideoHostingUpdate),{dacastModel:t,contentModel:i,updateAccessOp(e){t.updateAccessOp(e),i.updateAccessOp(e)}}}function Xe(e,t,i){const n=[...e];for(const e of t){!!n.find((t=>i(t,e)))||n.push(e)}return n}function Ke({state:e,actions:t,questionsPostingService:i,questionsAnsweringService:n,questionsModerationService:a,getAccess:o,loadQuestionsForBoard:r}){return s=>({getPermissions(){const{access:t}=e;return{"read questions":!!t&&t.permit.privileges.includes(je.privileges["read questions"]),"post questions":!!t&&(t.permit.privileges.includes(je.privileges["post questions"])&&!t.permit.privileges.includes(je.privileges.banned)),"moderate questions":!!t&&t.permit.privileges.includes(je.privileges["moderate questions"]),"answer questions":!!t&&t.permit.privileges.includes(je.privileges["answer questions"]),"like questions":!!t&&t.permit.privileges.includes(je.privileges["like questions"]),"report questions":!!t&&t.permit.privileges.includes(je.privileges["report questions"])}},getBoardName:()=>s,getAccess:()=>e.access,getBoardOp:()=>e.boardOps[s],getPostingOp:()=>e.postingOp,getQuestions:()=>e.questions.filter((e=>e.board===s)).filter((e=>!1===e.archive)).map((e=>({...e,answers:e.answers.filter((e=>!1===e.archive))}))),getUser:t=>e.users.find((e=>e.userId===t)),async loadQuestions(){await r(s)},async postQuestion({content:e}){const n=await re.operation({promise:i.postQuestion({questionDraft:{board:s,content:e}}),setOp:e=>t.setPostingOp(re.replaceValue(e,void 0))});t.addQuestions([n]);const a=re.value(o());return t.addUsers([a.user]),n},async postAnswer(e,i){const a=await re.operation({promise:n.postAnswer({questionId:e,answerDraft:i}),setOp:e=>t.setPostingOp(re.replaceValue(e,void 0))});t.addAnswer(a);const r=re.value(o());return t.addUsers([r.user]),a},async likeQuestion(e,n){await i.likeQuestion({like:n,questionId:e}),t.setQuestionLike(e,n)},async likeAnswer(e,i,a){await n.likeAnswer({answerId:i,like:a}),t.setAnswerLike(e,i,a)},async reportQuestion(e,n){await i.reportQuestion({report:n,questionId:e}),t.setQuestionReport(e,n)},async reportAnswer(e,i,a){await n.reportAnswer({answerId:i,report:a}),t.setAnswerReport(e,i,a)},async archiveQuestion(e,n){await i.archiveQuestion({archive:n,questionId:e}),t.setQuestionArchive(e,n)},async archiveAnswer(e,i,a){await n.archiveAnswer({answerId:i,archive:a}),t.setAnswerArchive(e,i,a)},async archiveBoard(){await a.archiveBoard({board:s});for(const i of e.questions)t.setQuestionArchive(i.questionId,!0)}})}function Ye(e){const{questionsReadingService:t}=e,{state:i,actions:n,subscribe:a}=function(){const e=ye({access:void 0,users:[],questions:[],boardOps:{},postingOp:re.ready(void 0)}),t=e.writable,i={setAccess(e){t.access=e},setBoardOp(e,i){t.boardOps={...t.boardOps,[e]:i}},setPostingOp(e){t.postingOp=e},addUsers(e){t.users=[...Xe(e.filter((e=>!!e)),t.users,((e,t)=>e.userId===t.userId))]},addQuestions(e){t.questions=[...Xe(e,t.questions,((e,t)=>e.questionId===t.questionId))]},addAnswer(e){const i=t.questions.find((t=>t.questionId===e.questionId));if(!i)throw new Error(`can't find question to add answer, question id: "${e.questionId}"`);const n={...i,answers:[...i.answers,e]};t.questions=[...Xe([n],t.questions,((e,t)=>e.questionId===t.questionId))]},setQuestionLike(e,i){t.questions=t.questions.map((t=>t.questionId===e?{...t,liked:i,likes:t.liked===i?t.likes:i?t.likes+1:t.likes-1}:{...t}))},setAnswerLike(e,i,n){t.questions=t.questions.map((t=>t.questionId===e?{...t,answers:t.answers.map((e=>e.answerId===i?{...e,liked:n,likes:e.liked===n?e.likes:n?e.likes+1:e.likes-1}:{...e}))}:{...t}))},setAnswerReport(e,i,n){t.questions=t.questions.map((t=>t.questionId===e?{...t,answers:t.answers.map((e=>e.answerId===i?{...e,reported:n,reports:e.reported===n?e.reports:n?e.reports+1:e.reports-1}:{...e}))}:{...t}))},setQuestionReport(e,i){t.questions=t.questions.map((t=>t.questionId===e?{...t,reported:i,reports:t.reported===i?t.reports:i?t.reports+1:t.reports-1}:{...t}))},setQuestionArchive(e,i){t.questions=t.questions.map((t=>t.questionId===e?{...t,archive:i}:{...t}))},setAnswerArchive(e,i,n){t.questions=t.questions.map((t=>t.questionId===e?{...t,answers:t.answers.map((e=>e.answerId===i?{...e,archive:n}:{...e}))}:{...t}))}};return{actions:i,state:e.readable,subscribe:e.subscribe}}();async function o(e){await re.operation({promise:(async()=>{const{users:i,questions:a}=await t.fetchQuestions({board:e});n.addUsers(i),n.addQuestions(a)})(),setOp:t=>n.setBoardOp(e,t)})}return{subscribe:a,makeBoardModel:Ke({state:i,actions:n,loadQuestionsForBoard:o,...e}),accessChange:e=>{n.setAccess(e),(null==e?void 0:e.user)&&n.addUsers([e.user]),async function(){await Promise.all(Object.keys(i.boardOps).map(o))}()}}}class Ge extends Error{}class Je extends Ge{constructor(){super("login token has expired")}}function Ze({roleAssignmentService:e,reauthorize:t}){const i=ye({accessOp:re.none(),permissionsOp:re.none()});function n(){return re.value(i.readable.accessOp)}let a=!1;function o(){return function(e,t){const i={};for(const[n,a]of Object.entries(t))i[n]=!!e&&e.permit.privileges.includes(a);return e=>i[e]}(n(),je.privileges)}async function r(){a&&o()("administrate user roles")&&await re.operation({promise:e.fetchPermissions(),setOp:e=>i.writable.permissionsOp=e})}return{state:i.readable,subscribe:i.subscribe,getAccess:n,initialize:async function(){a=!0,await r()},get isAllowed(){return o()},reauthorize:t,searchUsers:e.searchUsers,assignRoleToUser:e.assignRoleToUser,revokeRoleFromUser:e.revokeRoleFromUser,async updateAccessOp(e){i.writable.accessOp=e,r()}}}var et,tt,it;function nt({stripePopups:e,services:t,stateSystem:i,reloadStore:n}){const a=i.snap.writable,{allowance:o}=i;return{load:async function(){a.stripeConnect.connectStatusOp=re.none(),a.stripeConnect.connectDetailsOp=re.none(),o.connectStripeAccount?await re.operation({promise:t.connect.loadConnectDetails(),setOp:e=>{var t,i;a.stripeConnect.connectStatusOp=re.replaceValue(e,null===(t=re.value(e))||void 0===t?void 0:t.connectStatus),a.stripeConnect.connectDetailsOp=re.replaceValue(e,null===(i=re.value(e))||void 0===i?void 0:i.connectDetails)}}):await re.operation({promise:t.connect.loadConnectStatus(),setOp:e=>a.stripeConnect.connectStatusOp=e})},get isOnboardingNeeded(){var e;const{get:t}=i;return t.connect.status===et.Unlinked||!(null===(e=t.connect.details)||void 0===e?void 0:e.details_submitted)},get isAllowedToOnboard(){var e;const{get:t}=i,n=t.user.access;return!!(null==n?void 0:n.user)&&(!!n.permit.privileges.includes(Ae["control stripe account"])&&(t.connect.status===et.Unlinked||n.user.userId===(null===(e=t.connect.details)||void 0===e?void 0:e.userId)))},async stripeAccountOnboarding(){var i;const a=await t.connect.generatePopupForStripeAccountOnboarding();"return"===(null===(i=(await e.connect(a)).details)||void 0===i?void 0:i.status)&&await n()},async stripeLogin(){const i=re.value(a.stripeConnect.connectStatusOp),o=re.value(a.stripeConnect.connectDetailsOp);if(i===et.Unlinked)throw new Error("no stripe account to generate login link for");if(!o)throw new Error("stripe connect details missing for login");const{stripeLoginLink:r,popupId:s}=await t.connect.generateStripeLoginLink(),{stripeAccountId:l}=o;await e.login({stripeAccountId:l,stripeLoginLink:r,popupId:s}),await n()},async pause(){await t.connect.pause(),a.stripeConnect.connectStatusOp=re.ready(et.Paused),o.manageStore&&(a.stripeConnect.connectDetailsOp=re.ready({...re.value(a.stripeConnect.connectDetailsOp),paused:!0}))},async resume(){await t.connect.resume(),a.stripeConnect.connectStatusOp=re.ready(et.Ready),o.manageStore&&(a.stripeConnect.connectDetailsOp=re.ready({...re.value(a.stripeConnect.connectDetailsOp),paused:!1}))}}}function at({stripePopups:e,services:t,stateSystem:i,reloadStore:n}){const a=i.snap.writable,{get:o,allowance:r}=i;return{load:async function(){a.billing.paymentMethodOp=re.none(),o.is.storeActive&&o.is.userLoggedIn&&await re.operation({promise:t.billing.getDefaultPaymentMethod(),setOp:e=>a.billing.paymentMethodOp=e})},allowance:r,customerPortal:async function(){const{popupId:i,stripeSessionUrl:a,customer:o,stripeAccountId:r}=await t.billing.generateCustomerPortalLink();await e.openStoreCustomerPortal({popupId:i,customer:o,stripeSessionUrl:a,stripeAccountId:r}),await n()}}}function ot({services:e,stateSystem:t,stripePopups:i,reauthorize:n}){const a=t.snap.writable,{get:o}=t;function r(){var e;return null!==(e=re.value(pe(a.subscriptions.subscriptionPlansOp)))&&void 0!==e?e:[]}return{load:async function(){a.subscriptions.subscriptionPlansOp=re.none(),a.subscriptions.mySubscriptionDetailsOp=re.none(),o.is.storeActive&&(await re.operation({setOp:e=>a.subscriptions.subscriptionPlansOp=e,promise:e.subscriptions.listing.listPlans()}),o.is.userLoggedIn&&await re.operation({setOp:e=>a.subscriptions.mySubscriptionDetailsOp=e,promise:e.subscriptions.shopping.fetchDetailsAboutMySubscriptions()}))},...ce({async purchase({stripePriceId:t,showLoadingSpinner:n}){n&&(a.subscriptions.mySubscriptionDetailsOp=re.loading());const{checkoutDetails:o}=await e.subscriptions.shopping.buy(t);o&&await i.checkoutSubscription(o)},async cancel(t){a.subscriptions.mySubscriptionDetailsOp=re.loading(),await e.subscriptions.shopping.cancel(t)},async uncancel(t){a.subscriptions.mySubscriptionDetailsOp=re.loading(),await e.subscriptions.shopping.uncancel(t)}},(e=>async(...t)=>{await e(...t),await n()})),async addPlan(t){const i=await e.subscriptions.planning.addPlan(t),n=r();return a.subscriptions.subscriptionPlansOp=re.replaceValue(a.subscriptions.subscriptionPlansOp,[...n,i]),i},async addTier(t){const i=r(),n=await e.subscriptions.planning.addTier(t),o=i.find((e=>e.planId===t.planId));return o.tiers=[...o.tiers,n],a.subscriptions.subscriptionPlansOp=re.ready(i),n},async editPlan({planId:t,label:i,archived:n}){await e.subscriptions.planning.editPlan({planId:t,label:i,archived:n});const o=r(),s=o.find((e=>e.planId===t));s.label=i,s.archived=n,a.subscriptions.subscriptionPlansOp=re.ready(o)},async editTier({planId:t,tierId:i,label:n,active:o,pricing:s}){const l=await e.subscriptions.planning.editTier({tierId:i,active:o,label:n,pricing:s}),c=r(),d=c.find((e=>e.planId===t));d.tiers=d.tiers.map((function(e){return e.tierId===l.tierId?l:e})),a.subscriptions.subscriptionPlansOp=re.ready(c)}}}function rt(e){const t=function(){const e=ye({user:{accessOp:re.none()},stripeConnect:{connectStatusOp:re.none(),connectDetailsOp:re.none()},subscriptions:{subscriptionPlansOp:re.none(),mySubscriptionDetailsOp:re.none()},billing:{paymentMethodOp:re.none()}}),t=e.readable,i=(()=>{const e=e=>{var i,n;return(null!==(n=null===(i=re.value(t.user.accessOp))||void 0===i?void 0:i.permit.privileges)&&void 0!==n?n:[]).includes(Ae[e])};return{get manageStore(){return e("manage store")},get connectStripeAccount(){return e("control stripe account")},get giveAwayFreebies(){return e("give away freebies")}}})();return{snap:e,state:t,allowance:i,get:{is:{get storeActive(){return re.value(e.state.stripeConnect.connectStatusOp)===et.Ready},get userLoggedIn(){var t;return!!(null===(t=re.value(e.state.user.accessOp))||void 0===t?void 0:t.user)}},user:{get access(){return re.value(t.user.accessOp)}},connect:{get status(){return re.value(t.stripeConnect.connectStatusOp)},get details(){return re.value(t.stripeConnect.connectDetailsOp)}},subscriptions:{get plans(){return re.value(t.subscriptions.subscriptionPlansOp)},get mySubscriptionDetails(){return re.value(t.subscriptions.mySubscriptionDetailsOp)}},billing:{get paymentMethod(){return re.value(t.billing.paymentMethodOp)}}}}}(),i={...e,stateSystem:t,reloadStore:async()=>a.load()},n={subscriptions:ot(i),billing:at(i),connect:nt(i)},a=function({state:e,loadStore:t}){async function i(){re.isReady(e.user.accessOp)&&await t()}let n=!1;return{load:i,initialize:async function(){n||(n=!0,await i())},refresh:async function(){n&&await i()}}}({state:t.state,loadStore:async()=>{await n.connect.load(),await Promise.all([n.billing.load(),n.subscriptions.load()])}});return{...t,...n,...a,async updateAccessOp(e){t.snap.state.user.accessOp=e,await a.refresh()}}}async function st({appId:e,remote:t,storage:i,authMediator:n,stripePopups:a,chatConnect:o}){const r=function({authMediator:e,loginService:t}){let i=re.none();const n=ne();async function a(e){i=e,await n.publish(e)}async function o(e){return re.operation({promise:e,setOp:a})}e.subscribeToAccessChange((async e=>a(re.ready(e))));const r={async useExistingLogin(){await o(e.initialize())},sendLoginLink:async e=>t.sendLoginLink({email:e}),async login(i){try{if(!X(i))throw new Je;await o(t.authenticateViaLoginToken({loginToken:i}).then((t=>e.login(t))))}catch(t){throw console.error(t),await a(re.none()),await o(e.initialize()),t}},async logout(){await o(e.logout()),await re.operation({promise:e.logout(),setOp:a})},async reauthorize(){await o(e.reauthorize())}};return{...r,subscribe:n.subscribe,getAccessOp:()=>structuredClone(i),getAccess:()=>re.value(structuredClone(i)),getValidAccess:()=>e.getValidAccess()}}({authMediator:n,loginService:t.auth.users.loginService}),{getAccessOp:s,getAccess:l,getValidAccess:c,reauthorize:d}=r,u=function({getAccessOp:e}){const t=ye({accessOp:e()});return{state:t.readable,subscribe:t.subscribe,updateAccessOp:e=>{t.writable.accessOp=e}}}({getAccessOp:s}),p=function({personalService:e,getAccessOp:t,reauthorize:i}){const{readable:n,writable:a,track:o,subscribe:r}=ye({accessOp:t(),submitDraftOp:re.ready(void 0)});return{track:o,subscribe:r,readable:n,async saveProfile(t){await re.operation({promise:(async()=>{const{user:{userId:a}}=re.value(n.accessOp);await e.setProfile({userId:a,profileDraft:t}),await i()})(),errorReason:"error saving profile",setOp(e){a.submitDraftOp=e}})},updateAccessOp(e){a.accessOp=e}}}({personalService:t.auth.users.personalService,getAccessOp:s,reauthorize:d}),h=function({appService:e,appEditService:t,getValidAccess:i}){const{readable:n,writable:a,subscribe:o}=ye({active:!1,appRecords:re.none(),addingNewApp:re.none()}),r={setAppRecords(e){var t;const i=null!==(t=re.value(e))&&void 0!==t?t:[];let n={};for(const e of i)n[e.appId]=re.ready(e);a.appRecords=re.replaceValue(e,n)},setIndividualAppRecord(e,t){var i;if(re.isLoading(a.appRecords))throw new Error("cannot set individual app while apps are loading");const n=null!==(i=re.value(a.appRecords))&&void 0!==i?i:{};a.appRecords=re.ready({...n,[e]:t})},deleteIndividualAppRecord(e){if(!re.isReady(a.appRecords))throw new Error("cannot delete individual app while apps are loading");{const t=re.value(a.appRecords),i={};for(const[n,a]of Object.entries(t))n!==e&&(i[n]=a);a.appRecords=re.ready(i)}}};async function s(){var e;const t=await i();return null===(e=null==t?void 0:t.user)||void 0===e?void 0:e.userId}async function l(){return a.active=!0,re.operation({promise:(async()=>{const t=await s();return t?e.listApps({ownerUserId:t}):[]})(),setOp:e=>r.setAppRecords(e)})}function c(e){const t=re.value(a.appRecords);return t?re.value(t[e]):void 0}return{state:n,subscribe:o,appEditService:t,getApp:c,loadApps:l,deleteApp:async function(e){await re.operation({promise:t.deleteApp({appId:e}),setOp:t=>{r.setIndividualAppRecord(e,re.replaceValue(t,c(e)))}}),r.deleteIndividualAppRecord(e)},updateApp:async function(e,i){const n=re.value(a.appRecords);if(!n)throw new Error("cannot update app while loading records");const o=re.value(n[e]);if(!o)throw new Error("cannot update app not present in records");return re.operation({promise:t.updateApp({appId:e,appDraft:i}),setOp:t=>r.setIndividualAppRecord(e,re.replaceValue(t,{...o,...i}))})},registerApp:async function(i){const n=await s();return await re.operation({errorReason:"failed to register app",promise:(async()=>{const a=await e.registerApp({appDraft:i,ownerUserId:n});return await t.assignPlatformUserAsAdmin({appId:a.appId,platformUserId:n}),a})(),setOp:e=>{if(a.addingNewApp=re.replaceValue(e,null),re.isReady(e)){const t={...re.value(e),...i};r.setIndividualAppRecord(t.appId,re.ready(t))}}})},async updateAccessOp(e){n.active&&await l()}}}({appService:t.auth.apps.appService,appEditService:t.auth.apps.appEditService,getValidAccess:c}),m=function({permissionsService:e,reauthorize:t}){const{readable:i,writable:n,subscribe:a,track:o}=ye({active:!1,accessOp:re.none(),permissionsDisplay:re.none()});function r(){return re.value(i.accessOp)}function s(e){const t=[],i=[];for(const n of e.privileges)n.hard?i.push(n):t.push(n);return t.sort(((e,t)=>t.time-e.time)),{...e,privileges:[...t,...i]}}async function l(){await re.operation({promise:Promise.resolve().then((async()=>c()?e.fetchPermissions().then(s):void 0)),setOp:e=>n.permissionsDisplay=e})}function c(){const e=r();return!!(null==e?void 0:e.user)&&e.permit.privileges.includes(je.privileges["customize permissions"])}function d(e){return async(...i)=>{const n=await e(...i);return await l(),await t(),n}}return{readable:i,subscribe:a,track:o,getAccess:r,initialize:async function(){n.active=!0,c()&&await l()},getUserCanCustomizePermissions:c,createRole:d(e.createRole),deleteRole:d(e.deleteRole),assignPrivilege:d(e.assignPrivilege),unassignPrivilege:d(e.unassignPrivilege),deletePrivilege:d(e.deletePrivilege),createPrivilege:d(e.createPrivilege),async updateAccessOp(e){n.accessOp=e;const t=r();(null==t?void 0:t.user)&&n.active&&await l()}}}({permissionsService:t.auth.permissions.permissionsService,reauthorize:d}),f=Qe({dacastService:t.videos.dacastService,contentService:t.videos.contentService}),b=Ve({chatConnect:o,getChatMeta:async()=>({accessToken:await n.getValidAccessToken()})}),g=He({notesService:t.notes.notesService}),v=rt({stripePopups:a,services:t.store,reauthorize:d}),w=Ze({roleAssignmentService:t.administrative.roleAssignmentService,reauthorize:()=>r.reauthorize()}),y=Ye({...t.questions,getAccess:s});return r.subscribe((async e=>{const t=l();await Promise.all([u.updateAccessOp(e),p.updateAccessOp(e),h.updateAccessOp(e),m.updateAccessOp(e),y.accessChange(t),w.updateAccessOp(e),f.dacastModel.updateAccessOp(e),f.contentModel.updateAccessOp(e),b.updateAccessOp(e),g.updateAccessOp(e),v.updateAccessOp(e)])})),{exampleModel:u,appsModel:h,chatModel:b,accessModel:r,videoModels:f,notesModel:g,storeModel:v,personalModel:p,questionsModel:y,permissionsModel:m,administrativeModel:w}}function lt(...e){return t=>{let i=[];for(const n of e)if(i=n(t),i.length>0)break;return i}}function ct(e){const t=Object.keys(e);return i=>Object.entries(i).flatMap((([i,n])=>t.includes(i)?e[i](n).map((e=>`"${i}": ${e}`)):[`"${i} not in schema"`]))}function dt(...e){return t=>{const i=e.map((e=>e(t)));let n=!1;for(const e of i)0===e.length&&(n=!0);return n?[]:i.flat().map(((e,t)=>t>0?`or, ${e}`:e))}}function ut(...e){return t=>{if(!Array.isArray(t))return["must be array"];const i=lt(...e),n=[];return t.forEach(((e,t)=>{for(const a of i(e))n.push(`(${t+1}) ${a}`)})),n}}!function(e){e[e.Unlinked=0]="Unlinked",e[e.Incomplete=1]="Incomplete",e[e.Paused=2]="Paused",e[e.Ready=3]="Ready"}(et||(et={})),function(e){e[e.Unsubscribed=0]="Unsubscribed",e[e.Active=1]="Active",e[e.Unpaid=2]="Unpaid",e[e.Cancelled=3]="Cancelled"}(tt||(tt={})),function(e){e[e.Update=0]="Update",e[e.UsePaymentMethod=1]="UsePaymentMethod",e[e.CheckoutPopup=2]="CheckoutPopup"}(it||(it={}));const pt=e=>t=>t===e?[]:["wrong value"],ht=e=>t=>t<e?["too small"]:[],mt=e=>t=>t>e?["too big"]:[],ft=()=>e=>Array.isArray(e)?[]:["must be an array"],bt=e=>t=>t.length<e?["too small"]:[],gt=e=>t=>t.length>e?["too big"]:[],vt=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,wt=()=>e=>vt.test(e)?[]:["invalid email"],yt=lt((e=>"string"!=typeof e?["must be a string"]:[]),(xt=64,e=>e.length!==xt?[`length must be ${xt}`]:[]),((e,t="invalid string")=>i=>e.test(i)?[]:[t])(/^[0-9a-z]{64}$/));var xt;const It=lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(1),gt(32),(e=>/\s/.test(e)?["must not have any spaces"]:[])),kt=lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(1),gt(280),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),$t=ct({content:kt}),St=lt(ft(),ut(yt)),Pt=lt((e=>"number"!=typeof e?["must be a number"]:[]),ht(0),mt(1)),At=({rando:e,rateLimiter:t,clientRecord:i,persistence:n,headers:a,policy:o,getStatsFromServerCore:r})=>({chatServer:B().policy((async(e,t)=>{var a;const o=null===(a=i.auth)||void 0===a?void 0:a.access.appId;return{persistenceActions:o?n.namespaceForApp(o):void 0,headers:t}})).expose((({persistenceActions:n,headers:a})=>{const{clientside:{chatClient:s}}=i,l=()=>{var e,t;return Ue(null!==(t=null===(e=i.auth)||void 0===e?void 0:e.access.permit.privileges)&&void 0!==t?t:[])};function c(e){if(0!==e.length)throw new Error("chat validation error")}return{async updateUserMeta(e){i.auth=await o(e,a)},async getStats(){var e,t;const n=null===(t=null===(e=i.auth)||void 0===e?void 0:e.access)||void 0===t?void 0:t.appId;if(!n)throw new L(400,"cannot get stats before updateUserMeta");return r(n)},async roomSubscribe(e){c(It(e)),l().viewAllChats&&(i.rooms.add(e),s.roomStatusChanged(e,await n.getRoomStatus(e)),s.postsAdded(e,await n.fetchRecentPosts(e)),s.usersMuted((await n.fetchMutes()).map((({userId:e})=>e))))},async roomUnsubscribe(e){c(It(e)),l().viewAllChats&&i.rooms.delete(e)},async post(a,o){if(!t.tooMany()&&(c(ct({room:It,draft:$t})({room:a,draft:o})),l().participateInAllChats&&(()=>{var e,t;return!n.isMuted(null===(t=null===(e=i.auth)||void 0===e?void 0:e.access.user)||void 0===t?void 0:t.userId)})()&&!l().banned)){const t={...o,room:a,time:Date.now(),postId:e.randomId().toString(),userId:i.auth.access.user.userId,nickname:i.auth.access.user.profile.nickname};await n.addPosts(a,[t])}},async remove(e,t){c(ct({room:It,postIds:St})({room:e,postIds:t})),l().moderateAllChats&&await n.removePosts(e,t)},async clear(e){c(It(e)),l().moderateAllChats&&await n.clearRoom(e)},async mute(e){c(St(e)),l().moderateAllChats&&await n.addMute(e)},async unmute(e){c(St(e)),l().moderateAllChats&&await n.removeMute(e)},async unmuteAll(){l().moderateAllChats&&await n.unmuteAll()},async setRoomStatus(e,t){c(ct({room:It,status:Pt})({room:e,status:t})),l().moderateAllChats&&await n.setRoomStatus(e,t)}}}))});var Ot,Mt,Ct=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i},Et=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class _t{constructor({maximum:e}){Ot.set(this,void 0),Mt.set(this,[]),Ct(this,Ot,e,"f")}add(e){Et(this,Mt,"f").push(e),Et(this,Mt,"f").length>Et(this,Ot,"f")&&Ct(this,Mt,Et(this,Mt,"f").slice(-Et(this,Ot,"f")),"f")}read(){return[...Et(this,Mt,"f")]}}Ot=new WeakMap,Mt=new WeakMap;var Rt,Tt,Dt,qt=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i},Lt=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class jt{constructor({timeframe:e,maximum:t}){Rt.set(this,void 0),Tt.set(this,void 0),Dt.set(this,void 0),qt(this,Rt,e,"f"),qt(this,Tt,t,"f"),qt(this,Dt,new _t({maximum:t}),"f")}hit(){const e=Date.now(),t=e-Lt(this,Rt,"f");return Lt(this,Dt,"f").read().filter((e=>e>t)).length<Lt(this,Tt,"f")&&(Lt(this,Dt,"f").add(e),!0)}tooMany(){return!this.hit()}}Rt=new WeakMap,Tt=new WeakMap,Dt=new WeakMap;const Ut=e=>H.encode(JSON.stringify(e));const Nt=()=>async e=>{const t=F(e),i=1e3*t.data.exp;if(Date.now()>i)throw new Error("token expired");return t.data.payload},zt=Nt();async function Bt({accessToken:e}){return{access:await zt(e)}}function Vt(e,t){const i={};for(const[n,a]of Object.entries(e))i[n]=t(a,n);return i}var Wt,Ht=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i},Ft=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class Qt extends Map{constructor(e,t){super(t),Wt.set(this,void 0),Ht(this,Wt,e,"f")}assert(e){if(this.has(e))return this.get(e);{const t=Ft(this,Wt,"f").call(this,e);return this.set(e,t),t}}}Wt=new WeakMap;const Xt="namespace-appId";class Kt{static wrapTables(e){return function e(t){return Vt(t,(t=>E(t)?new Kt(t):e(t)))}(e)}static unwrapTables(e){return function e(t){return Vt(t,(t=>t instanceof Kt?t.unconstrained:e(t)))}(e)}static wrapDatabase(e){return _(e,(e=>Kt.wrapTables(e)))}static constrainTablesForApp({appId:e,unconstrainedTables:t}){return function t(i){return Vt(i,(i=>i instanceof Kt?i.constrainForApp(e):t(i)))}(t)}static constrainDatabaseForApp({appId:e,database:t}){function i(t){return Vt(t,(t=>t instanceof Kt?t.constrainForApp(e):E(t)?t:i(t)))}return{tables:i(t.tables),transaction:async e=>t.transaction((async({tables:t,abort:n})=>e({tables:i(t),abort:n})))}}constructor(e){this.unconstrained=e}constrainForApp(e){return R({table:this.unconstrained,constraint:{[Xt]:e}})}}function Yt(e){return e.join("-")}async function Gt(e){const t=Kt.wrapDatabase(M({shape:Ne,flexStorage:e,makeTableName:Yt})),i={roomStatusChanged:We(),postsAdded:We(),postsRemoved:We(),roomCleared:We(),mutes:We(),unmutes:We(),unmuteAll:We()},n=Vt(i,(e=>e.subscribe)),a=(()=>{const e=new Qt((()=>({mutedUserIds:new Set})));return t=>e.assert(t)})();return n.mutes((({appId:e,userIds:t})=>{const i=a(e);for(const e of t)i.mutedUserIds.add(e)})),n.unmutes((({appId:e,userIds:t})=>{const i=a(e);for(const e of t)i.mutedUserIds.delete(e)})),n.unmuteAll((({appId:e})=>{a(e).mutedUserIds.clear()})),{events:n,namespaceForApp:function(e){const n=a(e),o=Kt.constrainDatabaseForApp({appId:r.fromString(e),database:t}).tables;return{isMuted:e=>n.mutedUserIds.has(e),async addPosts(t,n){await o.posts.create(...n.map((e=>({room:e.room,time:e.time,content:e.content,nickname:e.nickname,userId:r.fromString(e.userId),postId:r.fromString(e.postId)})))),i.postsAdded.publish({appId:e,room:t,posts:n})},async removePosts(t,n){n.length&&(await o.posts.delete(u(n,(e=>({room:t,postId:r.fromString(e)})))),i.postsRemoved.publish({appId:e,room:t,postIds:n}))},async fetchRecentPosts(e){const t=(await o.posts.read({...d({room:e}),limit:50,order:{time:"descend"}})).map((e=>({room:e.room,time:e.time,content:e.content,nickname:e.nickname,postId:e.postId.toString(),userId:e.userId.toString()}))).sort(((e,t)=>e.time-t.time));return t},fetchMutes:async()=>(await o.mutes.read({conditions:!1})).map((e=>({userId:e.userId.toString()}))),async clearRoom(t){await o.posts.delete(d({room:t})),i.roomCleared.publish({appId:e,room:t})},async addMute(t){if(t.length){const n=(await o.mutes.read(u(t,(e=>({userId:r.fromString(e)}))))).map((e=>e.userId.toString())),a=t.filter((e=>!n.includes(e))),s=a.map((e=>({userId:r.fromString(e)})));await o.mutes.create(...s),i.mutes.publish({appId:e,userIds:a})}},async removeMute(t){t.length&&(await o.mutes.delete(u(t,(e=>({userId:r.fromString(e)})))),i.unmutes.publish({appId:e,userIds:t}))},async unmuteAll(){await o.mutes.delete({conditions:!1}),i.unmuteAll.publish({appId:e})},async setRoomStatus(t,n){await o.roomStatuses.update({...d({room:t}),upsert:{room:t,status:n}}),i.roomStatusChanged.publish({appId:e,room:t,status:n})},async getRoomStatus(e){const t=await o.roomStatuses.readOne(d({room:e}));return t?t.status:ze.Offline}}}}}async function Jt(e){const t=function({rando:e,persistence:t,policy:i}){const n=new Set;function a(e){const t=Array.from(n).filter((t=>{var i,n;return(null===(n=null===(i=t.auth)||void 0===i?void 0:i.access)||void 0===n?void 0:n.appId)===e})),i={};for(const e of t)for(const t of e.rooms){i[t]||(i[t]={totalUsers:0,viewers:0,participants:0,moderators:0});const n=i[t];n.totalUsers+=1;const a=e.auth.access.permit.privileges.includes(ke["moderate all chats"]),o=e.auth.access.permit.privileges.includes(ke["participate in all chats"]),r=e.auth.access.permit.privileges.includes(ke["view all chats"]);a?n.moderators+=1:o?n.participants+=1:r&&(n.viewers+=1)}return{numberOfConnections:t.length,statsForRooms:i}}async function o(e,t){for(const i of n.values())i.auth&&i.auth.access.appId===e&&t(i,Ue(i.auth.access.permit.privileges))}async function r(e,t,i){for(const a of n.values())a.auth&&a.auth.access.appId===e&&a.rooms.has(t)&&i(a,Ue(a.auth.access.permit.privileges))}return t.events.roomStatusChanged((({appId:e,room:t,status:i})=>{r(e,t,(e=>e.clientside.chatClient.roomStatusChanged(t,i)))})),t.events.postsAdded((({appId:e,room:t,posts:i})=>{r(e,t,((e,n)=>{n.viewAllChats&&e.clientside.chatClient.postsAdded(t,i)}))})),t.events.postsRemoved((({appId:e,room:t,postIds:i})=>{r(e,t,((e,n)=>{n.viewAllChats&&e.clientside.chatClient.postsRemoved(t,i)}))})),t.events.mutes((({appId:e,userIds:t})=>{o(e,((e,i)=>{i.viewAllChats&&e.clientside.chatClient.usersMuted(t)}))})),t.events.unmutes((({appId:e,userIds:t})=>{o(e,((e,i)=>{i.viewAllChats&&e.clientside.chatClient.usersUnmuted(t)}))})),t.events.unmuteAll((({appId:e})=>{o(e,((e,t)=>{t.viewAllChats&&e.clientside.chatClient.unmuteAll()}))})),t.events.roomCleared((({appId:e,room:t})=>{r(e,t,((e,i)=>{i.viewAllChats&&e.clientside.chatClient.roomCleared(t)}))})),{acceptNewClient:function({headers:o,controls:r,clientside:s,handleDisconnect:l}){const c={auth:void 0,rooms:new Set,clientside:s,controls:r};n.add(c);const d=new jt({timeframe:6e4,maximum:20}),u=setInterval(r.ping,1e4);return{api:At({rando:e,rateLimiter:d,persistence:t,clientRecord:c,headers:o,policy:i,getStatsFromServerCore:a}),disconnect(){clearInterval(u),l(),n.delete(c)}}},get clientCount(){return n.size}}}({rando:await b(),persistence:await Gt(e),policy:Bt});return function(e){return async function({clientsideApi:t,handleDisconnect:i}){const n=U().forApi(t).withMetaMap({chatClient:async()=>{}}),{api:a,disconnect:o}=e.acceptNewClient({headers:{},controls:{ping(){},close(){}},clientside:n,handleDisconnect:()=>{}});return{serverside:U().forApi(a).withMetaMap({chatServer:async()=>{}}),disconnect(){o(),i()}}}}(t)}function Zt({rig:e,mockStripeOperations:t}){return{connect:async({popupId:i,stripeAccountId:n})=>"complete"===e.stripeAccountFate?(await t.linkStripeAccount(n),{popupId:i,details:{status:"return"}}):(await t.linkStripeAccountThatIsIncomplete(n),{popupId:i,details:{status:"return"}}),login:async({popupId:i,stripeAccountId:n})=>(e.stripeLoginCount+=1,"complete"===e.stripeAccountFate?await t.linkStripeAccount(n):await t.linkStripeAccountThatIsIncomplete(n),{popupId:i}),checkoutSubscription:async({popupId:e,stripeAccountId:i,stripeSessionId:n})=>(await t.checkoutSubscriptionTier(i,n),{popupId:e}),openStoreCustomerPortal:async({popupId:i,stripeAccountId:n,customer:a})=>("link successful payment method"===e.customerPortalAction?await t.createNewDefaultPaymentMethod({stripeAccountId:n,customer:a,isFailing:!1}):"link failing payment method"===e.customerPortalAction?await t.createNewDefaultPaymentMethod({stripeAccountId:n,customer:a,isFailing:!0}):"detach payment method"===e.customerPortalAction&&await t.removeAllPaymentMethods(a),{popupId:i})}}function ei(e,t){return t.platform.appDetails.appId===e}async function ti(e){const t=Object.keys(e),i=Object.values(e),n=await Promise.all(i),a={};return t.forEach(((e,t)=>a[e]=n[t])),a}const ii=lt((e=>"string"!=typeof e?["must be a string"]:[]),gt(1e3),(e=>/^https?:\/\/[a-zA-Z\.\d-]+(?:|:\d+)$/i.test(e)?[]:["invalid origin"]),dt((e=>/^https:\/\//i.test(e)?[]:["must be secure, starting with 'https'"]),(e=>/^https?:\/\/(127\.0\.0\.1|localhost)(|:\d{1,5})(|\/\S*)$/i.test(e)?[]:["must be a localhost address"]))),ni=Object.freeze({home:lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(1),gt(2e3),dt(lt((e=>{try{return new URL(e),[]}catch(e){return["invalid url"]}}),(e=>/^https:\/\//i.test(e)?[]:["must be secure, starting with 'https'"])),(e=>/^https?:\/\/(127\.0\.0\.1|localhost)(|:\d{1,5})(|\/\S*)$/i.test(e)?[]:["must be a localhost address"]))),label:lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(1),gt(50),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),origins:lt(bt(1),gt(100),ut(ii)),additionalOrigins:lt(ft(),bt(0),gt(99),ut(ii))}),ai=ct({home:ni.home,label:ni.label,origins:ni.origins});function oi(e){return ai(e)}function ri(e){return e.split(";")}function si(e){if(e.length>0)throw new L(400,e.join("; "))}function li(e){return e.join(";")}const ci=({rando:e,config:t,authPolicies:i})=>B().policy(i.platformUserPolicy).expose((({database:i,statsHub:n})=>({async listApps({ownerUserId:e}){const a=r.fromString(e),o=await i.tables.apps.owners.read(d({userId:a})),s=o.length?await i.tables.apps.registrations.read({conditions:l(c(...o.map((e=>({equal:{appId:e.appId}})))),{equal:{archived:!1}})}):[];return Promise.all(s.map((async e=>({appId:e.appId.toString(),label:e.label,home:e.home,origins:ri(e.origins),platform:ei(e.appId.toString(),t),stats:await ti({users:n.countUsers(e.appId),usersActiveDaily:n.countUsersActiveDaily(e.appId),usersActiveMonthly:n.countUsersActiveMonthly(e.appId)})}))))},registerApp:async({appDraft:t,ownerUserId:n})=>(si(oi(t)),async function({rando:e,appsDatabase:t,appDraft:i,ownerUserId:n}){const a=r.fromString(n),o=e.randomId();return await Promise.all([t.tables.registrations.create({appId:o,label:i.label,home:i.home,origins:li(i.origins),archived:!1}),t.tables.owners.create({appId:o,userId:a})]),{...i,appId:o.toString(),stats:{users:1,usersActiveDaily:0,usersActiveMonthly:0}}}({rando:e,appDraft:t,ownerUserId:n,appsDatabase:_(i,(e=>e.apps))}))}))),di=({avatar:e,tagline:t,nickname:i})=>({tagline:t,nickname:i,avatar:JSON.parse(e)});async function ui({userIds:e,authTables:t,permissionsEngine:i}){if(!e.length)throw new Error("invalid: userIds cannot be empty");const n=c(...e.map((e=>({equal:{userId:e}})))),a=await t.users.accounts.read({conditions:n}),o=await t.users.profiles.read({conditions:n}),r=await i.getPublicRolesForUsers(e.map((e=>e.toString())));return e.map((function(e){const t=a.find((t=>t.userId.toString()===e.toString())),i=o.find((t=>t.userId.toString()===e.toString()));if(!t)throw new L(404,`account not found for user id ${e}`);if(!i)throw new L(404,`profile not found for user id ${e}`);const n=r.find((t=>t.userId.toString()===e.toString())).publicUserRoles,s={joined:t.created};return{userId:e.toString(),profile:di(i),roles:n,stats:s}}))}async function pi({userId:e,...t}){return(await ui({...t,userIds:[e]})).find((e=>e.userId))}function hi(e){return null!=e}function mi({timeframeStart:e,timeframeEnd:t}){const i=Date.now(),n=!!hi(e)&&i<e,a=!!hi(t)&&i>t;return!n&&!a}function fi({isPlatform:e,permissionsTables:t}){const{hardPermissions:i,mergeRoleHasPrivileges:n,getActivePrivilegeIds:a,getHardPrivilegeDetails:o}=function({isPlatform:e}){const t=e?Le:je;return{hardPermissions:t,mergeRoleHasPrivileges:function({hard:e,soft:t}){const i=[];function n(e,t){return e.roleId===t.roleId.toString()&&e.privilegeId===t.privilegeId.toString()}function a(e){return{roleId:r.fromString(e.roleId),privilegeId:r.fromString(e.privilegeId),active:e.active,immutable:e.immutable,time:0}}for(const o of t){const t=e.find((e=>n(e,o)));i.push(t&&t.immutable?a(t):o)}for(const t of e)i.find((e=>n(t,e)))||i.push(a(t));return i},getActivePrivilegeIds:function(e){return e.filter((e=>e.active)).map((e=>e.privilegeId))},getHardPrivilegeDetails:function(...e){const i=[];for(const n of e){const e=Object.entries(t.roles).find((([,e])=>e.roleId===n));if(e){const[,a]=e;for(const[e,o]of Object.entries(a.hasPrivileges)){const a=t.privileges[e];i.find((e=>e.roleId===n&&e.privilegeId===a))||i.push({privilegeId:a,roleId:n,active:o.active,immutable:o.immutable})}}}return i}}}({isPlatform:e});async function s({userIds:e,onlyGetPublicRoles:n}){const a=e=>e.public,o=e=>e,s=await(async()=>{if(0===e.length)throw new Error("invalid: user ids cannot be empty");const n=await t.userHasRole.read({conditions:c(...e.map((e=>({equal:{userId:r.fromString(e)}}))))}),a=n.map((e=>e.roleId)),o=[...(a.length?await t.role.read({conditions:c(...a.map((e=>({equal:{roleId:e}}))))}):[]).map((e=>e.roleId.toString())),...Object.entries(i.roles).map((([,e])=>e.roleId))];return n.filter((e=>o.includes(e.roleId.toString())))})();return e.map((e=>{const t=s.filter((t=>t.userId.toString()===e)),i=t.filter(mi).filter(n?a:o);return{userId:e,userHasRoles:i}}))}async function l(e){const i=await s({userIds:e,onlyGetPublicRoles:!1}),r=i.flatMap((e=>e.userHasRoles.map((e=>e.roleId)))),l=r.length?await t.roleHasPrivilege.read({conditions:c(...r.map((e=>({equal:{roleId:e}}))))}):[];return e.map((function(e){const t=i.find((t=>t.userId===e)).userHasRoles.map((e=>e.roleId.toString())),r=o(...t),s=t.flatMap((e=>l.filter((t=>t.roleId.toString()===e)))),c=a(n({hard:r,soft:s})).map((e=>e.toString()));return{userId:e,privileges:c}}))}const{getPrivileges:p,getAllPrivileges:h}=(()=>{function e(){return Object.entries(i.privileges).map((([e,t])=>({privilegeId:r.fromString(t),label:e,hard:!0,time:0})))}function n(e,t){return Xe(e,t,((e,t)=>e.privilegeId===t.privilegeId)).map((({hard:e,label:t,time:i,privilegeId:n})=>({hard:e,label:t,time:null!=i?i:0,privilegeId:n.toString()})))}return{async getPrivileges(i){const a=i.length?await t.privilege.read(u(i,(e=>({privilegeId:r.fromString(e)})))):[],o=e().filter((e=>i.includes(e.privilegeId.toString())));return n(a,o)},getAllPrivileges:async()=>n(await t.privilege.read({conditions:!1}),e())}})();return{getUsersHaveRoles:s,getAnonymousPrivileges:async function(){const e=i.roles.everybody.roleId,s=o(e),l=await t.roleHasPrivilege.read(d({roleId:r.fromString(e)}));return a(n({hard:s,soft:l})).map((e=>e.toString()))},getPrivilegesForUsers:l,getPublicRolesForUsers:async function(e){const n=await s({userIds:e,onlyGetPublicRoles:!0}),a=n.flatMap((e=>e.userHasRoles.filter((e=>e.public)).map((e=>e.roleId.toString())))),o=a.map((e=>{const t=Object.entries(i.roles).find((([,t])=>t.roleId===e));if(t){const[i,n]=t;return{roleId:r.fromString(e),label:i,hard:!0,public:n.public,assignable:n.assignable,time:0}}})).filter((e=>!!e)),l=a.length?await t.role.read({conditions:c(...a.map((e=>({equal:{roleId:r.fromString(e)}}))))}):[],d=[...o];for(const e of l){const t=d.find((t=>t.roleId===e.roleId));t||d.push(e)}return e.map((function(e){const t=n.find((t=>t.userId===e)).userHasRoles,i=t.map((e=>{const t=d.find((t=>t.roleId.toString()===e.roleId.toString()));return t||console.warn(`missing role "${e.roleId.toString()}"`),t?{...e,...t}:void 0})).filter((e=>!!e)).filter(mi).map((e=>({label:e.label,roleId:e.roleId.toString(),timeframeEnd:e.timeframeEnd,timeframeStart:e.timeframeStart})));return{userId:e,publicUserRoles:i}}))},getPermissionsDisplay:async function(){const e={conditions:!1};return ti({roles:(async()=>{const n=await t.role.read(e),a=Object.entries(i.roles).map((([e,t])=>({label:e,hard:!0,roleId:r.fromString(t.roleId),public:t.public,assignable:t.assignable,time:0})));return Xe(n,a,((e,t)=>e.roleId===t.roleId)).map((e=>{var t;return{roleId:e.roleId.toString(),assignable:e.assignable,label:e.label,hard:e.hard,public:e.public,time:null!==(t=e.time)&&void 0!==t?t:0}}))})(),privileges:h(),rolesHavePrivileges:(async()=>{const a=Object.values(i.roles).map((e=>e.roleId)),r=o(...a),s=await t.roleHasPrivilege.read(e);return n({hard:r,soft:s}).map((({active:e,privilegeId:t,immutable:i,roleId:n,time:a})=>({active:e,immutable:i,time:null!=a?a:0,roleId:n.toString(),privilegeId:t.toString()})))})()})},getPrivileges:p,getAllPrivileges:h,getUserPrivileges:async function(e){return(await l([e])).find((t=>t.userId===e)).privileges}}}const bi=e=>B().policy(e.authPolicies.anonPolicy).expose((({database:t,access:i})=>({async getUser({userId:n}){const a=fi({permissionsTables:t.tables.auth.permissions,isPlatform:i.appId===e.config.platform.appDetails.appId});return await pi({authTables:t.tables.auth,permissionsEngine:a,userId:r.fromString(n)})}}))),gi=e=>B().policy(e.authPolicies.greenPolicy).expose((({databaseRaw:t})=>({async authorize({scope:i,refreshToken:n,appId:a}){const o=r.fromString(a),s=Kt.constrainDatabaseForApp({appId:o,database:t}),l=fi({permissionsTables:s.tables.auth.permissions,isPlatform:o.toString()===e.config.platform.appDetails.appId}),c=await t.tables.apps.registrations.readOne(d({appId:o}));if(!c)throw new L(400,"incorrect app id");if(c.archived)throw new L(403,"app has been archived");if(n){const{userId:t}=await e.verifyToken(n),a=r.fromString(t),u=await pi({userId:a,permissionsEngine:l,authTables:s.tables.auth});await s.tables.auth.users.latestLogins.update({...d({userId:a}),upsert:{userId:a,time:Date.now()}});const p=await l.getUserPrivileges(a.toString());return e.signToken({lifespan:e.config.crypto.tokenLifespans.access,payload:{user:u,scope:i,permit:{privileges:p},appId:o.toString(),origins:ri(c.origins)}})}{const t=await l.getAnonymousPrivileges();return e.signToken({lifespan:e.config.crypto.tokenLifespans.access,payload:{user:void 0,appId:o.toString(),scope:i,origins:ri(c.origins),permit:{privileges:t}}})}}})));async function vi({userId:e,database:t,email:i,generateNickname:n}){const a=JSON.stringify({type:"simple",value:Math.random()});await t.tables.auth.users.profiles.create((({userId:e,avatar:t,generateNickname:i})=>({userId:e,avatar:t,tagline:"",nickname:i()}))({userId:e,avatar:a,generateNickname:n}))}const wi={everybody:qe.roles.everybody.roleId,authenticated:qe.roles.authenticated.roleId,technician:qe.roles.technician.roleId};async function yi({rando:e,email:t,databaseForApp:i,config:n,generateNickname:a}){t=t.toLowerCase();const o=i.tables.auth,s=await p(o.users.emails,d({email:t}),(async function(){const s=t===n.platform.technician.email,l=function({rando:e}){return{userId:e.randomId(),created:Date.now()}}({rando:e}),{userId:c}=l,d=o.users.accounts.create(l),u=vi({userId:c,email:t,database:i,generateNickname:a}),p=o.permissions.userHasRole.create({userId:c,hard:!0,public:!1,roleId:r.fromString(wi.everybody),timeframeEnd:void 0,timeframeStart:void 0,time:Date.now()}),h=o.permissions.userHasRole.create({userId:c,hard:!0,public:!1,roleId:r.fromString(wi.authenticated),timeframeEnd:void 0,timeframeStart:void 0,time:Date.now()}),m=s?o.permissions.userHasRole.create({userId:c,hard:!0,public:!0,timeframeEnd:void 0,roleId:r.fromString(wi.technician),timeframeStart:void 0,time:Date.now()}):Promise.resolve();return await Promise.all([d,u,p,h,m]),{email:t,userId:c}}));return{userId:s.userId}}function xi(e,t){const i=t(e);if(i.length>0)throw new L(400,i.join("; "));return e}const Ii=({rando:e,config:t,authPolicies:i,signToken:n,verifyToken:a,sendLoginEmail:o,generateNickname:s})=>B().policy(i.anonPolicy).expose((({access:i,database:l})=>({async sendLoginLink(a){const{email:c}=xi(a,ct({email:wt()})),u=c.toLowerCase(),p=r.fromString(i.appId),h=await l.tables.apps.registrations.readOne(d({appId:p})),{userId:m}=await yi({rando:e,email:u,config:t,databaseForApp:l,generateNickname:s}),f={userId:m.toString()};await o({appHome:h.home,appLabel:h.label,to:u,legalLink:t.platform.legalLink,platformLink:t.platform.appDetails.home,lifespan:t.crypto.tokenLifespans.login,loginToken:await n({payload:f,lifespan:t.crypto.tokenLifespans.login})})},async authenticateViaLoginToken({loginToken:e}){const o=l.tables.auth,s=await a(e),c=r.fromString(s.userId),u=await async function({scope:e,appId:t,userId:i,origins:n,lifespans:a,authTables:o,permissionsEngine:r,signToken:s}){const{user:l,permit:c}=await ti({user:pi({userId:i,authTables:o,permissionsEngine:r}),permit:(async()=>({privileges:await r.getUserPrivileges(i.toString())}))()});return ti({accessToken:s({payload:{appId:t,origins:n,user:l,permit:c,scope:e},lifespan:a.access}),refreshToken:s({payload:{userId:l.userId},lifespan:a.refresh})})}({userId:c,authTables:o,scope:{core:!0},appId:i.appId,origins:i.origins,lifespans:t.crypto.tokenLifespans,permissionsEngine:fi({isPlatform:i.appId===t.platform.appDetails.appId,permissionsTables:o.permissions}),signToken:n});return await o.users.latestLogins.update({...d({userId:c}),upsert:{userId:c,time:Date.now()}}),u}}))),ki=r.fromString(je.roles.admin.roleId);async function $i({email:e,rando:t,config:i,databaseForApp:n,generateNickname:a}){const{userId:o}=await yi({rando:t,email:e,config:i,databaseForApp:n,generateNickname:a});await p(n.tables.auth.permissions.userHasRole,d({userId:o,roleId:ki}),(async()=>({userId:o,roleId:ki,hard:!1,public:!0,timeframeEnd:void 0,timeframeStart:void 0,time:Date.now()})))}const Si=lt((e=>"string"!=typeof e?["must be a string"]:[]),gt(256),wt()),Pi=r.fromString(je.roles.admin.roleId),Ai=({rando:e,config:t,authPolicies:i,generateNickname:n})=>B().policy(i.appOwnerPolicy).expose((({database:i,authorizeAppOwner:a})=>({async updateApp({appId:e,appDraft:t}){si(oi(t));const n=r.fromString(e);await a(n),await i.tables.apps.registrations.update({...d({appId:n}),whole:{appId:n,home:t.home,label:t.label,origins:li(t.origins),archived:!1}})},async deleteApp({appId:e}){const t=r.fromString(e);await a(t),await i.tables.apps.registrations.update({...d({appId:t}),write:{archived:!0}})},async listAdmins({appId:e}){const t=r.fromString(e),i=await a(t),n=await i.tables.auth.permissions.userHasRole.read(d({roleId:Pi}));return(await i.tables.auth.users.emails.read(d(...n.map((({userId:e})=>({userId:e})))))).map((({userId:e,email:t})=>({userId:e.toString(),email:t})))},async assignPlatformUserAsAdmin({appId:o,platformUserId:s}){const l=r.fromString(o),c=await a(l),u=r.fromString(s),p=await i.tables.auth.users.emails.readOne(d({userId:u}));if(!p)throw new L(404,"platform email account not found");const{email:h}=p;await $i({rando:e,config:t,email:h,databaseForApp:c,generateNickname:n})},async assignAdmin({appId:i,email:o}){const s=r.fromString(i),l=await a(s),c=Si(o);if(c.length)throw new L(400,"email failed validation: "+c.join(";"));await $i({rando:e,config:t,email:o.toLowerCase(),databaseForApp:l,generateNickname:n})},async revokeAdmin({appId:e,userId:t}){const i=r.fromString(e),n=r.fromString(t),o=await a(i);await o.tables.auth.permissions.userHasRole.delete(d({userId:n,roleId:Pi}))}}))),Oi={nickname:lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(1),gt(24),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),tagline:lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(0),gt(32),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[]))},Mi=ct({...Oi}),Ci=e=>B().policy(e.authPolicies.userPolicy).expose((({access:e,database:t,checker:i})=>({async setProfile({userId:n,profileDraft:a}){const o=r.fromString(n),s=e.user.userId===n,l=i.hasPrivilege("edit any profile");if(!(s||l))throw new L(403,"forbidden: you are not allowed to edit this profile");si(Mi(a)),await t.tables.auth.users.profiles.update({...d({userId:o}),write:{nickname:a.nickname,tagline:a.tagline}})}}))),Ei=lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(1),gt(16),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),_i=({rando:e,config:t,authPolicies:i})=>B().policy((async(e,n)=>{const a=await i.userPolicy(e,n);a.checker.requirePrivilege("customize permissions");const o=fi({permissionsTables:a.database.tables.auth.permissions,isPlatform:a.access.appId===t.platform.appDetails.appId});return{...a,engine:o}})).expose((({database:t,engine:i})=>({fetchPermissions:async()=>i.getPermissionsDisplay(),async createRole({label:i}){const n=Ei(i);if(n.length)throw new L(400,`validation error on label: ${n.join("; ")}`);await t.tables.auth.permissions.role.create({label:i,hard:!1,public:!0,assignable:!0,roleId:e.randomId(),time:Date.now()})},async deleteRole({roleId:e}){const i=r.fromString(e),n=await t.tables.auth.permissions.role.readOne(d({roleId:i}));if(!n)throw new L(404,"role not found");if(n.hard)throw new L(400,"cannot delete hard role");await Promise.all([t.tables.auth.permissions.userHasRole.delete(d({roleId:i})),t.tables.auth.permissions.role.delete(d({roleId:i}))])},async assignPrivilege({roleId:e,privilegeId:i}){const n=r.fromString(e),a=r.fromString(i);await t.tables.auth.permissions.roleHasPrivilege.update({...d({roleId:n,privilegeId:a}),upsert:{roleId:n,privilegeId:a,active:!0,immutable:!1,time:Date.now()}})},async unassignPrivilege({roleId:e,privilegeId:i}){const n=r.fromString(e),a=r.fromString(i);await t.tables.auth.permissions.roleHasPrivilege.update({...d({roleId:n,privilegeId:a}),upsert:{roleId:n,privilegeId:a,active:!1,immutable:!1,time:Date.now()}})},async createPrivilege({label:i}){const n={label:i,hard:!1,privilegeId:e.randomId(),time:Date.now()};return await t.tables.auth.permissions.privilege.create(n),{hard:n.hard,label:n.label,privilegeId:n.privilegeId.toString(),time:Date.now()}},async deletePrivilege({privilegeId:e}){const n=r.fromString(e),[a]=await i.getPrivileges([n.toString()]);if(!a)throw new L(400,`cannot delete missing privilege "${a.privilegeId.toString()}"`);if(a.hard)throw new L(400,`cannot delete hard privilege "${a.privilegeId.toString()}"`);await Promise.all([t.tables.auth.permissions.roleHasPrivilege.delete(d({privilegeId:n})),t.tables.auth.permissions.privilege.delete(d({privilegeId:n}))])}})));const Ri=ct({offset:lt((e=>"number"!=typeof e?["must be a number"]:[]),ht(0)),limit:lt((e=>"number"!=typeof e?["must be a number"]:[]),ht(0),mt(100))}),Ti=({config:e,basePolicy:t})=>B().policy((async(e,i)=>{const n=await t(e,i);return{...n,notesDatabase:_(n.database,(e=>e.notes))}})).expose((({notesDatabase:e,access:t})=>({async getNotesStats(){const{userId:i}=t.user;return{newCount:await e.tables.notes.count(d({to:r.fromString(i),old:!1})),oldCount:await e.tables.notes.count(d({to:r.fromString(i),old:!0}))}},async getNewNotes(i){const{offset:n,limit:a}=xi(i,Ri),{userId:o}=t.user;return(await e.tables.notes.read({...d({to:r.fromString(o),old:!1}),offset:n,limit:a,order:{time:"descend"}})).map((e=>({type:"message",noteId:e.noteId.toString(),time:e.time,old:e.old,from:void 0,to:e.to.toString(),text:e.text,title:e.title,details:{}})))},async getOldNotes(i){const{offset:n,limit:a}=xi(i,Ri),{userId:o}=t.user;return(await e.tables.notes.read({...d({to:r.fromString(o),old:!0}),offset:n,limit:a,order:{time:"descend"}})).map((e=>({type:"message",noteId:e.noteId.toString(),time:e.time,old:e.old,from:void 0,to:e.to.toString(),text:e.text,title:e.title,details:{}})))},async markAllNotesOld(){const{userId:i}=t.user;await e.tables.notes.update({...d({to:r.fromString(i),old:!1}),write:{old:!0}})},async markNotesNewOrOld(i){const{userId:n}=t.user,{old:a,noteIds:o}=xi(i,ct({old:e=>"boolean"!=typeof e?["must be a boolean"]:[],noteIds:lt(ft(),gt(1e3),ut(yt))})),s=o.map((e=>r.fromString(e))),l=await e.tables.notes.read(u(s,(e=>({noteId:e}))));for(const e of l)if(n!==e.to.toString())throw new L(403,`user is not privileged for note ${e.to.toString()}`);await e.tables.notes.update({...u(s,(e=>({noteId:e}))),write:{old:a}})}})));function Di({config:e,authPolicies:t}){return{notesService:Ti({config:e,basePolicy:t.userPolicy})}}const qi="good",Li=lt(lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(16),gt(64),(e=>/\s/.test(e)?["must not have any spaces"]:[]))),ji=e=>e===qi?[]:Li(e);function Ui(e,t){function i(e){return"string"==typeof e?e:String(e)}function n(i){return e.privileges.includes(t[i])}return{hasPrivilege:n,requirePrivilege:function(e){if(!n(e))throw new L(403,`forbidden; privilege required "${i(e)}"`)},requireNotHavePrivilege:function(e){if(n(e))throw new L(403,`forbidden: must not have privilege "${i(e)}"`)}}}function Ni(e){return e?{time:e.time}:void 0}const zi=({config:e,dacastSdk:t,basePolicy:i})=>B().policy((async(t,n)=>{const a=await i(t,n);r.fromString(a.access.appId);const o=Ui(a.access.permit,Me);o.requirePrivilege("moderate videos");const s=fi({isPlatform:a.access.appId===e.platform.appDetails.appId,permissionsTables:a.database.tables.auth.permissions});return{...a,checker:o,engine:s}})).expose((({database:e})=>({getLink:async()=>Ni(await e.tables.videos.dacastAccountLinks.readOne({conditions:!1})),async setLink(i){const{apiKey:n}=xi(i,ct({apiKey:ji}));let a;return await t.verifyApiKey(n)&&(a={apiKey:n,time:Date.now()},await e.tables.videos.dacastAccountLinks.update({conditions:!1,upsert:a})),Ni(a)},async clearLink(){await e.tables.videos.dacastAccountLinks.delete({conditions:!1})}})));function Bi({type:e,data:t}){var i,n;const a=(null!==(i=t.pictures)&&void 0!==i?i:[])[0];return{type:e,thumb:a?(null!==(n=a.thumbnail)&&void 0!==n?n:[])[0]:void 0,id:t.id,title:t.title,provider:"dacast"}}async function Vi({videoTables:e}){const t=await e.viewDacast.read({conditions:!1}),i=await e.viewPrivileges.read({conditions:!1});return t.map((e=>{const t=i.filter((t=>t.label===e.label)).map((e=>e.privilegeId.toString()));return{id:e.dacastId,label:e.label,privileges:t,provider:"dacast",type:e.type}}))}const Wi="iframe";async function Hi({dacast:e,reference:{id:t,type:i}}){switch(i){case"vod":return e.vods.id(t).embed(Wi).get();case"channel":return e.channels.id(t).embed(Wi).get();case"playlist":return e.playlists.id(t).embed(Wi).get();default:throw new Error(`unknown dacast type "${i}"`)}}async function Fi(e){const t=await e.dacastAccountLinks.readOne({conditions:!1});return t?t.apiKey:void 0}async function Qi({access:e,platformAppId:t,permissionsTables:i}){const n=fi({permissionsTables:i,isPlatform:e.appId===t});return(await n.getPermissionsDisplay()).privileges}async function Xi({dacast:e,reference:{provider:t,type:i,id:n}}){if("dacast"!==t)throw new L(500,`video content provider mismatch (expected "dacast", got "${t}")`);switch(i){case"vod":return e.vods.id(n).get();case"channel":return e.channels.id(n).get();case"playlist":return e.playlists.id(n).get();default:throw new L(500,`unknown dacast type "${i}"`)}}const Ki=({config:e,dacastSdk:t,basePolicy:i})=>B().policy((async(t,n)=>{const a=await i(t,n),o=Ui(a.access.permit,Me),r=fi({isPlatform:a.access.appId===e.platform.appDetails.appId,permissionsTables:a.database.tables.auth.permissions});return{...a,engine:r,checker:o}})).expose((({access:i,database:n,checker:a,engine:o})=>({fetchModerationData:async()=>(a.requirePrivilege("moderate videos"),ti({views:Vi({videoTables:n.tables.videos}),privileges:Qi({access:i,permissionsTables:n.tables.auth.permissions,platformAppId:e.platform.appDetails.appId}),catalog:Fi(n.tables.videos).then((async e=>e?async function({dacast:e}){const t=await ti({vods:e.vods.get(),channels:e.channels.get(),playlists:e.playlists.get()});function i(e,t){var i;return(null!==(i=null==t?void 0:t.data)&&void 0!==i?i:[]).map((t=>Bi({type:e,data:t})))}return[...i("vod",t.vods),...i("channel",t.channels),...i("playlist",t.playlists)]}({dacast:t.getClient(e)}):[]))})),async writeView({label:e,privileges:t,reference:i}){a.requirePrivilege("moderate videos"),await n.tables.videos.viewDacast.update({...d({label:e}),whole:{label:e,type:i.type,dacastId:i.id}}),await async function({label:e,engine:t,videoTables:i,privileges:n}){await i.viewPrivileges.delete(d({label:e}));const a=await t.getPrivileges(n).then((e=>e.filter((e=>!!e)).map((e=>e.privilegeId.toString()))));await i.viewPrivileges.create(...a.map((t=>({label:e,privilegeId:r.fromString(t)}))))}({label:e,engine:o,privileges:t,videoTables:n.tables.videos})},async deleteView({label:e}){a.requirePrivilege("moderate videos"),await n.tables.videos.viewDacast.delete(d({label:e})),await n.tables.videos.viewPrivileges.delete(d({label:e}))},async getShows({labels:e}){const o=await Fi(n.tables.videos);if(!o)return[];const r=await async function({labels:e,videoTables:t,checker:i,userPrivileges:n}){if(0===e.length)return[];const a=await t.viewDacast.read(u(e,(e=>({label:e})))),o=await t.viewPrivileges.read(u(e,(e=>({label:e}))));return e.map((e=>{const t=o.filter((t=>t.label===e)).map((e=>e.privilegeId.toString())),r=function({viewPrivileges:e,userPrivileges:t}){for(const i of e){const e=t.find((e=>e===i));if(e)return!0}return!1}({viewPrivileges:t,userPrivileges:n}),s=r||i.hasPrivilege("view all videos")||i.hasPrivilege("moderate videos"),l=a.find((t=>t.label===e));return s&&l?{type:l.type,label:e,privileges:t,id:l.dacastId,provider:"dacast"}:void 0}))}({labels:e,checker:a,videoTables:n.tables.videos,userPrivileges:i.permit.privileges}),s=t.getClient(o);return Promise.all(r.map((async(t,i)=>{const n=e[i];if(!t)return{label:n,details:void 0};const[a,o]=await Promise.all([Xi({dacast:s,reference:t}),Hi({dacast:s,reference:t})]);return{label:n,details:a?{...Bi({type:t.type,data:a}),embed:null==o?void 0:o.code}:null}})))}})));function Yi({config:e,authPolicies:t,dacastSdk:i}){const n={config:e,basePolicy:t.anonPolicy};return{dacastService:zi({...n,dacastSdk:i}),contentService:Ki({...n,dacastSdk:i})}}const Gi=({rando:e,authPolicies:t})=>B().policy((async(e,i)=>{const n=await t.userPolicy(e,i);return{...n,database:_(n.database,(e=>e.example))}})).expose((({database:t})=>({async exampleFunction({something:i}){await t.tables.examplePosts.create({exampleId:e.randomId(),something:i})}})));function Ji(e){return{exampleService:Gi(e)}}async function Zi({userId:e,itemIds:t,likesTable:i,reportsTable:n}){const a=await en({itemIds:t,voteTable:i}),o=await en({itemIds:t,voteTable:n});return{getVotingDetails:t=>({likes:a.countVotes(t),reports:o.countVotes(t),liked:!!e&&a.voteStatus({userId:e,itemId:t}),reported:!!e&&o.voteStatus({userId:e,itemId:t})})}}async function en({itemIds:e,voteTable:t}){const i=e.length?await t.read(u(e,(e=>({itemId:e})))):[];return{countVotes:e=>i.filter((t=>t.itemId.toString()===e.toString())).length,voteStatus({userId:e,itemId:t}){const n=i.filter((t=>t.userId.toString()===e.toString())),a=!!n.find((e=>e.itemId.toString()===t.toString()));return a}}}function tn({authPolicies:e}){return async(t,i)=>{const n=await e.userPolicy(t,i);return{...n,database:_(n.database,(e=>({auth:e.auth,questions:e.questions})))}}}const nn=e=>B().policy((async(t,i)=>{const n=await function({authPolicies:e}){return async(t,i)=>{const n=await e.anonPolicy(t,i);return{...n,database:_(n.database,(e=>({auth:e.auth,questions:e.questions})))}}}(e)(t,i);return n.checker.requirePrivilege("read questions"),n})).expose((({access:t,database:i})=>({async fetchQuestions({board:n}){var a;const o=await i.tables.questions.questionPosts.read({...d({board:n,archive:!1}),limit:100,offset:0,order:{timePosted:"descend"}});if(!o.length)return{users:[],questions:[]};const s=await async function({userId:e,questionPosts:t,questionsTables:i}){const n=t.map((e=>e.questionId)),a=n.length?await i.answerPosts.read(u(n,(e=>({questionId:e,archive:!1})))):[],o=a.map((e=>e.answerId)),r={userId:e,likesTable:i.likes,reportsTable:i.reports},s=await Zi({...r,itemIds:n}),l=await Zi({...r,itemIds:o});return n.map((e=>{const i=t.find((t=>t.questionId===e));return{archive:i.archive,authorUserId:i.authorUserId.toString(),questionId:i.questionId.toString(),board:i.board,content:i.content,timePosted:i.timePosted,...s.getVotingDetails(e),answers:a.filter((t=>t.questionId.toString()===e.toString())).map((e=>({answerId:e.answerId.toString(),questionId:e.questionId.toString(),authorUserId:e.authorUserId.toString(),content:e.content,archive:e.archive,timePosted:e.timePosted,...l.getVotingDetails(e.answerId)})))}}))}({questionsTables:i.tables.questions,questionPosts:o,userId:(null===(a=null==t?void 0:t.user)||void 0===a?void 0:a.userId)?r.fromString(t.user.userId):void 0}),l=(()=>{const e=[],t=t=>{e.includes(t)||e.push(t)};for(const e of s){t(e.authorUserId);for(const i of e.answers)t(i.authorUserId)}return e})(),c=fi({permissionsTables:i.tables.auth.permissions,isPlatform:t.appId===e.config.platform.appDetails.appId}),p=(await c.getPrivilegesForUsers(l)).filter((e=>e.privileges.includes(je.privileges.banned))).map((e=>e.userId)),h=(await ui({authTables:i.tables.auth,permissionsEngine:c,userIds:l.map((e=>r.fromString(e)))})).filter((e=>!p.includes(e.userId))),m=s.filter((e=>!p.includes(e.authorUserId.toString()))).map((e=>({...e,answers:e.answers.filter((e=>!p.includes(e.authorUserId)))})));return{users:h,questions:m}}})));async function an({status:e,userId:t,itemId:i,voteTable:n}){const a=await n.count(d({userId:t,itemId:i}))>0;!a&&e?await n.create({userId:t,itemId:i}):a&&!e&&await n.delete(d({userId:t,itemId:i}))}const on=1*ie;const rn=lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(10),gt(280),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),sn=ct({board:lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(1),gt(32),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),content:rn}),ln=ct({content:rn});const cn=e=>B().policy((async(t,i)=>{const n=await tn(e)(t,i);n.checker.requireNotHavePrivilege("banned");const a=n.checker.hasPrivilege("post questions"),o=n.checker.hasPrivilege("moderate questions");if(!(a||o))throw new L(403,"not allowed to post questions");return n})).expose((({access:t,database:i,checker:n})=>({async postQuestion(n){const{questionDraft:a}=xi(n,ct({questionDraft:sn}));await async function({userId:e,database:t}){if(await t.tables.questions.questionPosts.count({conditions:l({equal:{authorUserId:e,archive:!1}},{greater:{timePosted:Date.now()-on}})})>10)throw new L(429,"too many posts")}({database:i,userId:r.fromString(t.user.userId)});const o={questionId:e.rando.randomId(),authorUserId:r.fromString(t.user.userId),archive:!1,timePosted:Date.now(),...a};return await i.tables.questions.questionPosts.create(o),{archive:o.archive,authorUserId:o.authorUserId.toString(),questionId:o.questionId.toString(),content:o.content,timePosted:o.timePosted,board:o.board,likes:0,reports:0,liked:!1,reported:!1,answers:[]}},async archiveQuestion(e){const{archive:a,questionId:o}=xi(e,ct({archive:e=>"boolean"!=typeof e?["must be a boolean"]:[],questionId:yt})),s=r.fromString(o),l=await i.tables.questions.questionPosts.readOne(d({questionId:s}));!function({userId:e,questionPost:t,checker:i}){const n=i.hasPrivilege("moderate questions"),a=t.authorUserId.toString()===e;if(!n&&!a)throw new Error("user is not authorized to edit question")}({userId:t.user.userId,checker:n,questionPost:l}),await i.tables.questions.questionPosts.update({...d({questionId:s}),write:{archive:!!a}})},async likeQuestion(e){const{like:a,questionId:o}=xi(e,ct({like:e=>"boolean"!=typeof e?["must be a boolean"]:[],questionId:yt}));n.requirePrivilege("like questions"),await an({status:a,voteTable:i.tables.questions.likes,userId:r.fromString(t.user.userId),itemId:r.fromString(o)})},async reportQuestion(e){const{report:a,questionId:o}=xi(e,ct({report:e=>"boolean"!=typeof e?["must be a boolean"]:[],questionId:yt}));n.requirePrivilege("report questions"),await an({status:a,voteTable:i.tables.questions.reports,userId:r.fromString(t.user.userId),itemId:r.fromString(o)})}})));const dn=e=>B().policy((async(t,i)=>{const n=await tn(e)(t,i);n.checker.requireNotHavePrivilege("banned");const a=n.checker.hasPrivilege("answer questions"),o=n.checker.hasPrivilege("moderate questions");if(!(a||o))throw new L(403,"not allowed to post questions");return n})).expose((({access:t,database:i,checker:n})=>({async postAnswer(n){const{questionId:a,answerDraft:o}=xi(n,ct({questionId:yt,answerDraft:ln})),s=r.fromString(a),c=await i.tables.questions.questionPosts.readOne(d({questionId:s}));if(!c)throw new L(400,"unknown questionId");const u=r.fromString(t.user.userId);await async function({userId:e,questionId:t,database:i}){if(await i.tables.questions.answerPosts.count({conditions:l({equal:{authorUserId:e,questionId:t,archive:!1}},{greater:{timePosted:Date.now()-on}})})>10)throw new L(429,"too many posts")}({userId:u,database:i,questionId:s});const p={questionId:s,answerId:e.rando.randomId(),authorUserId:u,archive:!1,timePosted:Date.now(),board:c.board,...o};await i.tables.questions.answerPosts.create(p);return{answerId:p.answerId.toString(),questionId:p.questionId.toString(),authorUserId:p.authorUserId.toString(),content:p.content,timePosted:p.timePosted,liked:!1,likes:0,archive:!1,reported:!1,reports:0}},async archiveAnswer(e){const{archive:a,answerId:o}=xi(e,ct({archive:e=>"boolean"!=typeof e?["must be a boolean"]:[],answerId:yt})),s=r.fromString(o),l=await i.tables.questions.answerPosts.readOne(d({answerId:s}));!function({userId:e,answerPost:t,checker:i}){const n=i.hasPrivilege("moderate questions"),a=t.authorUserId.toString()===e;if(!n&&!a)throw new Error("user is not authorized to edit answer")}({userId:t.user.userId,checker:n,answerPost:l}),await i.tables.questions.answerPosts.update({...d({answerId:s}),write:{archive:a}})},async likeAnswer(e){const{like:a,answerId:o}=xi(e,ct({like:e=>"boolean"!=typeof e?["must be a boolean"]:[],answerId:yt}));n.requirePrivilege("like questions"),await an({status:a,voteTable:i.tables.questions.likes,userId:r.fromString(t.user.userId),itemId:r.fromString(o)})},async reportAnswer(e){const{report:a,answerId:o}=xi(e,ct({report:e=>"boolean"!=typeof e?["must be a boolean"]:[],answerId:yt}));n.requirePrivilege("report questions"),await an({status:a,voteTable:i.tables.questions.reports,userId:r.fromString(t.user.userId),itemId:r.fromString(o)})}}))),un=e=>B().policy((async(t,i)=>{const n=await tn(e)(t,i);return n.checker.requirePrivilege("moderate questions"),n.checker.requireNotHavePrivilege("banned"),n})).expose((({database:e})=>({async archiveBoard({board:t}){await e.tables.questions.questionPosts.update({...d({board:t}),write:{archive:!0}})},async fetchReportedQuestions(){}})));function pn(e){return{questionsReadingService:nn(e),questionsPostingService:cn(e),questionsAnsweringService:dn(e),questionsModerationService:un(e)}}function hn({config:e,databaseRaw:t,verifyToken:i}){const n=function({database:e}){return async function(t){async function i(i){if((await e.tables.apps.owners.readOne(d({appId:i}))).userId.toString()!==t.toString())throw new L(403,"forbidden")}return{countUsers:async t=>(await i(t),e.tables.auth.users.accounts.constrainForApp(t).count({conditions:!1})),countUsersActiveDaily:async t=>{await i(t);const n=Date.now()-ie;return e.tables.auth.users.latestLogins.constrainForApp(t).count({conditions:l({greater:{time:n}})})},countUsersActiveMonthly:async t=>{await i(t);const n=Date.now()-2628e6;return e.tables.auth.users.latestLogins.constrainForApp(t).count({conditions:l({greater:{time:n}})})}}}}({database:t}),a=async({accessToken:e},n)=>{const a=await i(e);if(a.origins.some((e=>e===n.origin)))return{access:a,database:Kt.constrainDatabaseForApp({appId:r.fromString(a.appId),database:t}),checker:Ui(a.permit,je.privileges)};throw new L(403,"request origin not allowed")},o=async(e,t)=>{const i=await a(e,t);if(i.access.user)return i;throw new L(403,"not logged in")},s=async(i,a)=>{const s=await o(i,a),l=r.fromString(s.access.user.userId);if(s.access.appId===e.platform.appDetails.appId)return{...s,databaseRaw:t,checker:Ui(s.access.permit,Le.privileges),statsHub:await n(l)};throw new L(403,"not platform app")};return{greenPolicy:async e=>({databaseRaw:t}),anonPolicy:a,userPolicy:o,platformUserPolicy:s,appOwnerPolicy:async(e,i)=>{const n=await s(e,i),a=t.tables.apps;return{access:n.access,database:n.database,checker:n.checker,statsHub:n.statsHub,databaseRaw:t,async authorizeAppOwner(e){const i=n.checker.hasPrivilege("edit any app"),o=async function({appId:e,access:t,appTables:i}){const{userId:n}=t.user,a=r.fromString(n);return!!await i.owners.readOne(d({userId:a,appId:e}))}({appId:e,appTables:a,access:n.access});if(o||i)return Kt.constrainDatabaseForApp({appId:e,database:t});throw new L(403,"forbidden: lacking privileges to edit app")}}}}}const mn=dt((e=>null!=e?["must be undefined or null"]:[]),(e=>"number"!=typeof e?["must be a number"]:[])),fn=lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(1),gt(64)),bn=({config:e,authPolicies:t})=>B().policy((async(i,n)=>{const a=await t.userPolicy(i,n);a.checker.requirePrivilege("administrate user roles");const o=fi({permissionsTables:a.database.tables.auth.permissions,isPlatform:a.access.appId===e.platform.appDetails.appId});return{...a,engine:o}})).expose((({engine:e,database:t})=>({fetchPermissions:async()=>e.getPermissionsDisplay(),async searchUsers(i){const{term:n}=xi(i,ct({term:fn})),a=new RegExp(n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i");const o=(await t.tables.auth.users.profiles.read({limit:100,conditions:r.isId(n)?c({equal:{userId:r.fromString(n)}}):c({search:{nickname:a}},{search:{tagline:a}})})).map((e=>e.userId));if(!o.length)return[];const s=await ui({userIds:o,permissionsEngine:e,authTables:t.tables.auth}),l=await e.getUsersHaveRoles({userIds:s.map((e=>e.userId)),onlyGetPublicRoles:!1});return s.map((e=>({user:e,roleIds:l.find((t=>t.userId===e.userId)).userHasRoles.map((e=>e.roleId.toString()))})))},async assignRoleToUser(e){const{roleId:i,userId:n,isPublic:a,timeframeEnd:o,timeframeStart:s}=xi(e,ct({roleId:yt,userId:yt,isPublic:e=>"boolean"!=typeof e?["must be a boolean"]:[],timeframeEnd:mn,timeframeStart:mn})),l=r.fromString(i),c=r.fromString(n),u=await t.tables.auth.permissions.userHasRole.readOne(d({userId:c,roleId:l}));if(null==u?void 0:u.hard)throw new L(400,"hard role assignment cannot be overwritten");await p(t.tables.auth.permissions.userHasRole,d({roleId:l,userId:c}),(async()=>({hard:!1,public:a,roleId:l,userId:c,timeframeEnd:o,timeframeStart:s,time:Date.now()})))},async revokeRoleFromUser(e){const{roleId:i,userId:n}=xi(e,ct({roleId:yt,userId:yt})),a=r.fromString(i),o=r.fromString(n),s=await t.tables.auth.permissions.userHasRole.readOne(d({userId:o,roleId:a}));if(null==s?void 0:s.hard)throw new L(400,"hard role assignment cannot be overwritten");await t.tables.auth.permissions.userHasRole.delete({conditions:c({equal:{roleId:a,userId:o}})})}})));function gn(e){return{roleAssignmentService:bn(e)}}const vn={colors:["Red","Yellow","Green","Cyan","Blue","Magenta","Dark","Grey","Silver","Bright","Light","Gold","Golden","Aqua","Minty"],animals:["Aardvark","Mongoose","Alligator","Robin","Monkey","Seahorse","Shark","Leopard","Eagle","Raven","Owl","Hawk","Duck","Wolf","Coyote","Dingo","Ostrich","Llama","Alpaca","Zebra","Bear","Kiwi","Penguin","Otter","Dolphin","Starfish","Sunfish","Salmon","Swordfish","Sparrow","Turtle","Puppy","Kitten"],adjectives:["Funny","Charming","Wonderful","Fancy","Whimsical","Gregarious","Curious","Fabulous","Saavy","Groovy","Happy","Snappy","Quick","Super","Fast","Fuzzy","Clever","Genius","Marvelous","Eccentric","Fantastic","Quaint","Young","Wise","Creative","Helpful","Nice","Sincere","Loyal","Honest","Truthful","Thoughtful","Clean","Friendly","Gentle","Pleasant","Brilliant","Polite","Original","Ambitious","Lively","Wholesome","Cordial","Eager","Relaxed","Skilled","Tidy","Calm","Hopeful","Positive","Social","Quick","Fearless","Daring","Bold","Quiet"]};async function wn({storeDatabaseUnconnected:e}){const t=await e.tables.connect.active.readOne({conditions:!1});if(!t)return{connectDetails:void 0,connectId:void 0};const i=await e.tables.connect.accounts.readOne(d({connectId:t.connectId}));return{connectDetails:{userId:i.userId.string,stripeAccountId:i.stripeAccountId,email:i.email,paused:i.paused,timeLinked:i.time,payouts_enabled:i.payouts_enabled,charges_enabled:i.charges_enabled,details_submitted:i.details_submitted},connectId:t.connectId}}function yn(e,t){const{connect:i,...n}=e;return{connect:i,...T({constraint:t,tables:n})}}function xn(e){return e?function(e){return e.details_submitted&&e.charges_enabled}(e)?e.paused?et.Paused:et.Ready:et.Incomplete:et.Unlinked}const In=e=>e&&("string"==typeof e?e:e.id);function kn(e){return{stripePriceId:e.id,price:e.unit_amount,currency:e.currency,interval:e.recurring.interval}}function $n(e){var t,i,n;return![null==e?void 0:e.active,null==e?void 0:e.recurring,"licensed"===(null===(t=null==e?void 0:e.recurring)||void 0===t?void 0:t.usage_type),"month"===(null===(i=null==e?void 0:e.recurring)||void 0===i?void 0:i.interval)||"year"===(null===(n=null==e?void 0:e.recurring)||void 0===n?void 0:n.interval)].some((e=>!e))}function Sn(e,t,i){return{tierId:e.tierId.string,roleId:e.roleId.string,label:i.name,time:e.time,active:i.active,pricing:$n(t)?[kn(t)]:void 0}}function Pn(e){const{stripeLiaison:t,anonPolicy:i}=e;async function n(e,n){const a=await i(e,n),{connectId:o,connectDetails:r}=await wn(a);if(xn(r)!==et.Ready)throw new L(400,"stripe account is not connected, and this action requires it");const{stripeAccountId:s}=r,l=t.account(s),c=function({tables:e,transaction:t},i){const n={connectId:i};return{tables:yn(e,n),transaction:async e=>t((async({tables:t,...i})=>e({tables:yn(t,n),...i})))}}(a.storeDatabaseUnconnected,o);return{...a,connectId:o,stripeAccountId:s,stripeLiaisonAccount:l,storeDatabase:c}}return{guest:i,connected:n,customer:async function(e,t){const i=await n(e,t);if(!i.access.user)throw new L(400,"user must be logged in");const a=r.fromString(i.access.user.userId);let o=await i.storeDatabase.tables.customers.readOne(d({userId:a}));if(!o){const{id:e}=await i.stripeLiaisonAccount.customers.create({});o={userId:a,stripeCustomerId:e},await i.storeDatabase.tables.customers.create(o)}const{stripeCustomerId:s}=o;return{...i,stripeCustomerId:s}},merchant:async function(t,i){const a=await n(t,i);a.checker.requirePrivilege("manage store");const{connectDetails:o}=await wn(a);if(xn(o)!==et.Ready)throw new L(400,"stripe connect status not ready");const s=(({storeDatabase:e,stripeLiaisonAccount:t,roleManager:i,generateId:n})=>{const a=e.tables;async function o({productLabel:e,pricing:i}){const{id:n}=await t.products.create({name:e}),{id:a}=await t.prices.create({active:!0,product:n,currency:i.currency,unit_amount:i.price,recurring:{interval:i.interval}});return await t.products.update(n,{default_price:a}),{stripeProductId:n,stripePriceId:a}}return{async createPlanAndTier({planLabel:e,tier:t}){const r=n(),s=n(),{roleId:l}=await i.createPrivateSystemRole({label:t.label});await a.subscriptions.plans.create({planId:r,label:e,time:Date.now(),archived:!1});const{stripeProductId:c,stripePriceId:d}=await o({productLabel:t.label,pricing:t.pricing});return await a.subscriptions.tiers.create({tierId:s,planId:r,roleId:l,time:Date.now(),stripeProductId:c}),{planId:r,tierId:s,stripePriceId:d,tierRoleId:l,time:Date.now()}},async createTierForPlan({planId:e,label:t,pricing:s}){const l=await a.subscriptions.plans.readOne(d({planId:r.fromString(e)}));if(!l)throw new Error(`unknown subscription plan ${e}`);const{stripeProductId:c,stripePriceId:u}=await o({productLabel:t,pricing:s}),{roleId:p}=await i.createPrivateSystemRole({label:t}),h=Date.now(),m=n();return await a.subscriptions.tiers.create({time:h,tierId:m,roleId:p,stripeProductId:c,planId:l.planId}),{tierId:m,roleId:p,time:h,stripePriceId:u}},async updatePlan({planId:e,label:t,archived:i}){const n=r.fromString(e);if(!await a.subscriptions.plans.readOne(d({planId:n})))throw new L(400,`unable to find plan ${e}`);await a.subscriptions.plans.update({...d({planId:n}),write:{label:t,archived:i}})},async updateTier({tierId:e,label:n,active:o,pricing:s}){const l=r.fromString(e),c=await a.subscriptions.tiers.readOne(d({tierId:l}));if(!c)throw new L(400,`tier not found ${e}`);if(!await i.readRole(c.roleId))throw new L(400,`role not found ${c.roleId.string}`);let{stripeProductId:u}=c,p=await t.products.retrieve(u);if(!p)throw new L(500,`stripe product not found ${u}`);const h=In(p.default_price);let m;h&&(m=await t.prices.retrieve(h));const f=s.price!==(null==m?void 0:m.unit_amount)||s.currency!==(null==m?void 0:m.currency)||s.interval!==(null==m?void 0:m.recurring.interval);m&&!f||(m=await t.prices.create({active:o,product:u,currency:s.currency,unit_amount:s.price,recurring:{interval:s.interval}}),p=await t.products.update(u,{default_price:m.id}));const b=n!==p.name,g=o!==p.active;return(b||g)&&(p=await t.products.update(u,{active:o,name:n})),await i.updateRole({label:n,roleId:c.roleId}),Sn(c,m,p)}}})({...e,...a});return{...a,helpers:s}}}}function An(e){return new URLSearchParams({...e}).toString()}var On;async function Mn({stripeLiaisonAccount:e,stripeCustomerId:t}){const i=await e.customers.retrieve(t),n=In(i.invoice_settings.default_payment_method);return n&&await e.paymentMethods.retrieve(n)}!function(e){e.connect=function({popupReturnUrl:e,generateId:t}){const i=t().string;return{popupId:i,return_url:`${e}?${An({popupId:i,status:"return"})}`,refresh_url:`${e}?${An({popupId:i,status:"refresh"})}`}},e.login=function({generateId:e}){return{popupId:e().string}},e.openCustomerPortal=function({generateId:e,popupReturnUrl:t}){const i=e().string;return{popupId:i,return_url:`${t}?${An({popupId:i,status:"return"})}`}},e.checkout=function({popupReturnUrl:e,generateId:t}){const i=t().string;return{popupId:i,success_url:`${e}?${An({popupId:i,status:"success"})}`,cancel_url:`${e}?${An({popupId:i,status:"cancel"})}`}}}(On||(On={}));const Cn=e=>B().policy(e.storePolicies.customer).expose((t=>({getDefaultPaymentMethod:async()=>function(e){const{card:t}=null!=e?e:{};return t?{cardClues:{brand:t.brand,country:t.country,expireMonth:t.exp_month,expireYear:t.exp_year,last4:t.last4}}:void 0}(await Mn(t)),async generateCustomerPortalLink(){const{popupId:i,return_url:n}=On.openCustomerPortal(e),a=await t.stripeLiaisonAccount.billingPortal.create({customer:t.stripeCustomerId,return_url:n});return{popupId:i,customer:a.customer,stripeSessionUrl:a.url,stripeAccountId:t.stripeAccountId}}})));const En=function(e,t,i){return Vt(i,(i=>async(...n)=>(e.requirePrivilege(t),i(...n))))};async function _n({access:e,stripeLiaison:t,storeDatabaseUnconnected:i,generateId:n}){const{connectDetails:a}=await wn({storeDatabaseUnconnected:i});if(!a){const{id:a}=await t.accounts.create({type:"standard"});await async function({access:e,stripeAccountId:t,storeDatabaseUnconnected:i,generateId:n}){const a=n(),o=r.fromString(e.user.userId);return await i.transaction((async({tables:e})=>{await e.connect.accounts.create({connectId:a,stripeAccountId:t,charges_enabled:!1,payouts_enabled:!1,details_submitted:!1,email:void 0,userId:o,paused:!1,time:Date.now()}),await async function({connectId:e,storeConnectTables:t}){await t.active.update({conditions:!1,upsert:{connectId:e}})}({connectId:a,storeConnectTables:e.connect})})),{connectId:a,stripeAccountId:t}}({access:e,stripeAccountId:a,storeDatabaseUnconnected:i,generateId:n})}return(await wn({storeDatabaseUnconnected:i})).connectDetails}const Rn=e=>B().policy(e.storePolicies.guest).expose((({access:t,stripeLiaison:i,storeDatabaseUnconnected:n,checker:a})=>({async loadConnectStatus(){const{connectDetails:e}=await wn({storeDatabaseUnconnected:n});return xn(e)},...En(a,"manage store",{async pause(){const{connectDetails:e}=await wn({storeDatabaseUnconnected:n}),{stripeAccountId:t}=e;if(xn(e)!==et.Ready)throw new L(400,"cannot pause non-ready stripe account");await n.tables.connect.accounts.update({...d({stripeAccountId:t}),write:{paused:!0}})},async resume(){const{connectDetails:e}=await wn({storeDatabaseUnconnected:n}),{stripeAccountId:t}=e;if(xn(e)!==et.Paused)throw new L(400,"cannot resume non-paused stripe account");await n.tables.connect.accounts.update({...d({stripeAccountId:t}),write:{paused:!1}})}}),...En(a,"control stripe account",{async loadConnectDetails(){const{connectDetails:e}=await wn({storeDatabaseUnconnected:n});return{connectDetails:e,connectStatus:xn(e)}},async generatePopupForStripeAccountOnboarding(){const a=await _n({access:t,stripeLiaison:i,storeDatabaseUnconnected:n,generateId:e.generateId}),{stripeAccountId:o}=a;if(!function(e,t){return e.user.userId===t.userId}(t,a))throw new L(400,"only the owner of the stripe account can onboard it");return async function({type:e,options:t,stripeLiaison:i,stripeAccountId:n}){const{popupId:a,...o}=On.connect(t),{url:r}=await i.accountLinks.create({type:e,account:n,...o});return{popupId:a,stripeAccountId:n,stripeAccountSetupLink:r}}({options:e,stripeLiaison:i,stripeAccountId:o,type:"account_onboarding"})},async generateStripeLoginLink(){const{connectDetails:t}=await wn({storeDatabaseUnconnected:n}),i=null==t?void 0:t.stripeAccountId;return i?{stripeLoginLink:`https://dashboard.stripe.com/b/${i}`,popupId:On.login(e).popupId}:void 0}})})));function Tn(e,t,i,n){const a=i.map((e=>In(e.id)));return e.filter((e=>function(e,t){return e.planId.equals(t.planId)}(t,e))).filter((e=>function(e,t){return t.includes(e.stripeProductId)}(e,a))).map((e=>Sn(e,function(e){return n.find((t=>In(null==t?void 0:t.product)===e.stripeProductId))}(e),function(e){return i.find((t=>In(t.id)===e.stripeProductId))}(e))))}function Dn(e,t){return e.time-t.time}function qn(e,t){return e.pricing[0].price-t.pricing[0].price}const Ln=e=>B().policy(e.storePolicies.connected).expose((e=>({async listPlans(){const{planRows:t,tierRows:i}=await async function(e){const t=e.storeDatabase.tables,i=await t.subscriptions.plans.read({conditions:!1}),n=i.map((e=>e.planId));return{planRows:i,tierRows:n.length?await t.subscriptions.tiers.read(u(n,(e=>({planId:e})))):[]}}(e),{stripeProducts:n,stripePrices:a}=await async function({auth:e,tierRows:t}){const{stripeLiaisonAccount:i}=e,n=(await Promise.all(t.map((async e=>await i.products.retrieve(e.stripeProductId))))).filter((e=>!!e)),a=(await Promise.all(n.map((async e=>{const t=In(e.default_price);return t?await i.prices.retrieve(t):void 0})))).filter((e=>!!e));return{stripeProducts:n,stripePrices:a}}({auth:e,planRows:t,tierRows:i});return await async function({auth:e,tierRows:t,stripeProducts:i}){const{storeDatabase:n,roleManager:a}=e,o=n.tables,r=i.map((e=>In(e.id))),s=t.filter((e=>!r.includes(e.stripeProductId))).map((e=>({roleId:e.roleId,tierId:e.tierId})));s.length&&(await o.subscriptions.tiers.delete(u(s,(({tierId:e})=>({tierId:e})))),await Promise.all(s.map((async({roleId:e})=>{await a.deleteRoleAndAllRelatedRecords(e)}))))}({auth:e,tierRows:i,stripeProducts:n}),async function({planRows:e,tierRows:t,stripePrices:i,stripeProducts:n}){return e.map((e=>{var a;return{archived:null!==(a=e.archived)&&void 0!==a&&a,label:e.label,planId:e.planId.string,time:e.time,tiers:Tn(t,e,n,i).sort(qn)}})).sort(Dn)}({planRows:t,tierRows:i,stripeProducts:n,stripePrices:a})}})));function jn(e){if(!e)return tt.Unsubscribed;const{status:t,cancel_at_period_end:i}=e;return i?tt.Cancelled:"active"===t?tt.Active:tt.Unpaid}async function Un({storeDatabase:e,stripePriceIds:t,stripeLiaisonAccount:i}){const n=await async function({priceIds:e,storeDatabase:t,stripeLiaisonAccount:i}){if(0===e.length)throw new Error("prices not found in subscription from stripe");const n=(await Promise.all(e.map((async e=>i.prices.retrieve(e))))).map((e=>In(e.product)));return t.tables.subscriptions.tiers.read(u(n,(e=>({stripeProductId:e}))))}({priceIds:t,storeDatabase:e,stripeLiaisonAccount:i}),{planId:a}=n[0];const o=(await e.tables.subscriptions.tiers.read(d({planId:a}))).filter((function(e){return!n.some((t=>t.tierId.string===e.tierId.string))}));return{subscribedRoleIds:n.map((e=>e.roleId)),unsubscribedRoleIds:o.map((e=>e.roleId))}}async function Nn({userId:e,priceIds:t,storeDatabase:i,stripeLiaisonAccount:n,roleManager:a,timerange:o}){const{subscribedRoleIds:r,unsubscribedRoleIds:s}=await Un({storeDatabase:i,stripeLiaisonAccount:n,stripePriceIds:t});await a.revokeUserRoles({userId:e,roleIds:s}),await a.grantUserRoles({...o,userId:e,roleIds:r})}function zn(e){return 1e3*e}function Bn({start:e,end:t}){return{timeframeStart:zn(e),timeframeEnd:zn(t)}}const Vn={build:({appId:e,userId:t})=>`${e} ${t}`,parse(e){const[t,i]=e.split(" ");return{appId:t,userId:i}}};function Wn(e,t){return Kt.constrainDatabaseForApp({appId:t,database:e})}async function Hn(e,t){const i=await e.tables.customers.unconstrained.readOne(d({stripeCustomerId:t}));if(!i)throw new Error(`stripe customer id not found in billing "${t}"`);const n=i[Xt],a=Wn(e,n),{userId:o}=i;return{appId:n,userId:o,storeDatabase:a}}function Fn(e){return e.items.data.map((e=>In(e.price)))}function Qn(e){const t=e.lines.data.filter((e=>"recurring"===e.price.type)),i=new Set;for(const{price:e}of t)i.add(e.id);return[...i]}async function Xn({stripePriceId:e,storeDatabase:t,stripeLiaisonAccount:i}){const n=await i.prices.retrieve(e),a=In(n.product);return await t.tables.subscriptions.tiers.readOne(d({stripeProductId:a}))}async function Kn(e,t){const{storeDatabase:i,stripeLiaisonAccount:n,stripeCustomerId:a}=e,{tierRow:o}=await async function({tierId:e,auth:{storeDatabase:t}}){const i=r.fromString(e),n=await t.tables.subscriptions.tiers.readOne(d({tierId:i}));if(!n)throw new Error(`subscription tier not found "${i}"`);const a=await t.tables.subscriptions.plans.readOne(d({planId:n.planId}));if(!a)throw new Error(`subscription not found "${n.planId.toString()}"`);return{tierRow:n,planRow:a}}({tierId:t,auth:e}),s=await n.subscriptions.list({customer:a});if(s)for(const e of s.data){const t=In(e.items.data[0].price),a=await Xn({stripePriceId:t,storeDatabase:i,stripeLiaisonAccount:n});if(o.planId.string===a.planId.string)return e}}async function Yn(e,t,i){const n=r.fromString(t.access.user.userId),a={async updateAndFulfillSubscription(e){const a=await async function({stripePriceId:e,auth:t,stripeSubscription:i}){const{stripeLiaisonAccount:n}=t,a=[{id:i.items.data[0].id,price:e,quantity:1}];return n.subscriptions.update(i.id,{items:a,cancel_at_period_end:!1,proration_behavior:"create_prorations"})}({auth:t,stripePriceId:i,stripeSubscription:e});return"active"===a.status&&await Nn({userId:n,storeDatabase:t.storeDatabase,stripeLiaisonAccount:t.stripeLiaisonAccount,roleManager:t.roleManager,priceIds:Fn(a),timerange:Bn({start:a.current_period_start,end:a.current_period_end})}),{}},async createNewSubscriptionUsingExistingPaymentMethod(e){const a=await async function(e,t,i){return e.stripeLiaisonAccount.subscriptions.create({customer:e.stripeCustomerId,default_payment_method:i.id,items:[{price:t,quantity:1}]})}(t,i,e);return"active"===a.status&&await Nn({userId:n,storeDatabase:t.storeDatabase,stripeLiaisonAccount:t.stripeLiaisonAccount,roleManager:t.roleManager,priceIds:Fn(a),timerange:Bn({start:a.current_period_start,end:a.current_period_end})}),{}},async createCheckoutPopupToBuyNewSubscription(){const{popupId:n,...a}=On.checkout(e),o=await async function(e,t,{success_url:i,cancel_url:n}){return e.stripeLiaisonAccount.checkout.sessions.create({customer:e.stripeCustomerId,mode:"subscription",line_items:[{price:t,quantity:1}],client_reference_id:Vn.build({appId:e.access.appId,userId:e.access.user.userId}),success_url:i,cancel_url:n})}(t,i,a);return{checkoutDetails:{popupId:n,stripeAccountId:t.stripeAccountId,stripeSessionUrl:o.url,stripeSessionId:o.id}}}},{tierId:o}=await Xn({...t,stripePriceId:i});return{actions:a,...await ti({defaultPaymentMethod:Mn(t),subscription:Kn(t,o.string)})}}function Gn({hasDefaultPaymentMethod:e,hasExistingSubscription:t}){return t?it.Update:e?it.UsePaymentMethod:it.CheckoutPopup}async function Jn(e,t){const i=await Kn(e,t);if(i)return i;throw new Error("user must already have a subscription")}const Zn=e=>B().policy(e.storePolicies.customer).expose((t=>({async fetchDetailsAboutMySubscriptions(){const e=await async function(e){var t;const i=await e.stripeLiaisonAccount.subscriptions.list({customer:e.stripeCustomerId});return null!==(t=null==i?void 0:i.data)&&void 0!==t?t:[]}(t);return Promise.all(e.map((async e=>{const i=await async function(e,t){const[i]=t.items.data.map((e=>In(e.price)));return await e.prices.retrieve(i)}(t.stripeLiaisonAccount,e),n=await async function(e,t){return e.tables.subscriptions.tiers.readOne(d({stripeProductId:In(t.product)}))}(t.storeDatabase,i);return function(e,t,i){return{status:jn(e),planId:null==i?void 0:i.planId.string,tierId:null==i?void 0:i.tierId.string,pricing:kn(t)}}(e,i,n)})))},async buy(i){const{subscription:n,defaultPaymentMethod:a,actions:o}=await Yn(e,t,i);i=xi(i,lt((e=>"string"!=typeof e?["must be a string"]:[])));switch(Gn({hasDefaultPaymentMethod:!!a,hasExistingSubscription:!!n})){case it.Update:return o.updateAndFulfillSubscription(n);case it.UsePaymentMethod:return o.createNewSubscriptionUsingExistingPaymentMethod(a);case it.CheckoutPopup:return o.createCheckoutPopupToBuyNewSubscription();default:throw new Error("unknown purchase scenario")}},async cancel(e){e=xi(e,yt);const i=await Jn(t,e);await async function(e,t){await e.stripeLiaisonAccount.subscriptions.update(t,{cancel_at_period_end:!0})}(t,i.id)},async uncancel(e){e=xi(e,yt);const i=await Jn(t,e);await async function(e,t){await e.stripeLiaisonAccount.subscriptions.update(t,{cancel_at_period_end:!1})}(t,i.id)}}))),ea=lt((e=>"number"!=typeof e?["must be a number"]:[]),ht(.01)),ta=lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(1),gt(32)),ia=lt((e=>"string"!=typeof e?["must be a string"]:[]),dt(pt("usd"))),na=lt((e=>"string"!=typeof e?["must be a string"]:[]),dt(pt("month"),pt("year"))),aa=ct({price:ea,currency:ia,interval:na}),oa=lt((e=>"boolean"!=typeof e?["must be a boolean"]:[])),ra=ct({currency:ia,interval:na,price:ea}),sa=ct({label:ta,pricing:ra}),la=ct({planLabel:ta,tier:sa}),ca=ct({planId:yt,label:ta,archived:oa}),da=ct({tierId:yt,label:ta,active:oa,pricing:ra}),ua=e=>B().policy(e.storePolicies.merchant).expose((({helpers:e})=>({async addPlan(t){const{planLabel:i,tier:n}=xi(t,la),{planId:a,tierId:o,tierRoleId:r,time:s,stripePriceId:l}=await e.createPlanAndTier({planLabel:i,tier:n});return{planId:a.toString(),label:i,time:s,archived:!1,tiers:[{tierId:o.toString(),label:n.label,roleId:r.string,pricing:[{...n.pricing,stripePriceId:l}],time:s,active:!0}]}},async addTier(t){const i=xi(t.planId,yt),n=xi(t.label,ta),a=xi(t.pricing,aa),{tierId:o,roleId:r,time:s,stripePriceId:l}=await e.createTierForPlan({label:n,planId:i,pricing:a});return{tierId:o.toString(),roleId:r.toString(),active:!0,label:n,pricing:[{...a,stripePriceId:l}],time:s}},async editPlan(t){const i=xi(t.planId,yt),n=xi(t.label,ta),a=xi(t.archived,oa);await e.updatePlan({planId:i,label:n,archived:a})},async editTier(t){const i=xi(t.label,ta),n=xi(t.tierId,yt),a=xi(t.active,oa),o=xi(t.pricing,aa);return e.updateTier({label:i,tierId:n,active:a,pricing:o})}})));function pa(e){const t={...e,storePolicies:Pn(e)};return{connect:Rn(t),billing:Cn(t),subscriptions:{listing:Ln(t),planning:ua(t),shopping:Zn(t)}}}function ha({database:e,generateId:t}){return{async grantUserRoles({userId:t,roleIds:i,timeframeEnd:n,timeframeStart:a}){await e.transaction((({tables:e})=>Promise.all(i.map((i=>e.userHasRole.update({...d({userId:t,roleId:i}),upsert:{userId:t,hard:!0,public:!0,time:Date.now(),roleId:i,timeframeStart:a,timeframeEnd:n}}))))))},async revokeUserRoles({userId:t,roleIds:i}){i.length>0&&await e.tables.userHasRole.delete({conditions:l({equal:{userId:t}},c(...i.map((e=>({equal:{roleId:e}})))))})},async createPrivateSystemRole({label:i}){const n=t();return await e.tables.role.create({label:i,roleId:n,hard:!0,public:!0,assignable:!1,time:Date.now()}),{roleId:n}},readRole:async t=>await e.tables.role.readOne(d({roleId:t})),async updateRole({label:t,roleId:i}){await e.tables.role.update({...d({roleId:i}),write:{label:t}})},async deleteRoleAndAllRelatedRecords(t){const i=d({roleId:t});await e.transaction((async({tables:e})=>Promise.all([e.role.delete(i),e.userHasRole.delete(i)])))}}}async function ma({config:e,rando:t,databaseRaw:i,dacastSdk:n,stripeLiaison:a,sendLoginEmail:o,signToken:r,verifyToken:s}){const l=function({rando:e}){return function({rando:e,delimiter:t,dictionary:i,nicknameStructure:n}){const a=n.map((e=>e.reduce(((e,t)=>[...e,...i[t]]),[])));return()=>a.map((t=>e.randomSample(t))).join(t)}({rando:e,delimiter:" ",dictionary:vn,nicknameStructure:[["adjectives","colors"],["animals"]]})}({rando:t}),c=hn({config:e,databaseRaw:i,verifyToken:s});return{auth:(d={rando:t,config:e,authPolicies:c,signToken:r,verifyToken:s,sendLoginEmail:o,generateNickname:l},{apps:{appService:ci(d),appEditService:Ai(d)},users:{greenService:gi(d),loginService:Ii(d),userService:bi(d),personalService:Ci(d)},permissions:{permissionsService:_i(d)}}),administrative:gn({config:e,authPolicies:c}),questions:pn({rando:t,config:e,authPolicies:c}),example:Ji({rando:t,config:e,authPolicies:c}),videos:Yi({config:e,dacastSdk:n,authPolicies:c}),notes:Di({config:e,authPolicies:c}),store:pa({async anonPolicy(e,i){const n=await c.anonPolicy(e,i),{database:o}=n;return delete n.database,{...n,stripeLiaison:a,roleManager:ha({generateId:()=>t.randomId(),database:_(o,(e=>({role:e.auth.permissions.role,userHasRole:e.auth.permissions.userHasRole})))}),storeDatabaseUnconnected:_(o,(e=>e.store))}},stripeLiaison:a,generateId:t.randomId,popupReturnUrl:e.webRoot+e.store.popupReturnUrl})};var d}const fa=async e=>console.log(`\n\n====== EMAIL ======\nfrom: ${e.fromLabel}\nto: ${e.to}\nsubject: ${e.subject}\ntime: ${(new Date).toLocaleString()}\n\n${e.text}\n\n===================\n\n`);function ba(e,...t){return Array.from(e).reduce(((e,i,n)=>{var a;return e+i+(null!==(a=t[n])&&void 0!==a?a:"")}),"")}function ga({sendEmail:e}){return async function({to:t,appHome:i,appLabel:n,lifespan:a,legalLink:o,loginToken:r,platformLink:s}){const l=function({home:e,loginToken:t}){const i=new URL(e);return i.hash=`#login=${t}`,i}({loginToken:r,home:i}),c=Math.round(a/ee).toFixed(0),d=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");const u=new URL(s).host;return e({to:t,fromLabel:n,subject:"Login link",html:ba`
<h1>Login link for ${d}</h1>
<p style="font-size: 1.2em; padding-left: 0.5rem;">
	<a href="${l.toString()}">Â» Login to ${d} Â«</a>
</p>
<div style="opacity: 0.7; font-size: 0.8em; margin-top: 2rem;">
	<p>Expires in ${c} minutes.</p>
	<p>If you didn't request this login link, just ignore it.</p>
	<p>You can contact support by replying to this email.</p>
	<ul style="padding-left: 0.5rem;">
		<li>Logins powered by <a href="${s}">${u}</a></li>
		<li><a href="${o}">Policies and terms of service</a></li>
	</ul>
	<p style="opacity: 0.3; font-size: 0.4em;">
		${Date.now()}
	</p>
</div>
`,text:`\nLogin link for ${n}\n\n  Â» ${l.toString()}\n\n\nExpires in ${c} minutes\n\nIf you didn't request this login link, just ignore it.\n\nYou can contact support by replying to this email.\n\n  * Logins powered by ${s}\n\n  * Policies and terms of service ${o}\n\n${Date.now()}\n`})}}function va(e){const{logger:t,prepareRoleManager:i}=e;return ce({async"account.updated"(t){const i=t.data.object,n=i.id,a=await async function({stripeAccountId:e,storeDatabaseRaw:t}){const i=await t.tables.connect.accounts.unconstrained.readOne(d({stripeAccountId:e}));if(i){const e=i[Xt];return{connectAccount:i,appId:e,storeDatabase:Wn(t,e)}}}({...e,stripeAccountId:n});if(a){const{storeDatabase:e,connectAccount:{connectId:t}}=a;await e.tables.connect.accounts.update({...d({connectId:t}),write:{email:i.email,charges_enabled:i.charges_enabled,payouts_enabled:i.payouts_enabled,details_submitted:i.details_submitted}})}},async"customer.subscription.updated"(t){const{appId:n,subscription:a,userId:o,storeDatabase:r,stripeLiaisonAccount:s}=await async function({event:e,stripeLiaison:t,storeDatabaseRaw:i}){const n=e.data.object,a=In(n.customer),o=t.account(e.account),{storeDatabase:r,userId:s,appId:l}=await Hn(i,a);return{appId:l,userId:s,subscription:n,storeDatabase:r,stripeCustomerId:a,stripeLiaisonAccount:o}}({...e,event:t}),l=i(n),c=Fn(a);await Nn({userId:o,priceIds:c,storeDatabase:r,stripeLiaisonAccount:s,roleManager:l,timerange:Bn({start:a.current_period_start,end:a.current_period_end})})},async"invoice.paid"(n){const{invoice:a,appId:o,userId:r,storeDatabase:s,stripeLiaisonAccount:l}=await async function({event:e,stripeLiaison:t,storeDatabaseRaw:i}){const n=e.data.object,a=In(n.customer),o=t.account(e.account),{storeDatabase:r,userId:s,appId:l}=await Hn(i,a);return{appId:l,userId:s,invoice:n,storeDatabase:r,stripeCustomerId:a,stripeLiaisonAccount:o}}({...e,event:n}),c=!!a.subscription,d=i(o);c?await Nn({userId:r,storeDatabase:s,stripeLiaisonAccount:l,roleManager:d,priceIds:Qn(a),timerange:Bn(a.lines.data[0].period)}):t.error("unknown 'invoice.paid' hook (not for a subscription)")}},((e,i)=>async n=>(t.info(`stripe-webhook ${i}:`,n.data.object),e(n))))}function wa(e){return{headers:{},lastResponse:void 0,...e}}function ya(e){const t={};for(const[i,n]of Object.entries(e))void 0!==n&&(t[i]=n);return t}function xa({rando:e,rootUrl:t,recentDetails:i,metaDataTables:n,tables:a,dispatchWebhook:o}){const r=()=>e.randomId().string,s=function({generateId:e}){return function(){const t=()=>{throw new Error("not implemented")};return function({table:i,handleCreate:n=t,handleUpdate:a=t}){return{async create(t){const{resource:a,afterResourceIsAddedToTable:o}=await n(t),r={id:e(),...a};return await i.create(r),o&&await o(),wa(r)},update:async(e,t)=>(await i.update({...d({id:e}),write:ya(await a(e,t))}),wa(await i.readOne(d({id:e})))),retrieve:async e=>wa(await i.readOne(d({id:e}))),del:async e=>(await i.delete(d({id:e})),wa({}))}}}}({generateId:r}),l=(c=t,{connect:e=>`${c}/mocksite/fakestripe/connect?${An(e)}`,login:()=>`${c}/mocksite/fakestripe/login`,customerPortal:()=>`${c}/mocksite/fakestripe/store-customer-portal`,checkout:e=>`${c}/mocksite/fakestripe/checkout?${An(e)}`});var c;return{accounts:{async create(e){const t={id:r().toString(),type:e.type,email:e.email};return await a.accounts.create(t),wa(t)},retrieve:async e=>wa(await a.accounts.readOne(d({id:e}))),createLoginLink:async e=>wa({created:Date.now(),url:l.login()})},accountLinks:{create:async e=>wa({url:l.connect({return_url:e.return_url,refresh_url:e.refresh_url})})},account(t){const c=T({tables:a,constraint:{_connectedAccount:t}}),u=function({tables:e,generateId:t}){async function i(e){const i=Date.now();return{object:"list",url:"",has_more:!1,data:await Promise.all(e.map((async e=>({id:t(),created:i,price:e.price,quantity:e.quantity}))))}}return{interpretUpdateItemsParam:async function(e){const i=Date.now();return{object:"list",url:"",has_more:!1,data:await Promise.all(e.map((async e=>({id:t(),created:i,price:e.price,quantity:e.quantity}))))}},interpretCreateParams:async function(e){return{id:t(),customer:e.customer,created:Date.now(),default_payment_method:e.default_payment_method,status:"active",items:await i(e.items),current_period_end:Math.floor((Date.now()+2592e6)/1e3),current_period_start:Math.floor(Date.now()/1e3)}},generateInvoiceForSubscriptionItems:async function({subscriptionId:i,items:n,default_payment_method:a,customer:o,current_period_end:r,current_period_start:s}){let l=0;const c=await Promise.all(n.data.map((async t=>{const i=await e.prices.readOne(d({id:In(t.price)}));return l+=i.unit_amount*t.quantity,{quantity:t.quantity,price:{type:"recurring",id:i.id},period:{end:r,start:s}}}))),u=a,p={id:t(),amount:l,currency:"usd",customer:o,payment_method:u},h={id:t(),customer:o,subscription:i,lines:{data:c},payment_intent:p.id};return await e.paymentIntents.create(p),await e.invoices.create(h),{invoice:h,paymentIntent:p}}}}({tables:c,generateId:r});return{billingPortal:{create:async e=>wa({url:l.customerPortal(),customer:e.customer})},customers:{...s()({table:c.customers,handleCreate:async e=>{var t;return{resource:{email:e.email,invoice_settings:null!==(t=e.invoice_settings)&&void 0!==t?t:{default_payment_method:void 0}}}},handleUpdate:async(e,t)=>({email:t.email,invoice_settings:t.invoice_settings})}),listPaymentMethods:async(e,t)=>wa({object:"list",data:await c.paymentMethods.read(d({customer:e,type:t.type}))})},products:s()({table:c.products,handleCreate:async e=>({resource:{name:e.name,description:e.description,active:!0}}),handleUpdate:async(e,t)=>({name:t.name,active:t.active,description:t.description,default_price:t.default_price})}),prices:{...s()({table:c.prices,handleCreate:async e=>({resource:{active:void 0===e.active||e.active,product:e.product,currency:e.currency,unit_amount:e.unit_amount,recurring:e.recurring?{usage_type:"licensed",...e.recurring}:void 0,type:e.recurring?"recurring":"one_time"}}),handleUpdate:async(e,t)=>({active:t.active,recurring:t.recurring?{usage_type:"licensed",...t.recurring}:void 0})}),async list(e){let t=await c.prices.read({conditions:!1});return void 0!==e.active&&(t=t.filter((t=>t.active===e.active))),void 0!==e.product&&(t=t.filter((t=>t.product===e.product))),wa({object:"list",data:t})}},checkout:{sessions:s()({table:c.checkoutSessions,handleCreate:async t=>({resource:{mode:t.mode,url:"setup"===t.mode?void 0:l.checkout({cancel_url:t.cancel_url,success_url:t.success_url}),customer:t.customer,client_reference_id:t.client_reference_id,line_items:"setup"===t.mode?void 0:{object:"list",has_more:!1,url:void 0,data:t.line_items.map((t=>({id:e.randomId().string,object:"item",quantity:t.quantity,price:t.price})))}}}),handleUpdate:async(e,t)=>({})})},paymentMethods:(()=>{const e=s()({table:c.paymentMethods,handleCreate:async e=>({resource:{type:e.type,customer:e.customer,card:e.card}}),handleUpdate:async(e,t)=>({card:t.card})});return{...e,delete:void 0,async detach(t){const i=e.retrieve(t);return await e.del(t),wa(i)}}})(),setupIntents:s()({table:c.setupIntents,handleCreate:async e=>({resource:{customer:e.customer,payment_method:e.payment_method,usage:e.usage}}),handleUpdate:async(e,t)=>({payment_method:t.payment_method})}),paymentIntents:s()({table:c.setupIntents,handleCreate:async e=>({resource:{customer:e.customer,payment_method:e.payment_method,amount:e.amount,currency:e.currency}}),handleUpdate:async(e,t)=>({customer:t.customer,payment_method:t.payment_method,amount:t.amount,currency:t.currency})}),subscriptionItems:s(),subscriptions:(()=>{const e=s()({table:c.subscriptions,handleCreate:async e=>{const a=await u.interpretCreateParams(e),{invoice:r,paymentIntent:s}=await u.generateInvoiceForSubscriptionItems({customer:a.customer,default_payment_method:a.default_payment_method,subscriptionId:a.id,items:a.items,current_period_end:a.current_period_end,current_period_start:a.current_period_start}),l=In(s.payment_method),c=await n.paymentMethodMetaData.readOne(d({id:l}));return i.subscriptionCreation={subscription:a,paymentIntent:s},a.status=(null==c?void 0:c.isFailing)?"incomplete":"active",{resource:a,afterResourceIsAddedToTable:async()=>{(null==c?void 0:c.isFailing)||await o("invoice.paid",t,r)}}}});return{...e,async update(i,a){const r=await e.retrieve(i),s={},l=await n.paymentMethodMetaData.readOne(d({id:a.default_payment_method}));if(void 0!==a.cancel_at_period_end&&(s.cancel_at_period_end=a.cancel_at_period_end),void 0!==a.default_payment_method&&(s.default_payment_method=a.default_payment_method),s.status=(null==l?void 0:l.isFailing)?"incomplete":"active",void 0!==a.items){const e=a.items,n=await u.interpretUpdateItemsParam(e),{invoice:c}=await u.generateInvoiceForSubscriptionItems({customer:r.customer,default_payment_method:r.default_payment_method,subscriptionId:i,items:n,current_period_end:r.current_period_end,current_period_start:r.current_period_start});(null==l?void 0:l.isFailing)||await o("invoice.paid",t,c),s.items=n}return await c.subscriptions.update({...d({id:i}),write:s}),e.retrieve(i)},async list(e){let t={equal:{customer:e.customer}},i={notEqual:{status:"canceled"}};e.price&&(t.equal.price=e.price),e.status&&(i="all"===e.status?{isSet:{status:!0}}:"ended"===e.status?["and",{notEqual:{status:"canceled"}},{notEqual:{status:"incomplete_expired"}}]:{equal:{status:e.status}});return wa({object:"list",data:await c.subscriptions.read({conditions:["and",t,i]})})}}})()}}}}const Ia={prices:!0,accounts:!0,invoices:!0,products:!0,customers:!0,setupIntents:!0,subscriptions:!0,paymentMethods:!0,paymentIntents:!0,checkoutSessions:!0};async function ka({logger:e,webRoot:t,rando:i,tableStorage:n,storeDatabaseRaw:a,prepareRoleManager:o}){const r=await async function({tableStorage:e}){return M({shape:Ia,flexStorage:e,makeTableName:Yt}).tables}({tableStorage:n}),s=await async function({tableStorage:e}){return M({shape:{paymentMethodMetaData:!0},flexStorage:e,makeTableName:Yt}).tables}({tableStorage:n}),l={},c={webhooks:void 0},u=function(e){let t;return async function(i,n,a){if(t)throw new Error(`webhook circularity error "${t}" -> "${i}"`);t=i;const o=await e.webhooks[i]({type:i,account:n,data:{object:a}});return t=void 0,o}}(c),p=xa({rando:i,rootUrl:t,recentDetails:l,metaDataTables:s,tables:r,dispatchWebhook:u});c.webhooks=va({logger:e,stripeLiaison:p,storeDatabaseRaw:a,prepareRoleManager:o});const h=function({rando:e,stripeTables:t,metaDataTables:i,stripeLiaison:n,recentDetails:a,dispatchWebhook:o}){const r={setPaymentMethod:async({customer:i,stripeLiaisonAccount:n})=>(await t.paymentMethods.delete(d({customer:i})),await n.paymentMethods.create({customer:i,type:"card",card:{brand:"fakevisa",country:"canada",exp_month:1,exp_year:2032,last4:e.randomSequence(4,[..."0123456789"])}})),createSetupIntent:async({customer:e,paymentMethod:t,stripeLiaisonAccount:i})=>await i.setupIntents.create({customer:e,payment_method:t.id}),createSubscription:async({customer:e,paymentMethod:t,stripeLiaisonAccount:i,items:n})=>await i.subscriptions.create({customer:e,default_payment_method:t.id,items:n})};return{async linkStripeAccount(e){await o("account.updated",e,{id:e,email:"fake-stripe-account-email@xiome.io",charges_enabled:!0,payouts_enabled:!0,details_submitted:!0})},async linkStripeAccountThatIsIncomplete(e){await o("account.updated",e,{id:e,email:"fake-stripe-account-email@xiome.io",charges_enabled:!1,payouts_enabled:!1,details_submitted:!1})},async checkoutSubscriptionTier(e,i){const a=await t.checkoutSessions.readOne(d({id:i})),o=n.account(e),s=a.customer,l=await r.setPaymentMethod({customer:s,stripeLiaisonAccount:o}),c=await r.createSubscription({customer:s,paymentMethod:l,stripeLiaisonAccount:o,items:a.line_items.data.map((e=>({price:In(e.price),quantity:e.quantity})))});a.subscription=c.id,await t.checkoutSessions.update({...d({id:i}),write:{subscription:c.id}})},async createNewDefaultPaymentMethod({stripeAccountId:e,customer:t,isFailing:a}){const o=n.account(e),s=await r.setPaymentMethod({stripeLiaisonAccount:o,customer:t});return await i.paymentMethodMetaData.create({id:s.id,isFailing:a}),await o.customers.update(t,{invoice_settings:{default_payment_method:s.id}}),s},async removeAllPaymentMethods(e){await t.paymentMethods.delete(d({customer:e}))},wipeAll:{async customers(){await t.customers.delete({conditions:!1})},async products(){await t.products.delete({conditions:!1})}}}}({rando:i,stripeTables:r,metaDataTables:s,stripeLiaison:p,recentDetails:l,dispatchWebhook:u});return{stripe:void 0,stripeLiaison:p,stripeWebhooks:c.webhooks,mockStripeOperations:h}}async function $a({databaseRaw:e,mockStorage:t,config:i,rando:n,configureStripe:a}){const o=console,r=_(e,(e=>e.store)),s=function({rando:e,permissionsDatabaseRaw:t}){return i=>ha({generateId:()=>e.randomId(),database:Kt.constrainDatabaseForApp({appId:i,database:t})})}({rando:n,permissionsDatabaseRaw:_(e,(e=>e.auth.permissions))});return"mock-mode"===i.stripe?ka({webRoot:i.webRoot,rando:n,logger:o,tableStorage:t,storeDatabaseRaw:r,prepareRoleManager:s}):a({config:i,storeDatabaseRaw:r,prepareRoleManager:s})}function Sa({goodApiKey:e}){return async t=>t===e}function Pa({goodApiKey:e}){return{getClient:t=>function({goodApiKey:e}){let t=1;function i(e){const i=t++;return{online:!0,id:`${e}-${i.toString()}`,title:`content ${i}`,creation_date:"1999-12-25"}}const n={vods:[0,0].map((()=>i("vod"))),channels:[0,0].map((()=>i("channel"))),playlists:[0,0].map((()=>i("playlist")))};return({apiKey:t})=>{function i(i){function n(i){return(...n)=>{if(t!==e)throw new Error("mock dacast invalid api key");return i(...n)}}return{get:n((async()=>function(e){return{totalCount:e.length.toString(),data:e,paging:{last:"",next:"",previous:"",self:""}}}(i))),id:e=>({get:n((async()=>i.find((t=>t.id===e)))),embed:e=>({get:n((async()=>{return{code:(t=e,"iframe"===t?'<iframe src="https://iframe.dacast.com/vod/0ffd60be-91b7-22b0-1353-7dba7af43261/e9cc39f7-83ea-19db-2c0e-672beeec1547" width="100%" height="100%" frameborder="0" scrolling="no" allow="autoplay" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>':'<script id="0ffd60be-91b7-22b0-1353-7dba7af43261-vod-e9cc39f7-83ea-19db-2c0e-672beeec1547" width="100%" height="100%" src="https://player.dacast.com/js/player.js?contentId=0ffd60be-91b7-22b0-1353-7dba7af43261-vod-e9cc39f7-83ea-19db-2c0e-672beeec1547"  class="dacast-video"><\/script>')};var t}))})})}}return{vods:i(n.vods),channels:i(n.channels),playlists:i(n.playlists)}}}({goodApiKey:e})({apiKey:t}),verifyApiKey:Sa({goodApiKey:e})}}const Aa={apps:{registrations:!0,owners:!0}},Oa={auth:{users:{accounts:!0,emails:!0,latestLogins:!0,profiles:!0},permissions:{privilege:!0,role:!0,roleHasPrivilege:!0,userHasRole:!0}},example:{examplePosts:!0},questions:{likes:!0,reports:!0,answerPosts:!0,questionPosts:!0},store:{customers:!0,connect:{accounts:!0,active:!0},subscriptions:{plans:!0,tiers:!0}},videos:{dacastAccountLinks:!0,viewDacast:!0,viewPrivileges:!0},notes:{notes:!0,questionDetails:!0},...Aa};async function Ma({config:e,configureMongo:t,configureMockStorage:i}){const n="mock-storage"===e.database?i():h();let a=_(o="mock-storage"===e.database?M({flexStorage:n,shape:Oa,makeTableName:Yt}):await t({databaseShape:Oa,config:{...e,database:e.database}}),(e=>({...Kt.wrapTables(e),...Vt(Aa,((e,t)=>o.tables[t]))})));var o;{const{appId:t,home:i,label:n,origins:o}=e.platform.appDetails,s=C({table:a.tables.apps.registrations,fallbackRows:[{appId:r.fromString(t),home:i,label:n,origins:li(o),archived:!1}]});a=_(a,(e=>({...e,apps:{...e.apps,registrations:s}})))}return{databaseRaw:a,mockStorage:n}}const Ca=["https://xiome.io","https://stage.xiome.io","http://localhost:8080","http://localhost:5000"];async function Ea({url:e,width:t=480,height:i=640,popupId:n,handleSecretMockCommand:a=(async()=>{})}){const o=window.open(e,"_blank",function(e,t){const{outerWidth:i,outerHeight:n,screenY:a,screenX:o}=window.top;return`\n\t\tpopup,\n\t\twidth=${e},\n\t\theight=${t},\n\t\ttop=${(n/2+a-t/2)/2},\n\t\tleft=${i/2+o-e/2},\n\t\ttoolbar=no,\n\t\tlocation=no,\n\t\tstatus=no,\n\t\tmenubar=no,\n\t\tscrollbars=yes,\n\t\tresizable=yes\n\t`}(t,i));return new Promise((e=>{function t(t){clearInterval(r),window.removeEventListener("message",i),e(t)}function i(e){var i;const r=function(e){return Ca.includes(e)}(e.origin),s=(null===(i=e.data)||void 0===i?void 0:i.popupId)===n,l=!0===e.data.secretMockCommand;if(r)if(l)a(e.data).then((()=>{o.postMessage({secretMockCommand:!0,commandId:e.data.commandId},"*")}));else if(s){const{popupId:i,...n}=e.data;t({popupId:i,details:n})}else console.warn(`ignoring message for other popup "${e.data.popupId}":`,e.data);else console.warn(`ignoring message from origin "${e.origin}":`,e.data)}window.addEventListener("message",i);const r=setInterval((()=>{o.closed&&t({popupId:n})}),100)}))}function _a(e){return async function(t){const i=await b(),n={...e,config:t,rando:i},a=function({config:e,configureMailgun:t}){let i;i="mock-console"===e.email?fa:t(e.email).sendEmail;const n=function(e){let t=!0;return{sendEmail:async i=>{if(t)return e(i)},enableEmails(){t=!0},disableEmails(){t=!1}}}(i);i=n.sendEmail;const{disableEmails:a,enableEmails:o}=n,{sendLoginEmail:r,recallLatestLoginEmail:s}=function(e){let t;return{sendLoginEmail:async i=>{t=i,await e(i)},recallLatestLoginEmail:()=>t}}(ga({sendEmail:i}));return{sendEmail:i,enableEmails:o,disableEmails:a,sendLoginEmail:r,recallLatestLoginEmail:s}}(n),{databaseRaw:o,mockStorage:s}=await Ma(n),{signToken:l,verifyToken:c}=function({config:e,configureTokenFunctions:t}){return"mock-mode"===e.crypto.keys?{signToken:async({payload:e,lifespan:t})=>{const i={payload:e,iat:Date.now()/1e3,exp:(Date.now()+t)/1e3};return[Ut({alg:null,typ:"JWT"}),Ut(i),Ut("fake-mock-token-signature")].join(".")},verifyToken:Nt()}:t(e.crypto.keys)}(n),{stripeLiaison:d,mockStripeOperations:u}=await $a({...n,databaseRaw:o,mockStorage:s}),p=function({mockStripeOperations:e}){return{connect:async({popupId:t,stripeAccountId:i,stripeAccountSetupLink:n})=>Ea({popupId:t,url:n,handleSecretMockCommand:e?async t=>{"complete"===t.type?await e.linkStripeAccount(i):"incomplete"===t.type&&await e.linkStripeAccountThatIsIncomplete(i)}:async()=>{}}),login:async({popupId:t,stripeAccountId:i,stripeLoginLink:n})=>Ea({popupId:t,url:n,handleSecretMockCommand:e?async t=>{"complete"===t.type?await e.linkStripeAccount(i):"incomplete"===t.type&&await e.linkStripeAccountThatIsIncomplete(i)}:async()=>{}}),checkoutSubscription:async({popupId:t,stripeSessionUrl:i,stripeSessionId:n,stripeAccountId:a})=>Ea({popupId:t,url:i,handleSecretMockCommand:e?async t=>{"success"===t.type&&await e.checkoutSubscriptionTier(a,n)}:async()=>{}}),openStoreCustomerPortal:async({popupId:t,customer:i,stripeAccountId:n,stripeSessionUrl:a})=>Ea({popupId:t,url:a,handleSecretMockCommand:e?async t=>{if("success"===t.type){const t=!1;await e.createNewDefaultPaymentMethod({customer:i,isFailing:t,stripeAccountId:n})}else if("failure"===t.type){const t=!0;await e.createNewDefaultPaymentMethod({customer:i,isFailing:t,stripeAccountId:n})}else"detach"===t.type&&await e.removeAllPaymentMethods(i)}:async()=>{}})}}({mockStripeOperations:u}),m=function({config:e,configureDacast:t}){if("mock-mode"===e.dacast)return Pa({goodApiKey:qi});if(!0===e.dacast)return t();throw new Error("unknown dacast config")}(n),f=await ma({...n,dacastSdk:m,databaseRaw:o,stripeLiaison:d,signToken:l,verifyToken:c,sendLoginEmail:a.sendLoginEmail});return{rando:i,api:f,config:t,emails:a,databaseRaw:o,stripeLiaison:d,stripePopups:p,platformAppId:t.platform.appDetails.appId,prepareNotesDepositBox:e=>function({rando:e,database:t}){async function i(i){const n=i.map((t=>{const i=e.randomId();return{noteBase:{...t,noteId:i,to:r.fromString(t.to),from:void 0===t.from?void 0:r.fromString(t.from),old:!1,time:Date.now()},noteDetails:t.details}}));return await t.tables.notes.notes.create(...n.map((e=>e.noteBase))),n.map((({noteBase:{noteId:e}})=>({noteId:e.toString()})))}return{sendNotes:i,sendNote:async function(e){const[t]=await i([e]);return t}}}({rando:i,database:Kt.constrainDatabaseForApp({appId:e,database:o})}),mockBrowser:async({appOrigin:e})=>async function({api:e,appOrigin:t,mockStripeOperations:i}){return{mockAppWindow:async function({appId:n}){const a=h(),{remote:o,authMediator:r}=J({api:e,appId:n,storage:a,logging:!1,headers:{origin:t}}),{nextModalResults:s}=function(){const e={confirm:!0,prompt:void 0};return{modals:{popup:()=>({controls:{close(){},rerender(){}},modal:{}}),async alert(){},confirm:async()=>e.confirm,prompt:async()=>e.prompt,async confirmAction(){}},nextModalResults:e}}();return{models:await st({appId:n,remote:o,storage:a,authMediator:r,stripePopups:Zt({rig:{stripeAccountFate:"complete",stripeLoginCount:0,customerPortalAction:"link successful payment method"},mockStripeOperations:i}),chatConnect:await Jt(a)}),remote:o,nextModalResults:s}}}}({api:f,appOrigin:e,mockStripeOperations:u})}}}class Ra extends Error{constructor(e){super(e)}}function Ta(e){return function(){throw new Ra(e)}}async function Da({root:e,appOrigin:t,origins:i,storage:n,appWindowLink:a}){const o=await(e=>_a({configureStripe:Ta("config.stripe not supported in browser"),configureMongo:Ta("config.database.mongo not supported in browser"),configureMailgun:Ta("config.email.mailgun not supported in browser"),configureTokenFunctions:Ta("config.crypto.keys must be 'mock-mode' in browser"),configureMockStorage:()=>e,configureDacast:Ta("config.dacast must be in 'mock-mode' in browser")}))(n)((({root:e,platformHome:t,platformOrigins:i})=>({webRoot:e,server:{port:4999,detailedLogs:!0},platform:{legalLink:"https://xiome.io/legal",technician:{email:"chasemoskal@gmail.com"},appDetails:{appId:"27a9f4e61286d562c85df1862e88c50e6b5c0707cc84e3e1df4aeb9d9c236814",label:"Xiome Cloud",home:t,origins:i}},dacast:"mock-mode",email:"mock-console",database:"mock-storage",stripe:"mock-mode",store:{popupReturnUrl:"/popups/return"},chat:{port:8001},crypto:{keys:"mock-mode",tokenLifespans:{login:3e5,refresh:30*ie,access:3e5,external:3e5}}}))({root:e,platformHome:a,platformOrigins:i}));o.emails.disableEmails();const r="creative@xiome.io";let s=await n.read("mock-app");s||(s=await async function({ownerEmail:e,adminEmail:t,appOrigins:i,platformOrigin:n,backend:a}){const o=await a.mockBrowser({appOrigin:n}),r=await o.mockAppWindow({appId:a.platformAppId}),{accessModel:s,appsModel:l}=r.models;await s.sendLoginLink(e),await s.login(a.emails.recallLatestLoginEmail().loginToken);const{appId:c}=await l.registerApp({label:"Mock App",home:window.location.href,origins:i});return console.log("mock: register app",c),await l.appEditService.assignAdmin({appId:c,email:t}),c}({backend:o,ownerEmail:r,adminEmail:"admin@xiome.io",appOrigins:i,platformOrigin:t}),await n.write("mock-app",s)),console.log(`mock: app owner email "${r}"`),o.emails.enableEmails();const{remote:l,authMediator:c,setMockLatency:d}=await Z({appId:s,backend:o,storage:n,appOrigin:t}),{stripePopups:u}=o;return{appId:s,remote:l,storage:n,authMediator:c,backend:o,stripePopups:u,setMockLatency:d,chatConnect:await Jt(n)}}const qa=window,La=qa.ShadowRoot&&(void 0===qa.ShadyCSS||qa.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ja=Symbol(),Ua=new WeakMap;let Na=class{constructor(e,t,i){if(this._$cssResult$=!0,i!==ja)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(La&&void 0===e){const i=void 0!==t&&1===t.length;i&&(e=Ua.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&Ua.set(t,e))}return e}toString(){return this.cssText}};const za=e=>new Na("string"==typeof e?e:e+"",void 0,ja),Ba=(e,...t)=>{const i=1===e.length?e[0]:t.reduce(((t,i,n)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[n+1]),e[0]);return new Na(i,e,ja)},Va=La?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return za(t)})(e):e;var Wa;const Ha=window,Fa=Ha.trustedTypes,Qa=Fa?Fa.emptyScript:"",Xa=Ha.reactiveElementPolyfillSupport,Ka={toAttribute(e,t){switch(t){case Boolean:e=e?Qa:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},Ya=(e,t)=>t!==e&&(t==t||e==e),Ga={attribute:!0,type:String,converter:Ka,reflect:!1,hasChanged:Ya};let Ja=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(e){var t;this.finalize(),(null!==(t=this.h)&&void 0!==t?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,i)=>{const n=this._$Ep(i,t);void 0!==n&&(this._$Ev.set(n,i),e.push(n))})),e}static createProperty(e,t=Ga){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const i="symbol"==typeof e?Symbol():"__"+e,n=this.getPropertyDescriptor(e,i,t);void 0!==n&&Object.defineProperty(this.prototype,e,n)}}static getPropertyDescriptor(e,t,i){return{get(){return this[t]},set(n){const a=this[e];this[t]=n,this.requestUpdate(e,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||Ga}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),void 0!==e.h&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const i of t)this.createProperty(i,e[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(Va(e))}else void 0!==e&&t.push(Va(e));return t}static _$Ep(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}u(){var e;this._$E_=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(e=this.constructor.h)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,i;(null!==(t=this._$ES)&&void 0!==t?t:this._$ES=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(i=e.hostConnected)||void 0===i||i.call(e))}removeController(e){var t;null===(t=this._$ES)||void 0===t||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{La?e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):t.forEach((t=>{const i=document.createElement("style"),n=qa.litNonce;void 0!==n&&i.setAttribute("nonce",n),i.textContent=t.cssText,e.appendChild(i)}))})(t,this.constructor.elementStyles),t}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$EO(e,t,i=Ga){var n;const a=this.constructor._$Ep(e,i);if(void 0!==a&&!0===i.reflect){const o=(void 0!==(null===(n=i.converter)||void 0===n?void 0:n.toAttribute)?i.converter:Ka).toAttribute(t,i.type);this._$El=e,null==o?this.removeAttribute(a):this.setAttribute(a,o),this._$El=null}}_$AK(e,t){var i;const n=this.constructor,a=n._$Ev.get(e);if(void 0!==a&&this._$El!==a){const e=n.getPropertyOptions(a),o="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==(null===(i=e.converter)||void 0===i?void 0:i.fromAttribute)?e.converter:Ka;this._$El=a,this[a]=o.fromAttribute(t,e.type),this._$El=null}}requestUpdate(e,t,i){let n=!0;void 0!==e&&(((i=i||this.constructor.getPropertyOptions(e)).hasChanged||Ya)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===i.reflect&&this._$El!==e&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(e,i))):n=!1),!this.isUpdatePending&&n&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((e,t)=>this[t]=e)),this._$Ei=void 0);let t=!1;const i=this._$AL;try{t=this.shouldUpdate(i),t?(this.willUpdate(i),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(i)):this._$Ek()}catch(e){throw t=!1,this._$Ek(),e}t&&this._$AE(i)}willUpdate(e){}_$AE(e){var t;null===(t=this._$ES)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){void 0!==this._$EC&&(this._$EC.forEach(((e,t)=>this._$EO(t,this[t],e))),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}};var Za;Ja.finalized=!0,Ja.elementProperties=new Map,Ja.elementStyles=[],Ja.shadowRootOptions={mode:"open"},null==Xa||Xa({ReactiveElement:Ja}),(null!==(Wa=Ha.reactiveElementVersions)&&void 0!==Wa?Wa:Ha.reactiveElementVersions=[]).push("1.5.0");const eo=window,to=eo.trustedTypes,io=to?to.createPolicy("lit-html",{createHTML:e=>e}):void 0,no=`lit$${(Math.random()+"").slice(9)}$`,ao="?"+no,oo=`<${ao}>`,ro=document,so=(e="")=>ro.createComment(e),lo=e=>null===e||"object"!=typeof e&&"function"!=typeof e,co=Array.isArray,uo=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,po=/-->/g,ho=/>/g,mo=RegExp(">|[ \t\n\f\r](?:([^\\s\"'>=/]+)([ \t\n\f\r]*=[ \t\n\f\r]*(?:[^ \t\n\f\r\"'`<>=]|(\"|')|))|$)","g"),fo=/'/g,bo=/"/g,go=/^(?:script|style|textarea|title)$/i,vo=e=>(t,...i)=>({_$litType$:e,strings:t,values:i}),wo=vo(1),yo=vo(2),xo=Symbol.for("lit-noChange"),Io=Symbol.for("lit-nothing"),ko=new WeakMap,$o=ro.createTreeWalker(ro,129,null,!1),So=(e,t)=>{const i=e.length-1,n=[];let a,o=2===t?"<svg>":"",r=uo;for(let t=0;t<i;t++){const i=e[t];let s,l,c=-1,d=0;for(;d<i.length&&(r.lastIndex=d,l=r.exec(i),null!==l);)d=r.lastIndex,r===uo?"!--"===l[1]?r=po:void 0!==l[1]?r=ho:void 0!==l[2]?(go.test(l[2])&&(a=RegExp("</"+l[2],"g")),r=mo):void 0!==l[3]&&(r=mo):r===mo?">"===l[0]?(r=null!=a?a:uo,c=-1):void 0===l[1]?c=-2:(c=r.lastIndex-l[2].length,s=l[1],r=void 0===l[3]?mo:'"'===l[3]?bo:fo):r===bo||r===fo?r=mo:r===po||r===ho?r=uo:(r=mo,a=void 0);const u=r===mo&&e[t+1].startsWith("/>")?" ":"";o+=r===uo?i+oo:c>=0?(n.push(s),i.slice(0,c)+"$lit$"+i.slice(c)+no+u):i+no+(-2===c?(n.push(void 0),t):u)}const s=o+(e[i]||"<?>")+(2===t?"</svg>":"");if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==io?io.createHTML(s):s,n]};class Po{constructor({strings:e,_$litType$:t},i){let n;this.parts=[];let a=0,o=0;const r=e.length-1,s=this.parts,[l,c]=So(e,t);if(this.el=Po.createElement(l,i),$o.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(n=$o.nextNode())&&s.length<r;){if(1===n.nodeType){if(n.hasAttributes()){const e=[];for(const t of n.getAttributeNames())if(t.endsWith("$lit$")||t.startsWith(no)){const i=c[o++];if(e.push(t),void 0!==i){const e=n.getAttribute(i.toLowerCase()+"$lit$").split(no),t=/([.?@])?(.*)/.exec(i);s.push({type:1,index:a,name:t[2],strings:e,ctor:"."===t[1]?Eo:"?"===t[1]?Ro:"@"===t[1]?To:Co})}else s.push({type:6,index:a})}for(const t of e)n.removeAttribute(t)}if(go.test(n.tagName)){const e=n.textContent.split(no),t=e.length-1;if(t>0){n.textContent=to?to.emptyScript:"";for(let i=0;i<t;i++)n.append(e[i],so()),$o.nextNode(),s.push({type:2,index:++a});n.append(e[t],so())}}}else if(8===n.nodeType)if(n.data===ao)s.push({type:2,index:a});else{let e=-1;for(;-1!==(e=n.data.indexOf(no,e+1));)s.push({type:7,index:a}),e+=no.length-1}a++}}static createElement(e,t){const i=ro.createElement("template");return i.innerHTML=e,i}}function Ao(e,t,i=e,n){var a,o,r,s;if(t===xo)return t;let l=void 0!==n?null===(a=i._$Co)||void 0===a?void 0:a[n]:i._$Cl;const c=lo(t)?void 0:t._$litDirective$;return(null==l?void 0:l.constructor)!==c&&(null===(o=null==l?void 0:l._$AO)||void 0===o||o.call(l,!1),void 0===c?l=void 0:(l=new c(e),l._$AT(e,i,n)),void 0!==n?(null!==(r=(s=i)._$Co)&&void 0!==r?r:s._$Co=[])[n]=l:i._$Cl=l),void 0!==l&&(t=Ao(e,l._$AS(e,t.values),l,n)),t}class Oo{constructor(e,t){this.u=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(e){var t;const{el:{content:i},parts:n}=this._$AD,a=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:ro).importNode(i,!0);$o.currentNode=a;let o=$o.nextNode(),r=0,s=0,l=n[0];for(;void 0!==l;){if(r===l.index){let t;2===l.type?t=new Mo(o,o.nextSibling,this,e):1===l.type?t=new l.ctor(o,l.name,l.strings,this,e):6===l.type&&(t=new Do(o,this,e)),this.u.push(t),l=n[++s]}r!==(null==l?void 0:l.index)&&(o=$o.nextNode(),r++)}return a}p(e){let t=0;for(const i of this.u)void 0!==i&&(void 0!==i.strings?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}class Mo{constructor(e,t,i,n){var a;this.type=2,this._$AH=Io,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=n,this._$Cm=null===(a=null==n?void 0:n.isConnected)||void 0===a||a}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cm}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Ao(this,e,t),lo(e)?e===Io||null==e||""===e?(this._$AH!==Io&&this._$AR(),this._$AH=Io):e!==this._$AH&&e!==xo&&this.g(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>co(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]))(e)?this.k(e):this.g(e)}O(e,t=this._$AB){return this._$AA.parentNode.insertBefore(e,t)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}g(e){this._$AH!==Io&&lo(this._$AH)?this._$AA.nextSibling.data=e:this.T(ro.createTextNode(e)),this._$AH=e}$(e){var t;const{values:i,_$litType$:n}=e,a="number"==typeof n?this._$AC(e):(void 0===n.el&&(n.el=Po.createElement(n.h,this.options)),n);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===a)this._$AH.p(i);else{const e=new Oo(a,this),t=e.v(this.options);e.p(i),this.T(t),this._$AH=e}}_$AC(e){let t=ko.get(e.strings);return void 0===t&&ko.set(e.strings,t=new Po(e)),t}k(e){co(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,n=0;for(const a of e)n===t.length?t.push(i=new Mo(this.O(so()),this.O(so()),this,this.options)):i=t[n],i._$AI(a),n++;n<t.length&&(this._$AR(i&&i._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){var i;for(null===(i=this._$AP)||void 0===i||i.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cm=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class Co{constructor(e,t,i,n,a){this.type=1,this._$AH=Io,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=a,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=Io}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,i,n){const a=this.strings;let o=!1;if(void 0===a)e=Ao(this,e,t,0),o=!lo(e)||e!==this._$AH&&e!==xo,o&&(this._$AH=e);else{const n=e;let r,s;for(e=a[0],r=0;r<a.length-1;r++)s=Ao(this,n[i+r],t,r),s===xo&&(s=this._$AH[r]),o||(o=!lo(s)||s!==this._$AH[r]),s===Io?e=Io:e!==Io&&(e+=(null!=s?s:"")+a[r+1]),this._$AH[r]=s}o&&!n&&this.j(e)}j(e){e===Io?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class Eo extends Co{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Io?void 0:e}}const _o=to?to.emptyScript:"";class Ro extends Co{constructor(){super(...arguments),this.type=4}j(e){e&&e!==Io?this.element.setAttribute(this.name,_o):this.element.removeAttribute(this.name)}}class To extends Co{constructor(e,t,i,n,a){super(e,t,i,n,a),this.type=5}_$AI(e,t=this){var i;if((e=null!==(i=Ao(this,e,t,0))&&void 0!==i?i:Io)===xo)return;const n=this._$AH,a=e===Io&&n!==Io||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,o=e!==Io&&(n===Io||a);a&&this.element.removeEventListener(this.name,this,n),o&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,i;"function"==typeof this._$AH?this._$AH.call(null!==(i=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==i?i:this.element,e):this._$AH.handleEvent(e)}}class Do{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){Ao(this,e)}}const qo=eo.litHtmlPolyfillSupport;null==qo||qo(Po,Mo),(null!==(Za=eo.litHtmlVersions)&&void 0!==Za?Za:eo.litHtmlVersions=[]).push("2.5.0");const Lo=(e,t,i)=>{var n,a;const o=null!==(n=null==i?void 0:i.renderBefore)&&void 0!==n?n:t;let r=o._$litPart$;if(void 0===r){const e=null!==(a=null==i?void 0:i.renderBefore)&&void 0!==a?a:null;o._$litPart$=r=new Mo(t.insertBefore(so(),e),e,void 0,null!=i?i:{})}return r._$AI(e),r};var jo,Uo;class No extends Ja{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const i=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=i.firstChild),i}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Lo(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!1)}render(){return xo}}No.finalized=!0,No._$litElement$=!0,null===(jo=globalThis.litElementHydrateSupport)||void 0===jo||jo.call(globalThis,{LitElement:No});const zo=globalThis.litElementPolyfillSupport;null==zo||zo({LitElement:No}),(null!==(Uo=globalThis.litElementVersions)&&void 0!==Uo?Uo:globalThis.litElementVersions=[]).push("3.2.2");const Bo=(e,t)=>"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?{...t,finisher(i){i.createProperty(t.key,e)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:t.key,initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(i){i.createProperty(t.key,e)}};function Vo(e){return(t,i)=>void 0!==i?((e,t,i)=>{t.constructor.createProperty(i,e)})(e,t,i):Bo(e,t)}function Wo(e,t){return(({finisher:e,descriptor:t})=>(i,n)=>{var a;if(void 0===n){const n=null!==(a=i.originalKey)&&void 0!==a?a:i.key,o=null!=t?{kind:"method",placement:"prototype",key:n,descriptor:t(i.key)}:{...i,key:n};return null!=e&&(o.finisher=function(t){e(t,n)}),o}{const a=i.constructor;void 0!==t&&Object.defineProperty(i,n,t(n)),null==e||e(a,n)}})({descriptor:i=>{const n={get(){var t,i;return null!==(i=null===(t=this.renderRoot)||void 0===t?void 0:t.querySelector(e))&&void 0!==i?i:null},enumerable:!0,configurable:!0};if(t){const t="symbol"==typeof i?Symbol():"__"+i;n.get=function(){var i,n;return void 0===this[t]&&(this[t]=null!==(n=null===(i=this.renderRoot)||void 0===i?void 0:i.querySelector(e))&&void 0!==n?n:null),this[t]}}return n}})}var Ho;function Fo(e){return[e].flat()}null===(Ho=window.HTMLSlotElement)||void 0===Ho||Ho.prototype.assignedElements;const Qo=e=>void 0!==e;function Xo(...e){return function(t){var i;return(i=class extends t{}).styles=function(e,t){var i;return[...null!==(i=Fo(e))&&void 0!==i?i:[],...Fo(t)].flat().filter(Qo)}(t.styles,e),i}}function Ko(e){return class extends e{connectedCallback(){super.connectedCallback(),this.setAttribute("focusable","")}}}var Yo=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},Go=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i};function Jo(...e){return function(t){var i,n;return n=class extends t{constructor(){super(...arguments),i.set(this,[])}connectedCallback(){super.connectedCallback();const t=()=>{this.requestUpdate()};Go(this,i,e.map((e=>e(t))),"f")}disconnectedCallback(){super.disconnectedCallback();for(const e of Yo(this,i,"f"))e();Go(this,i,[],"f")}},i=new WeakMap,n}}function Zo(e){return function(t){return class extends t{get share(){return e}}}}function er(e){return function(t){return class extends t{get share(){throw new Error("share required by component"+(e?" "+e:""))}}}}var tr=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i},ir=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};var nr,ar,or=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},rr=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i};class sr extends(function(e){return class extends e{connectedCallback(){super.connectedCallback(),this.hasAttribute("initially-hidden")&&this.removeAttribute("initially-hidden")}}}(No)){constructor(){super(...arguments),nr.set(this,[]),ar.set(this,(()=>{}))}init(){}firstUpdated(e){super.firstUpdated(e),this.init()}addSubscription(e){if(or(this,nr,"f").push(e),this.isConnected){const t=e(),i=or(this,ar,"f");rr(this,ar,(()=>{t(),i()}),"f")}}subscribe(){const e=or(this,nr,"f").map((e=>e()));return()=>e.forEach((e=>e()))}connectedCallback(){super.connectedCallback(),rr(this,ar,this.subscribe(),"f")}disconnectedCallback(){super.disconnectedCallback(),or(this,ar,"f").call(this),rr(this,ar,(()=>{}),"f")}render(){throw new Error("component render method not implemented")}}nr=new WeakMap,ar=new WeakMap;var lr=Ba`

* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

:focus {
	outline: var(--focus-outline, 2px solid cyan);
}

:host-context(:focus) {
	outline: 0 !important;
}

`,cr=Ba`

:host {
	display: inline-block;
	position: relative;
	width: 6em;
}

:host::before {
	opacity: 0;
	content: "copied!";
	display: block;
	position: absolute;
	top: -0.5em;
	right: -0.5em;
	background: #0a0c;
	padding: 0 0.5em;
	border-radius: 1em;
	pointer-events: none;
	z-index: 1;
}

:host(:not([copied]))::before {
	transition: opacity 500ms ease;
}

:host([copied])::before {
	opacity: 1;
}

button {
	font: inherit;
	color: inherit;
	background: transparent;
	width: 100%;
}

.container {
	position: relative;
	display: flex;
	flex-direction: row;
	user-select: none;
	cursor: pointer;
	border: none;
}

.content {
	display: flex;
	justify-content: row;
}

.label::after {
	content: ":";
	margin-right: 0.2em;
}

.id {
	opacity: 0.75;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

.copy svg {
	width: 1em;
	height: 1em;
}

.copy {
	opacity: 0.4;
	transition: opacity 100ms linear;
}

.container:hover .copy {
	opacity: 0.9;
}

.container:active .copy {
	opacity: 1;
}

`,dr=yo`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>`,ur=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let pr=class extends sr{constructor(){super(...arguments),this.copied=!1}async copy(){try{await navigator.clipboard.writeText(this.id);const e=document.activeElement;e&&e.blur(),this.copyTimeout&&clearTimeout(this.copyTimeout),this.copied=!0,this.copyTimeout=setTimeout((()=>{this.copied=!1,this.copyTimeout=void 0}),1e3)}catch(e){console.error("failed to copy")}}render(){return wo`
			<button class=container @click=${this.copy}>
				<div class=id>${this.id}</div>
				<div class=copy>
					${dr}
				</div>
			</button>
		`}};ur([Vo()],pr.prototype,"id",void 0),ur([Vo({type:Boolean,reflect:!0})],pr.prototype,"copied",void 0),pr=ur([Ko,Xo(cr)],pr);var hr=Ba`

slot {
	vertical-align: middle;
}

svg, span {
	display: inline-block;
	vertical-align: middle;
}

svg {
	width: var(--op-size, 1.2em);
	height: var(--op-size, 1.2em);
}

slot[name=loading] svg {
	animation:
		spin 10s linear infinite,
		fade 500ms ease infinite alternate;
}

slot[name=error] * {
	color: var(--loading-error-color, red);
}

@keyframes spin {
	from { transform: rotate(0deg); }
	to { transform: rotate(360deg); }
}

@keyframes fade {
	from { opacity: 1.0; }
	to { opacity: 0.5; }
}

`,mr=yo`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 20 20"><g fill="none"><path d="M10 7a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0v-4A.5.5 0 0 1 10 7z" fill="currentColor"/><path d="M10 14.5a.75.75 0 1 0 0-1.5a.75.75 0 0 0 0 1.5z" fill="currentColor"/><path d="M8.686 2.852a1.5 1.5 0 0 1 2.628 0l6.56 11.925A1.5 1.5 0 0 1 16.558 17H3.44a1.5 1.5 0 0 1-1.314-2.223L8.686 2.852zm1.752.482a.5.5 0 0 0-.876 0L3.003 15.26a.5.5 0 0 0 .438.741H16.56a.5.5 0 0 0 .438-.74L10.438 3.333z" fill="currentColor"/></g></svg>`,fr=yo`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-loader"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>`,br=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let gr=class extends sr{constructor(){super(...arguments),this.mode="none",this._op=re.none(),this.errorIcon=mr,this.loadingIcon=fr,this["loading-message"]="",this["error-message"]="error",this["hide-error-text"]=!1}get op(){return this._op}set op(e){const t=this._op;this._op=e,this.mode=re.mode(e),this.requestUpdate("op",t)}firstUpdated(){this["start-loading"]&&(this.op=re.loading())}render(){return re.select(this.op,{none:()=>wo`
				<slot name=none></slot>
			`,loading:()=>wo`
				<slot name=loading>
					${this.loadingIcon}
					${this["loading-message"]?wo`<span>${this["loading-message"]}</span>`:null}
				</slot>
			`,error:e=>wo`
				<slot name=error>
					${this.errorIcon}
					${this["hide-error-text"]?null:wo`<span>${null!=e?e:this["error-message"]}</span>`}
					
				</slot>
			`,ready:()=>wo`
				<slot></slot>
			`})}};function vr(e){return Array.from(e.assignedNodes()).filter((e=>e instanceof HTMLElement))}br([Vo({type:String,reflect:!0})],gr.prototype,"mode",void 0),br([Vo({type:Object})],gr.prototype,"op",null),br([Vo()],gr.prototype,"errorIcon",void 0),br([Vo()],gr.prototype,"loadingIcon",void 0),br([Vo({type:String})],gr.prototype,"loading-message",void 0),br([Vo({type:String})],gr.prototype,"error-message",void 0),br([Vo({type:Boolean})],gr.prototype,"hide-error-text",void 0),br([Vo({type:Boolean})],gr.prototype,"start-loading",void 0),gr=br([Xo(hr)],gr);var wr,yr,xr=Ba`

:host {
	display: block;
	width: 2em;
	height: 2em;
}

:host([theme="concrete"]) [part="button"] {
	display: block;
	font-size: inherit;
	color: inherit;
	position: relative;
	padding: 0;
	border: none;
	background: transparent;
	width: 100%;
	height: 100%;
}

:host([theme="concrete"]) [part="buttoncontent"] {
	display: flex;
	width: 100%;
	height: 100%;
	justify-content: center;
	align-items: center;
}

:host([theme="concrete"]) [part="buttoncontent"] {
	transform: scale(1);
	transition: transform 100ms ease;
}

:host([theme="concrete"]) [part="buttoncontent"]:active {
	transform: scale(1.1);
}

[part="panel"] {
	display: none;
}

:host([open]) [part="panel"] {
	display: block;
}

:host([theme="concrete"]) [part="panel"] {
	position: absolute;
	left: var(--menu-lanesize, 1rem);
	right: var(--menu-lanesize, 1rem);
	width: var(--menu-panel-width, 640px);
	max-width: calc(100% - calc(var(--menu-lanesize, 1rem) * 2));
	margin-top: var(--menu-padding, 0.15rem);
	margin-left: auto;
	padding: var(--menu-panel-padding, 1rem);
	background: var(--menu-panel-background, white);
	border-radius: var(--menu-panel-border-radius, 0);
	box-shadow: var(--menu-panel-box-shadow, none);
	backdrop-filter: var(--menu-panel-backdrop-filter, none);
	--webkit-backdrop-filter: var(--menu-panel-backdrop-filter, none);
}

:host([theme="concrete"][sticky]) [part="panel"] {
	top: 100%;
}

:host([theme="concrete"][lefty]) [part="panel"] {
	margin-left: unset;
	margin-right: auto;
}

`,Ir=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},kr=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},$r=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i};class Sr extends CustomEvent{constructor(e){super("menuPanelChange",{detail:e,bubbles:!0})}}let Pr=class extends sr{constructor(){super(...arguments),wr.set(this,!1),this.theme="",this.lefty=!1,this.open=!1,yr.set(this,(()=>{kr(this,wr,"f")&&(this.toggle(),this.shadowRoot.querySelector("button").focus())}))}toggle(e=!this.open){this.open=e;const t=new Sr({open:e});this.dispatchEvent(t),this.onMenuPanelChange&&this.onMenuPanelChange(t)}updated(e){const t=!!vr(this.shadowRoot.querySelector('slot[name="panel"]')).length;kr(this,wr,"f")!==t&&($r(this,wr,t,"f"),this.requestUpdate())}render(){return wo`
			<button
				part=button
				tabindex=${kr(this,wr,"f")?0:-1}
				@click=${kr(this,yr,"f")}>
					<slot part=buttoncontent></slot>
			</button>
			<slot name=panel part=panel></slot>
		`}};wr=new WeakMap,yr=new WeakMap,Ir([Vo({type:String,reflect:!0})],Pr.prototype,"theme",void 0),Ir([Vo({type:Boolean,reflect:!0})],Pr.prototype,"lefty",void 0),Ir([Vo({type:Boolean,reflect:!0})],Pr.prototype,"open",void 0),Pr=Ir([Xo(xr)],Pr);var Ar,Or,Mr,Cr,Er,_r,Rr,Tr,Dr=Ba`

.system {
	position: static;
	margin: var(--menu-margin, auto);
}

:host([theme="concrete"]) .system {
	display: flex;
	align-items: flex-end;
	justify-content: flex-end;
}

:host([theme="concrete"][sticky]) .system {
	pointer-events: none;
	position: absolute;
	width: 100%;
	right: 0;
}

:host([theme="concrete"][sticky]) .system > * {
	pointer-events: all;
}

:host([theme="concrete"][lefty]) .system {
	right: auto;
	left: 0;
	align-items: flex-start;
	justify-content: flex-start;
}

:host([theme="concrete"]) [part="blanket"] {
	z-index: 99;
	display: none;
	position: fixed;
	background: var(--menu-blanket-background, rgba(0,0,0, 0.5));
	backdrop-filter: var(--menu-blanket-backdrop-filter, blur(5px));
	--webkit-backdrop-filter: var(--menu-blanket-backdrop-filter, blur(5px));
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
}

:host([theme="concrete"][active]) [part="blanket"] {
	display: block;
}

:host([theme="concrete"]) [part="list"] {
	z-index: 100;
	display: flex;
	align-items: flex-end;
	justify-content: flex-end;
	padding: var(--menu-padding, 0.15rem);
	background: var(--menu-background, rgba(240, 240, 240, 0.5));
	border-radius: var(--menu-border-radius, 0);
}

:host([theme="concrete"][sticky]) [part="list"] {
	margin-right: var(--menu-lanesize, 1rem);
}

:host([theme="concrete"][sticky][lefty]) [part="list"] {
	margin-right: unset;
	margin-left: var(--menu-lanesize, 1rem);
}

:host([theme="concrete"]) [part="list"] slot::slotted(menu-item) {
	display: block;
	flex: 0 0 auto;
}

`,qr=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},Lr=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},jr=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i};let Ur=class extends sr{constructor(){super(...arguments),Ar.add(this),this.theme="concrete",this.active=!1,this.sticky=!1,this.lefty=!1,Or.set(this,ye({activeIndex:void 0,scrollTop:0})),Mr.set(this,(()=>{})),Cr.set(this,["scroll","resize"]),Er.set(this,(()=>{var e,t;this.active||(Lr(this,Or,"f").state.scrollTop=this.sticky&&null!==(t=null!==(e=window.scrollY)&&void 0!==e?e:window.pageYOffset)&&void 0!==t?t:0)})),_r.set(this,(()=>{const e=this.getMenuItems();for(const t of e)t.toggle(!1)})),Tr.set(this,(({target:e,detail:{open:t}})=>{const i=this.getMenuItems();t&&Lr(this,Ar,"m",Rr).call(this,e,i),this.active=!!i.find((e=>e.open)),Lr(this,Er,"f").call(this)}))}createRenderRoot(){const e=super.createRenderRoot();return e.addEventListener("slotchange",(()=>this.requestUpdate())),e}connectedCallback(){super.connectedCallback(),jr(this,Mr,Lr(this,Or,"f").track((()=>this.render()),(()=>this.requestUpdate())),"f"),Lr(this,Er,"f").call(this);for(const e of Lr(this,Cr,"f"))window.addEventListener(e,Lr(this,Er,"f"))}disconnectedCallback(){super.disconnectedCallback(),Lr(this,Mr,"f").call(this),jr(this,Mr,(()=>{}),"f");for(const e of Lr(this,Cr,"f"))window.removeEventListener(e,Lr(this,Er,"f"))}getMenuItems(){return vr(this.shadowRoot.querySelector("slot")).filter((e=>e instanceof Pr))}updated(){for(const e of this.getMenuItems())e.theme=this.theme}render(){const{scrollTop:e,activeIndex:t}=Lr(this,Or,"f").state;return wo`
			<div class=system data-active-index=${t} style="${`top: ${e}px`}">
				<div part=blanket @click=${Lr(this,_r,"f")}></div>
				<div part=list @menuPanelChange=${Lr(this,Tr,"f")}>
					<slot></slot>
				</div>
			</div>
		`}};Or=new WeakMap,Mr=new WeakMap,Cr=new WeakMap,Er=new WeakMap,_r=new WeakMap,Tr=new WeakMap,Ar=new WeakSet,Rr=function(e,t){const i=t.filter((t=>t!==e));for(const e of i)e.open=!1},qr([Vo({type:String,reflect:!0})],Ur.prototype,"theme",void 0),qr([Vo({type:Boolean,reflect:!0})],Ur.prototype,"active",void 0),qr([Vo({type:Boolean,reflect:!0})],Ur.prototype,"sticky",void 0),qr([Vo({type:Boolean,reflect:!0})],Ur.prototype,"lefty",void 0),Ur=qr([Xo(Dr)],Ur);var Nr=Ba`

:host {
	display: inline-block;
	width: var(--avatar-size, 2em);
	height: var(--avatar-size, 2em);
	border-radius: var(--avatar-border-radius, 0.3em);
	overflow: hidden;
	user-select: none;
}

.avatar {
	display: block;
	width: 100%;
	height: 100%;
	color: var(--xio-avatar-color, #444);
	background: var(--xio-avatar-background, #888);
}

.avatar[data-logged-in] {
	color: #fff;
}

svg, img {
	pointer-events: none;
	display: block;
	width: 100%;
	height: 100%;
	object-fit: cover;
}

`,zr=yo`<svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill="currentColor" fill-rule="evenodd" d="M12 14.002a.998.998 0 0 1-.998.998H1.001A1 1 0 0 1 0 13.999V13c0-2.633 4-4 4-4s.229-.409 0-1c-.841-.62-.944-1.59-1-4 .173-2.413 1.867-3 3-3s2.827.586 3 3c-.056 2.41-.159 3.38-1 4-.229.59 0 1 0 1s4 1.367 4 4v1.002z"/></svg>`;function Br(e,t,i){return e<t?t:e>i?i:e}function Vr(e,t,i){return`hsl(${e%360}, ${Br(t,0,100)}%, ${Br(i,0,100)}%)`}var Wr=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let Hr=class extends sr{renderBlankAvatar(e){return wo`
			<div class=avatar>
				${zr}
			</div>
		`}renderSimpleAvatar({value:e}){const{color1:t,color2:i,color3:n}=function(e){const t=Math.ceil(360*e),i=(t-30)%360,n=(t+30)%360;return{color1:Vr(t,100,90),color2:Vr(i,50,60),color3:Vr(n,50,40)}}(e);return wo`
			<div class=avatar style=${`color: ${t}; background: linear-gradient(to bottom right, ${i}, ${n});`}>
				${zr}
			</div>
		`}renderImageAvatar({link:e}){return wo`
			<div class=avatar>
				<img src="${e}" alt=""/>
			</div>
		`}render(){const{spec:e={type:"blank"}}=this;switch(e.type){case"blank":return this.renderBlankAvatar(e);case"simple":return this.renderSimpleAvatar(e);case"image":return this.renderImageAvatar(e);default:return wo`avatar missing`}}};Wr([Vo({type:Object})],Hr.prototype,"spec",void 0),Hr=Wr([Xo(Nr)],Hr);var Fr=Ba`

:host {
	display: inline-block;
	width: max-content;
	height: max-content;
	--_padding: var(--xio-button-padding, 0.2em 0.5em);
	--_background: var(--xio-button-background, transparent);
	--_border: var(--xio-button-border, 1px solid);
	--_border-radius: var(--xio-button-border-radius, 0);
	--_opacity: var(--xio-button-opacity, 0.7);
	--_hover-opacity: var(--xio-button-hover-opacity, 1);
	--_hover-color: var(--xio-button-hover-color, inherit);
	--_hover-background: var(--xio-button-hover-background, var(--_background));
	--_disabled-opacity: var(--xio-button-disabled-opacity, 0.2);
	--_disabled-border-style: var(--xio-button-disabled-border-style, dashed);
}

button {
	width: 100%;
	height: 100%;
	cursor: pointer;
	font: inherit;
	color: inherit;
	padding: var(--_padding);
	font-weight: bold;
	background: var(--_background);
	border: var(--_border);
	border-radius: var(--_border-radius);
	opacity: var(--_opacity);
}

button:not([disabled]):hover,
button:not([disabled]):focus {
	opacity: var(--_hover-opacity);
	color: var(--_hover-color);
	background: var(--_hover-background);
}

button[disabled] {
	cursor: default;
	opacity: var(--_disabled-opacity);
	border-style: var(--_disabled-border-style);
}

`;class Qr extends CustomEvent{constructor(e){super("press",{detail:e})}}var Xr=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let Kr=class extends sr{constructor(){super(...arguments),this.disabled=!1,this.handleClick=()=>{const e=new Qr(this);this.onpress&&this.onpress(e),this.disabled||this.dispatchEvent(e),e.stopPropagation()}}focus(){this.shadowRoot.querySelector("button").focus()}render(){return wo`
			<button
				part=button
				@click=${this.handleClick}
				?disabled=${this.disabled}>
					<slot part=button-slot></slot>
			</button>
		`}};Xr([Vo({type:Boolean,reflect:!0})],Kr.prototype,"disabled",void 0),Xr([Vo({type:Function})],Kr.prototype,"onpress",void 0),Kr=Xr([Ko,Xo(Fr)],Kr);var Yr=Ba`

.example {
	color: #f90;
}

`,Gr=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let Jr=class extends sr{render(){return wo`
			<div class=example>
				<p>xio-example</p>
				<slot></slot>
			</div>
		`}};Jr=Gr([Xo(Yr)],Jr);var Zr=Ba`

* {box-sizing: border-box;}

:host {
	display: inline-block;
	vertical-align: middle;
	color: white;
}

:host([disabled]) {
	opacity: 0.25;
}

button {
	display: inline-block;
	border: unset;
	color: unset;
	background: unset;
}

button {
	position: relative;
	width: 1.5em;
	height: 1.5em;
	background: #3338;
	box-shadow: inset 1px 2px 3px #000a;
	border-radius: 0.5em;
	border: 1px solid #fff4;
}

button[data-mode="ready"] {
	cursor: pointer;
}

button[data-mode="ready"]:hover,
button[data-mode="ready"]:focus {
	background: #5558;
	border: 1px solid #fff8;
}

button > span {
	display: inline-block;
}

button svg {
	width: 100%;
	height: 100%;
}

button .error {
	display: inline-block;
	position: absolute;
	top: 80%;
	left: 0;
	width: max-content;
	max-width: 16em;
	color: red;
	background: #200a;
	text-shadow: 1px 2px 3px #0008;
	text-align: left;
	padding: 0.2em 0.5em;
	border-radius: 0.5em;
	pointer-events: none;
}

button[data-mode="loading"] svg,
button[data-mode="error"] svg {
	padding: 10%;
}

button[data-mode="error"] svg {
	color: red;
	animation: fade 1s ease infinite alternate;
}

button[data-mode="loading"] svg {
	animation:
		spin 10s linear infinite,
		fade 500ms ease infinite alternate;
}

@keyframes spin {
	from { transform: rotate(0deg); }
	to { transform: rotate(360deg); }
}

@keyframes fade {
	from { opacity: 1.0; }
	to { opacity: 0.5; }
}

`;class es extends CustomEvent{constructor(e){super("press",{detail:e})}}var ts=yo`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg>`,is=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let ns=class extends sr{constructor(){super(...arguments),this.loading=re.none(),this["initially-checked"]=!1,this["error-message"]="error",this.disabled=!1,this.handleClick=()=>{if(!this.disabled){this.toggle();const e=document.activeElement;e&&e.blur()}}}init(){this.loading=re.ready(this["initially-checked"])}get checked(){return re.value(this.loading)}set checked(e){this.loading=re.ready(e)}async toggle(e=re.value(this.loading),t=!0){const i=!e,n=!this.disabled,a=re.isReady(this.loading);return n&&a?re.operation({setOp:e=>this.loading=e,errorReason:this["error-message"],promise:(async()=>{var e;if(await(null!==(e=this.save)&&void 0!==e?e:async()=>{})(i),t){const e=new es(this);this.oncheck&&this.oncheck(e),this.dispatchEvent(e),e.stopPropagation()}return i})()}):i}render(){return wo`
			<button
				data-mode="${re.mode(this.loading)}"
				?data-checked=${re.value(this.loading)}
				@click=${this.handleClick}>
					${re.select(this.loading,{none:()=>null,loading:()=>fr,error:e=>wo`${mr}<div class=error>${e}</div>`,ready:e=>e?ts:null})}
			</button>
		`}};is([Vo()],ns.prototype,"loading",void 0),is([Vo({type:Boolean})],ns.prototype,"initially-checked",void 0),is([Vo({type:String})],ns.prototype,"error-message",void 0),is([Vo({type:Boolean,reflect:!0})],ns.prototype,"disabled",void 0),is([Vo({type:Function})],ns.prototype,"oncheck",void 0),is([Vo({type:Function})],ns.prototype,"save",void 0),ns=is([Ko,Xo(Zr)],ns);var as=Ba`

/* * { outline: 1px solid #f002; } */

:host {
	display: block;
	width: 100%;
	max-width: 48rem;
	--height: var(--xio-text-input-height, 5rem);
	--pad: var(--xio-text-input-pad, 0.2em);
	--font: var(--xio-text-input-font, inherit);
	--color: var(--xio-text-input-color, inherit);
	--label-font: var(--xio-text-input-label-font, inherit);
	--label-color: var(--xio-text-input-label-color, inherit);
	--problems-font: var(--xio-text-input-problems-font, inherit);
	--problems-color: var(--xio-text-input-problems-color);
	--background: var(--xio-text-input-background, transparent);
	--valid-color: var(--xio-text-input-valid-color, #00ff8c);
	--invalid-color: var(--xio-text-input-invalid-color, #ff6100);
	--border: var(--xio-text-input-border, 1px solid);
	--border-radius: var(--xio-text-input-border-radius, 0.3em);
}

:host([disabled]) [part="inputbox"] {
	opacity: 0.4;
}

:host([hidden]) {
	display: none;
}

label {
	font: var(--label-font);
	color: var(--label-color);
}

slot {
	display: block;
	padding: 0 var(--pad);
}

.flexy {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
}

.flexy > * {
	flex: 0 0 auto;
}

:host([textarea]) .flexy {
	flex-direction: column;
}

[part="inputbox"] {
	display: block;
	/* max-width: var(--width); */
	position: relative;
	flex: 1 1 auto;
}

:host([textarea]) [part="inputbox"] {
	flex: 1 1 auto;
	/* max-width: unset; */
}

[part="inputbox"] svg {
	position: absolute;
	display: block;
	top: var(--pad);
	right: var(--pad);
	width: 1.2em;
	height: 1.2em;
	pointer-events: none;
}

.container[data-valid] [part="inputbox"] svg {
	color: var(--valid-color);
}

.container:not([data-valid]) [part="inputbox"] svg {
	color: var(--invalid-color);
}

#textinput {
	min-width: 1em;
	width: 100%;
	font: var(--font);
	padding: var(--pad);
	padding-right: calc(1em + calc(2 * var(--pad)));
	margin: 0;
	color: var(--color);
	background: var(--background);
	border: var(--border);
	border-radius: var(--border-radius);
	text-overflow: ellipsis;
}

textarea {
	min-height: var(--height);
}

[part="problems"] {
	display: flex;
	font: var(--problems-font);
	padding: 0 calc(2 * var(--pad));
	flex-direction: column;
	justify-content: flex-start;
	flex: 1 1 auto;
	/* min-width: 12rem; */
	list-style: none;
	color: var(--problems-color, var(--invalid-color));
}

[part="problems"] > li {
	margin-top: 0.2em;
}

`,os=yo`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check-circle"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><path d="M22 4L12 14.01l-3-3"/></svg>`;function rs(e){return e}class ss extends CustomEvent{constructor(){super("enterpress",{bubbles:!0,composed:!0,detail:void 0})}}class ls extends CustomEvent{constructor(e){super("valuechange",{bubbles:!0,composed:!0,detail:{value:e}})}}var cs=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let ds=class extends sr{constructor(){super(...arguments),this.initial="",this.readonly=!1,this.textarea=!1,this["hide-validation"]=!1,this["show-validation-when-empty"]=!1,this.disabled=!1,this.placeholder="",this.hidden=!1,this.parser=rs,this.problems=[],this.onvaluechange=()=>{},this.onenterpress=()=>{},this.draft="",this.lastDraft="",this.vettedLength=0,this.dispatchValueChange=()=>{const{draft:e,lastDraft:t}=this;e!==t&&(this.vettedLength=e.length,this.dispatchEvent(new ls(this.value))),this.lastDraft=e},this.dispatchValueChangeDebounced=he(250,this.dispatchValueChange),this.dispatchEnterPress=()=>{this.dispatchEvent(new ss)},this.updateDraft=()=>{this.draft=this.input.value},this.handleInputKeyPress=e=>{if("Enter"===e.key){const t=this.textarea,i=e.shiftKey,n=()=>{this.updateDraft(),this.dispatchValueChange(),this.dispatchEnterPress(),e.preventDefault()};t?i&&n():n()}},this.handleInput=()=>{this.updateDraft(),this.dispatchValueChangeDebounced()},this.handleChange=()=>{this.updateDraft(),this.dispatchValueChange()}}get input(){return this.shadowRoot?this.shadowRoot.querySelector("#textinput"):void 0}focus(){this.input&&this.input.focus()}get value(){var e;const{draft:t}=this,i=(null!==(e=this.parser)&&void 0!==e?e:rs)(t);return this.problems=this.validator?this.validator(i):[],0===this.problems.length?i:void 0}get text(){return this.draft}set text(e){const{input:t}=this;t?(this.input.value=e,this.updateDraft(),this.dispatchValueChange()):this.initial=e}init(){const{initial:e}=this;this.draft=e,this.lastDraft=e,this.text=e,this.addEventListener("valuechange",this.onvaluechange),this.addEventListener("enterpress",this.onenterpress),this.dispatchValueChange()}render(){const{readonly:e,disabled:t,problems:i,vettedLength:n,placeholder:a,textarea:o,validator:r,handleInput:s,handleInputKeyPress:l,handleChange:c}=this,d=0===i.length,u=!this["hide-validation"]&&!e&&r&&(!!this["show-validation-when-empty"]||0!==n);return wo`
			<div class=container ?data-valid=${d}>
				<label for=textinput part=label><slot></slot></label>
				<div class=flexy>
					<div part=inputbox>
						${u?u?d?os:mr:null:null}
						${o?wo`
							<textarea
								id=textinput
								part=textinput
								?disabled=${t}
								?readonly=${e}
								tabindex=${e?"-1":"0"}
								placeholder=${a}
								@input=${s}
								@keypress=${l}
								@change=${c}
							></textarea>
						`:wo`
							<input
								id=textinput
								type=text
								part=textinput
								?disabled=${t}
								?readonly=${e}
								tabindex=${e?"-1":"0"}
								placeholder=${a}
								@input=${s}
								@keypress=${l}
								@change=${c}
								/>
						`}
					</div>
					<ol part=problems>
						${u&&!d?i.map((e=>wo`
								<li>${e}</li>
							`)):null}
					</ol>
				</div>
			</div>
		`}};function*us(e){function t(e,i){let n=[];const[a,o,r]=e,s=i?`${i} ${a}`.replaceAll(/(\s+)*(\^)/gm,""):a;const l=Object.entries(o);if(l.length>0){const e=l.map((([e,t])=>`\t${e}: ${ps(t)};`)).join("\n");n.push(`${ps(s)} {\n${e}\n}`)}for(const e of r)n=[...n,...t(e,s)];return n}yield"\n";for(const i of e)yield"\n"+t(i,void 0).join("\n");yield"\n"}function ps(e){return e.replaceAll(/(\s*)(\/\/.*)$/gm,"")}var hs;cs([Vo({type:String,reflect:!0})],ds.prototype,"initial",void 0),cs([Vo({type:Boolean,reflect:!0})],ds.prototype,"readonly",void 0),cs([Vo({type:Boolean,reflect:!0})],ds.prototype,"textarea",void 0),cs([Vo({type:Boolean,reflect:!0})],ds.prototype,"hide-validation",void 0),cs([Vo({type:Boolean,reflect:!0})],ds.prototype,"show-validation-when-empty",void 0),cs([Vo({type:Boolean,reflect:!0})],ds.prototype,"disabled",void 0),cs([Vo({type:String,reflect:!0})],ds.prototype,"placeholder",void 0),cs([Vo({type:Boolean,reflect:!0})],ds.prototype,"hidden",void 0),cs([Vo({type:Function})],ds.prototype,"parser",void 0),cs([Vo({type:Function})],ds.prototype,"validator",void 0),cs([Vo({type:Object})],ds.prototype,"problems",void 0),cs([Vo({type:String})],ds.prototype,"text",null),cs([Vo({type:String})],ds.prototype,"draft",void 0),ds=cs([Ko,Xo(as)],ds),function(e){var t;(t=e.Type||(e.Type={}))[t.Open=0]="Open",t[t.Close=1]="Close",t[t.RuleName=2]="RuleName",t[t.RuleValue=3]="RuleValue",t[t.SlashSlashComment=4]="SlashSlashComment"}(hs||(hs={}));class ms extends Error{constructor(){super(...arguments),this.name=this.constructor.name}}class fs extends ms{constructor(e){super(e>1?`missing ${e} closing braces "}"`:`missing ${e} closing brace "}"`)}}class bs extends ms{constructor(e,t){super(`(${e.cursor.line}:${e.cursor.column}) ${t}`),this.trace=e}}class gs extends bs{constructor(e){super(e,"expression is missing selector")}}class vs extends bs{constructor(e){super(e,'unwanted closing brace "}"')}}class ws extends bs{constructor(e,t){super(e,`invalid place for rule name "${t}"`)}}class ys extends bs{constructor(e,t){super(e,`invalid place for rule value "${t}"`)}}const xs=e=>({error:t=>new bs(e,t),missingSelector:()=>new gs(e),excessClosingBrace:()=>new vs(e),ruleNamePlacement:t=>new ws(e,t),ruleValuePlacement:t=>new ys(e,t)});const Is=/(\s*)/my;function ks(e,t,i){const n=(/\n/g.exec(e)??[]).length,a=t.line+n;let o=0;if(n>0){const[,t]=/\n(.*)$/.exec(e)??[];o=1+t.length}else o=t.column+(i-t.index);return{line:a,column:o,index:i}}function $s({index:e,cursor:t,leadingWhitespace:i}){return n=>{const a=ks(i,t,t.index+i.length);return{cursor:a,length:n??e-a.index}}}function Ss(e,t){return(i,n)=>{let a=n.index;const o=e=>a=e,r=function({source:e,index:t,setIndex:i}){Is.lastIndex=t;const n=Is.exec(e.code);n&&i(Is.lastIndex);const[,a=""]=n??[];return a}({source:i,index:a,setIndex:o}),s=function({source:e,regex:t,index:i,setIndex:n}){t.lastIndex=i;const a=t.exec(e.code);return a&&n(t.lastIndex),a}({source:i,regex:e,index:a,setIndex:o});return s?{newIndex:a,token:t(s,$s({index:a,cursor:n,leadingWhitespace:r}))}:void 0}}const Ps={slashSlashComment:Ss(/(\/\/.*)$/my,((e,t)=>{const[,i]=e,n=i.trim();return{type:hs.Type.SlashSlashComment,trace:t(n.length),value:n}})),open:Ss(/([^{};]*){/my,((e,t)=>{const[,i]=e,n=i.trim();return{type:hs.Type.Open,trace:t(n.length),selector:i.trim()}})),close:Ss(/}/my,((e,t)=>({type:hs.Type.Close,trace:t(1)}))),ruleName:Ss(/([\S]+):/my,((e,t)=>{const[,i]=e,n=i.trim();return{type:hs.Type.RuleName,trace:t(n.length),name:n}})),ruleValue:Ss(/([^;}]+)(;|(?=}))/my,((e,t)=>{const[,i]=e,n=i.trim();return{type:hs.Type.RuleValue,trace:t(n.length),value:n}}))};function As(e){const t=function*(e){let t;const i=[];for(const n of e){const a=xs(n.trace);switch(n.type){case hs.Type.Open:t={selector:n.selector.replaceAll(/\s+/gm," "),ruleName:void 0,rules:{},childFrames:[]},i.push(t);break;case hs.Type.RuleName:if(!t)throw a.ruleNamePlacement(n.name);t.ruleName=n.name;break;case hs.Type.RuleValue:if(!t||!t.ruleName)throw a.ruleValuePlacement(n.value);t.rules[t.ruleName]=n.value,t.ruleName=void 0;break;case hs.Type.Close:{const o=i.pop(),r=i.length>0?i[i.length-1]:void 0;if(t=r,!o)throw a.excessClosingBrace();if(!o.selector)throw a.missingSelector();if(r)r.childFrames.push(o);else{function s(e){return[e.selector,e.rules,e.childFrames.map(s)]}yield s(o)}}}}if(i.length>0)throw new fs(i.length)}(function*(e){const t={code:e};let i=!1,n={index:0,line:1,column:1};for(;!i;){let e;for(const i of Object.values(Ps)){let a=i(t,n);if(a){e=a.token,n=ks(t.code.slice(n.index,a.newIndex),n,a.newIndex);break}}e?yield e:i=!0}}(e));return[...us(t)].join("")}function Os(e,...t){const i=As(Array.from(e).reduce(((e,i,n)=>e+i+(t[n]??"")),""));return za(i)}var Ms,Cs,Es,_s,Rs,Ts,Ds,qs,Ls=Os`

:host {
	display: block;
	width: 100%;
	max-width: 48rem;
	--pad: var(--xio-price-input-pad, 0.2em);
	--font: var(--xio-price-input-font, inherit);
	--color: var(--xio-price-input-color, inherit);
	--font-size: var(--xio-price-input-button-font-size, 1.5rem);
	--svg-height: var(--xio-price-input-height, 1.2em);
	--label-font: var(--xio-price-input-label-font, inherit);
	--label-color: var(--xio-price-input-label-color, inherit);
	--pad-problems: var(--xio-price-input-problems-padding, 1.7em);
	--problems-font: var(--xio-price-input-problems-font, inherit);
	--problems-color: var(--xio-price-input-problems-color);
	--background: var(--xio-price-input-background, transparent);
	--valid-color: var(--xio-price-input-valid-color, #00ff8c);
	--invalid-color: var(--xio-price-input-invalid-color, #ff6100);
	--border: var(--xio-price-input-border, 1px solid);
	--border-radius: var(--xio-price-input-border-radius, 0.3em);
}

.container {
	display: flex;
	flex-direction: column;

	label {
		font: var(--label-font);
		color: var(--label-color);
		slot {
			display: block;
			padding: 0 var(--pad);
		}
	}

	svg {
		width: var(--svg-height);
		height: var(--svg-height);
		pointer-events: none;
	}

	ul {
		font: var(--problems-font);
		list-style-type: none;
		padding-left: var(--pad-problems);
		color: var(--problems-color, var(--invalid-color));
	}
}

.inner__container{
	display: flex;
	align-items: center;
	gap: 0.5rem;

	button {
		display: flex;
		font-size: var(--font-size);
		color: var(--color);
		opacity: 0.4;
		background: var(--background);
		cursor: pointer;
		border: none;
		user-select: none;
		transition: all 0.2s ease-in 0s;
	
		^:is(:hover, :focus) {
			opacity: 1;
			outline: none;
		}
	}

	.decrement:active {
		opacity: 0.6;
		transform: translateY(2px);
	}

	.increment:active {
		opacity: 0.6;
		transform: translateY(-2px);
	}
}

.price__input__parent {
	display: flex;
	align-items: center;
	gap: 0.2rem;
	padding: var(--pad) calc(2 * var(--pad));
	border-radius: var(--border-radius);
	border: var(--border);

	input {
		font: var(--font);
		font-size: 1.5rem;
		text-align: right;
		border: none;
		padding: 0;
		background: var(--background);
		color: var(--color);

		^:is(:focus, :active) {
			outline: 0;
		}
	}

	.symbol, .currency {
		font-size: 1rem;
		opacity: 0.4;
		user-select: none;
		text-transform: uppercase;
	}

	.currency {
		margin-left: 0.5em;
	}

	^[data-valid] svg {
		color: var(--valid-color);
	}

	^:not([data-valid]) svg {
		color: var(--invalid-color);
	}
}

.focussed {
	outline: 2px solid cyan;
}

input::-webkit-inner-spin-button {
	-webkit-appearance: none;
}
`,js=yo`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-up"><polyline points="18 15 12 9 6 15"></polyline></svg>`,Us=yo`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>`,Ns=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},zs=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};!function(e){e[e.INCREMENT=0]="INCREMENT",e[e.DECREMENT=1]="DECREMENT"}(qs||(qs={}));let Bs=class extends sr{constructor(){super(...arguments),Ms.add(this),this.min=1,this.max=10,this.step="0.5",this["initial-value"]="",this.currency="USD",this.symbol="$",this.problems=[],this.valid=!0,this.showValidation=!1,Cs.set(this,(()=>{this.inputParent.classList.add("focussed")})),Es.set(this,(()=>{this.inputParent.classList.remove("focussed")})),_s.set(this,(()=>{const{input:e}=this,t=e.value.length>1?e.value.length:3;e.style.width=`${t+.4}ch`})),Rs.set(this,(e=>{this.showValidation=!0,this.problems=this.validator?this.validator(Number(e)):[],this.valid=this.problems.length<1})),Ds.set(this,(e=>{const t=e.target;this.inputValue=t.value,zs(this,Rs,"f").call(this,this.inputValue),zs(this,_s,"f").call(this),this.dispatchEvent(new ls(this.inputValue))}))}get input(){return this.shadowRoot?this.shadowRoot.querySelector("#price"):void 0}get inputParent(){return this.shadowRoot?this.shadowRoot.querySelector(".price__input__parent"):void 0}get value(){return this.valid?this.inputValue:void 0}init(){this.inputValue=this["initial-value"]}render(){const{symbol:e,currency:t,inputValue:i,readonly:n,valid:a,showValidation:o,problems:r}=this,s=this["initial-value"]?this["initial-value"].length:4,l=o?a?os:mr:null;return wo`
			<div class="container">
				<label for="price" part="label"><slot></slot></label>
				<div class="inner__container">
					<button
						?disabled=${n}
						@click=${()=>zs(this,Ms,"m",Ts).call(this,qs.DECREMENT)}
						class="decrement">
						${Us}
					</button>
					<div class="price__input__parent" tabindex="-1" ?data-valid=${a}>
						<span class="symbol">${e}</span>
						<input
							?readonly=${n}
							@focus=${zs(this,Cs,"f")}
							@blur=${zs(this,Es,"f")}
							@input=${zs(this,Ds,"f")}
							.value=${i}
							type="number"
							id="price"
							style="width: ${s}ch"
							placeholder="0.00"
						/>
						${l}
						<span class="currency">${t}</span>
					</div>
					<button
						?disabled=${n}
						@click=${()=>zs(this,Ms,"m",Ts).call(this,qs.INCREMENT)}
						class="increment">
						${js}
					</button>
				</div>
				<ul part=problems>
					${a?null:r.map((e=>wo`
							<li>${e}</li>
						`))}
				</ul>
			</div>
		`}};Cs=new WeakMap,Es=new WeakMap,_s=new WeakMap,Rs=new WeakMap,Ds=new WeakMap,Ms=new WeakSet,Ts=function(e){const{step:t,inputValue:i}=this;e===qs.INCREMENT?this.inputValue=(Number(i)+Number(t)).toFixed(2):e===qs.DECREMENT&&(this.inputValue=(Number(i)-Number(t)).toFixed(2)),zs(this,Rs,"f").call(this,this.inputValue),zs(this,_s,"f").call(this),this.dispatchEvent(new ls(this.inputValue))},Ns([Vo({type:Number,reflect:!0})],Bs.prototype,"min",void 0),Ns([Vo({type:Number,reflect:!0})],Bs.prototype,"max",void 0),Ns([Vo({type:String,reflect:!0})],Bs.prototype,"step",void 0),Ns([Vo({type:Boolean,reflect:!0})],Bs.prototype,"readonly",void 0),Ns([Vo({type:String})],Bs.prototype,"initial-value",void 0),Ns([Vo({type:String})],Bs.prototype,"currency",void 0),Ns([Vo({type:String})],Bs.prototype,"symbol",void 0),Ns([Vo({type:String})],Bs.prototype,"inputValue",void 0),Ns([Vo({type:Object})],Bs.prototype,"problems",void 0),Ns([Vo({type:Boolean})],Bs.prototype,"valid",void 0),Ns([Vo({type:Boolean})],Bs.prototype,"showValidation",void 0),Ns([Vo({type:Function})],Bs.prototype,"validator",void 0),Bs=Ns([Xo(Ls)],Bs);class Vs extends CustomEvent{constructor(e){super("nightlightChange",{detail:e,bubbles:!0})}}const Ws="nightlightSettings";var Hs,Fs,Qs,Xs,Ks=Ba`

:host {
	display: inline-block;
	width: 2em;
	height: 2em;
}

button {
	display: block;
	font-size: inherit;
	color: inherit;
	background: transparent;
	border: none;
	width: 100%;
	height: 100%;

	Xtransform: scale(1);
	Xtransition: transform 200ms ease;
}

Xbutton:active {
	transform: scale(0.8);
}

slot {
	display: block;
	width: 100%;
	height: 100%;
}

slot svg, slot::slotted(svg) {
	display: block;
	width: 100%;
	height: 100%;
}

`,Ys=yo`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`,Gs=yo`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`,Js=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},Zs=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};const el="data-nightlight";let tl=class extends sr{constructor(){super(...arguments),Hs.add(this),this["show-destination-state"]=!1,this["title-to-night"]="turn down the lights",this["title-to-day"]="turn up the lights",this.sourceElement=document.documentElement,Fs.set(this,{save(e){e?window.localStorage.setItem(Ws,JSON.stringify(e)):window.localStorage.removeItem(Ws)},load(){const e=window.localStorage.getItem(Ws);return e?JSON.parse(e):void 0}})}firstUpdated(){const e=Zs(this,Fs,"f").load();e&&(this.night=e.night),window.addEventListener("nightlightChange",(e=>{e.target!==this&&this.requestUpdate()}))}get night(){return null!==this.sourceElement.getAttribute(el)}set night(e){Zs(this,Fs,"f").save({night:e});e!==this.night&&(Zs(this,Hs,"m",Qs).call(this,e),this.requestUpdate(),Zs(this,Hs,"m",Xs).call(this))}toggle(e=!this.night){this.night=e}render(){const{night:e}=this,t=this["show-destination-state"]?!e:e;return wo`
			<button
				part=button
				title="${e?this["title-to-day"]:this["title-to-night"]}"
				?data-nightlight=${e}
				@click=${()=>this.toggle()}>
					${t?wo`
							<slot name=night>
								${Gs}
							</slot>
						`:wo`
							<slot name=day>
								${Ys}
							</slot>
						`}
			</button>
		`}};Fs=new WeakMap,Hs=new WeakSet,Qs=function(e){e?this.sourceElement.setAttribute(el,""):this.sourceElement.removeAttribute(el)},Xs=function(){const e=new Vs({night:this.night});this.dispatchEvent(e),this.onNightlightChange&&this.onNightlightChange(e)},tl.NightlightChangeEvent=Vs,Js([Vo({type:Boolean,reflect:!0})],tl.prototype,"show-destination-state",void 0),Js([Vo({type:String,reflect:!0})],tl.prototype,"title-to-night",void 0),Js([Vo({type:String,reflect:!0})],tl.prototype,"title-to-day",void 0),tl=Js([Xo(Ks)],tl);var il=Ba`

:host {
	display: inline-block;
	--local-avatar-size: var(--avatar-size, 3em);
}

.container {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
}

xio-avatar {
	flex: 0 0 auto;
	margin-right: 0.4em;
	--avatar-size: var(--local-avatar-size);
}

.box {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	flex: 1;
	flex-basis: 8em;
}

[part="nameplate"] {
	flex: 1 1 auto;
	margin-right: 1em;
	margin-bottom: 0.5em;
}

[part="details"] {
	margin-bottom: 0.5em;
}

.buttonbar {
	margin-top: 0.5em;
}

.cardplate > * {
	display: block;
}

.tags {
	list-style: none;
	font-size: 0.6em;
	cursor: default;
}

.tags > li {
	display: inline-block;
	margin: 0 0.1em;
	padding: 0 0.25em;
	border: 1px solid;
	border-radius: 1em;
}

[data-tag=staff] {
	color: var(--cobalt-tagcolor-staff, lime);
}

[data-tag=banned] {
	color: var(--cobalt-tagcolor-banned, red);
}

p[data-field=tagline] {
	opacity: 0.7;
	font-size: 0.7em;
	font-style: italic;
}

xio-text-input > span {
	opacity: 0.4;
	font-size: 0.7rem;
}

xio-text-input + xio-text-input {
	margin-top: 0.1em;
}

[part="details"] {
	font-size: 0.7em;
	list-style: none;
}

[part="details"] > li {
	margin-top: 0.2em;
}

[part="details"] > li > :first-child {
	font-weight: bold;
}

[part="details"] code {
	font-size: 0.6em;
	padding: 0.2em;
	border-radius: 0.3em;
	word-break: break-all;
	background: #0002;
}

.roles {
	font-size: 0.6em;
	list-style: none;
	padding: 0;
	margin-top: 0.3rem;
}

.roles li {
	display: inline-block;
	border: 1px solid;
	border-radius: 1em;
	padding: 0.1em 0.3em;
	line-height: 0.8em;
}

`;const nl=e=>null!=e;function al(e,t){if(!nl(e)||!nl(t))return e===t;for(const[i,n]of Object.entries(e)){if(!t.hasOwnProperty(i))return!1;const e=t[i];switch(typeof n){case"object":if(!al(n,e))return!1;break;case"function":if(!nl(e)||n.toString()!==e.toString())return!1;break;default:if(n!==e)return!1}}for(const[i]of Object.entries(e))if(!t.hasOwnProperty(i))return!1;for(const[i]of Object.entries(t))if(!e.hasOwnProperty(i))return!1;return!0}function ol({field:e,initial:t,text:i,input:n}){return n?wo`
			<xio-text-input
				data-field="${e}"
				initial="${t}"
				text="${i}"
				part="xiotextinput"
				exportparts="${"\n\t\t\t\t\tlabel: xiotextinput-label,\n\t\t\t\t\ttextinput: xiotextinput-textinput,\n\t\t\t\t\tproblems: xiotextinput-problems,\n\t\t\t\t"}"
				show-validation-when-empty
				?readonly=${n.readonly}
				?hide-validation=${!n.draftIsChanged}
				.validator=${n.validator}
				@valuechange=${n.onvaluechange}>
					<span>${n.label}</span>
			</xio-text-input>
		`:wo`
			<p part="textfield" data-field="${e}">${t}</p>
		`}function rl(e){const t=new Date(e),i=e=>e.toString().padStart(2,"0"),n=i(t.getFullYear()),a=i(t.getMonth()+1),o=i(t.getDate()),r=t.getHours();let s=t.getHours();s%=12,s=s||12;const l=i(t.getMinutes()),c=r>=12?"pm":"am",d=-t.getTimezoneOffset(),u=(d/60).toFixed(d%60==0?0:1),p=0===d?"UTC":`UTC${d<0?"":"+"}${u}`,h=`${n}-${a}-${o}`,m=`${s}:${l} ${c}`,f=`${`${Intl.DateTimeFormat().resolvedOptions().timeZone} ${p}`}`;return{date:h,time:m,zone:f,full:`${h} ${m} (${f})`}}function sl(e){return{tagline:e.tagline,nickname:e.nickname}}function ll(e,t){return re.isReady(e)?t(re.value(e)):null}function cl(e,t,i=null,{loadingMessage:n="",errorMessage:a="",hideErrorText:o=!1}={}){return wo`
		<xio-op
			.op=${e}
			loading-message="${n}"
			error-message="${a}"
			?hide-error-text=${o}>
				${ll(e,t)}
				${i}
		</xio-op>
	`}var dl,ul=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},pl=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};let hl=class extends sr{constructor(){super(...arguments),dl.set(this,ye({busy:re.ready(void 0)})),this.profileDraft=void 0,this.problems=[],this.handleChange=he(200,(()=>{if(!this.user)return;const{profileDraft:e,isChanged:t}=this.generateNewProfileDraftFromInputs();this.profileDraft=t?e:void 0})),this.handleSave=async()=>{const{profileDraft:e}=this;await re.operation({promise:this.saveProfile(e).finally((()=>{this.profileDraft=null})),setOp:e=>pl(this,dl,"f").writable.busy=e}),this.requestUpdate(),await this.updateComplete;const t=(e,t)=>{this.shadowRoot.querySelector(`xio-text-input[data-field="${e}"]`).text=t};t("nickname",e.nickname),t("tagline",e.tagline)}}init(){this.addSubscription((()=>pl(this,dl,"f").subscribe((()=>this.requestUpdate()))))}get draftIsChanged(){return!!this.profileDraft}get readonly(){return!this.saveProfile}getTextInputField(e){return function(e,t=document){return t.querySelector(e)}(`xio-text-input[data-field="${e}"]`,this.shadowRoot)}generateNewProfileDraftFromInputs(){const{profile:e}=this.user,t=sl(e),i=this.getTextInputField("nickname");if(!i)return{profileDraft:t,isChanged:!1};const n=this.getTextInputField("tagline");t.nickname=i.value,t.tagline=n.value,this.problems=[...i.problems,...n.problems];return{profileDraft:t,isChanged:!al(sl(e),t)}}render(){const{user:e,draftIsChanged:t}=this;if(!e)return null;const i=e.profile.avatar;return cl(pl(this,dl,"f").readable.busy,(()=>wo`
			<div class=container ?data-readonly=${this.readonly}>
				<xio-avatar part=avatar .spec=${i}></xio-avatar>
				<div class=box>
					<div part=nameplate>
						${ol({field:"nickname",initial:this.profileDraft?this.profileDraft.nickname:e.profile.nickname,text:e.profile.nickname,input:this.readonly?void 0:{label:"nickname",readonly:!1,draftIsChanged:t,validator:Oi.nickname,onvaluechange:this.handleChange}})}
						${ol({field:"tagline",initial:this.profileDraft?this.profileDraft.tagline:e.profile.tagline,text:e.profile.tagline,input:this.readonly?void 0:{label:"tagline",readonly:!1,draftIsChanged:t,validator:Oi.tagline,onvaluechange:this.handleChange}})}
						${function(e){return wo`
		<ul class=roles>
			${e.roles.map((e=>wo`
				<li
					data-role-label="${e.label}"
					data-role-id="${e.roleId}">
						${e.label}
				</li>
			`))}
		</ul>
	`}(e)}
						${this.readonly?null:wo`
							<div class=buttonbar>
								<xio-button
									?disabled=${!this.profileDraft||this.problems.length>0}
									@press=${this.handleSave}>
										<slot name=save-button>save profile</slot>
								</xio-button>
							</div>
						`}
					</div>
					${this["show-details"]?function(e){return wo`
		<ul part=details>
			<li>
				<span>joined:</span>
				<span>${rl(e.stats.joined).date}</span>
			</li>
			<li>
				<span>user id:</span>
				<span><xio-id id="${e.userId}"></xio-id></span>
			</li>
		</ul>
	`}(e):null}
				</div>
			</div>
		`))}};dl=new WeakMap,ul([Vo({type:Boolean})],hl.prototype,"show-details",void 0),ul([Vo({type:Object})],hl.prototype,"user",void 0),ul([Vo({type:Object})],hl.prototype,"saveProfile",void 0),ul([Vo({type:Object})],hl.prototype,"profileDraft",void 0),hl=ul([Xo(il)],hl);var ml,fl,bl,gl,vl,wl=Os`

:host {
	display: block;
	width: 100%;
	max-width: 48rem;
}

.card {
	display: flex;
	width: fit-content;
	margin: 0 auto;
}

.display {
	font-size: 1.2rem;
	display: flex;

	strong {
		font-size: 2em;
		line-height: 1;
	}

	.superscript {
		font-size: 1em;
		margin-top: 0.1em;
	}

	.symbol {
		opacity: 0.4;
		font-size: 1em;
		align-self: center;
		margin-right: 0.2em;
		user-select: none;
	}

	.currency {
		opacity: 0.4;
		font-size: 1em;
		margin-top: 0.1em;
		margin-left: 0.3em;
		user-select: none;
		text-transform: uppercase;
	}

	.vertical {
		font-size: 0.7em;
		text-orientation: upright;
		writing-mode: vertical-rl;
		text-align: center;
		letter-spacing: -0.2em;
	}
}
`,yl=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},xl=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};let Il=class extends sr{constructor(){super(...arguments),ml.add(this),this.symbol="$",this.currency="USD",this.value="9.50",gl.set(this,(()=>{const{cents:e,dollars:t}=xl(this,ml,"m",bl).call(this);return wo`
			<strong>
				${`${t}.${e}`}
			</strong>
		`})),vl.set(this,(()=>{const{cents:e,dollars:t}=xl(this,ml,"m",bl).call(this);return wo`
			<strong>${t}</strong>
			<span class="superscript">${e}</span>
		`}))}render(){const e=this["unit-superscript"],t=this["vertical-currency"],{symbol:i,currency:n}=this;return wo`
			<div class="card">
				<div class="display">
					<span class="symbol">${i}</span>
					${e?xl(this,vl,"f").call(this):xl(this,gl,"f").call(this)}
					<span class=${"currency "+(t?"vertical":"")}>
						${n}
					</span>
				</div>
			</div>
		`}};gl=new WeakMap,vl=new WeakMap,ml=new WeakSet,fl=function(e){return e.length>1?e:`0${e}`},bl=function(){const{value:e}=this,t=parseFloat(e),i=Math.floor(t),n=Math.round(t%1*100);return{dollars:i.toString(),cents:xl(this,ml,"m",fl).call(this,n.toString())}},yl([Vo({type:String,reflect:!0})],Il.prototype,"symbol",void 0),yl([Vo({type:String,reflect:!0})],Il.prototype,"currency",void 0),yl([Vo({type:Boolean,reflect:!0})],Il.prototype,"unit-superscript",void 0),yl([Vo({type:Boolean,reflect:!0})],Il.prototype,"vertical-currency",void 0),yl([Vo({type:String})],Il.prototype,"value",void 0),Il=yl([Xo(wl)],Il);var kl=Ba`

:host {
	display: block;
}

.app-list {
	margin-top: 2em;
	margin-bottom: 2em;
}

.app-list > xio-op {
	display: block;
	border: 1px solid #f00;
	margin-top: 0.5em;
	border: 1px solid #fff1;
	border-radius: 0.2em;
}

.app-list > xio-op[mode="loading"] {
	padding: 4em 2em;
}

.app > * + * {
	margin-top: 0.3em;
}

.app + .app {
	margin-top: 1.5em;
}

.app > * {
	padding: 0.4em 1rem;
}

.app-header {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	justify-content: flex-end;
	padding: 0;
	background: #0001;
}

.app-header .title {
	max-width: 100%;
	flex: 1 0 auto;
	padding: 0.3em 1em;
}

.app-header .title h3 {
	font-size: 1.5em;
	font-weight: bold;
}

.app-header .title h3::before {
	content: "ðŸŒ";
	color: white;
}

.app-header .stats {
	display: flex;
	flex-direction: row;
	justify-content: center;
	flex-wrap: wrap;
	padding: 0.2em;
}

.app-header .stats [data-stat] {
	display: flex;
	flex-direction: column;
	justify-content: flex-end;
	max-width: 6em;
	text-align: center;
}

.app-header .stats [data-stat] > span {
	padding: 0.1em 0.6em;
}

.app-header .stats [data-stat] > span:nth-child(1) {
	justify-self: flex-start;
}

.app-header .stats [data-stat] > span:nth-child(2) {
	opacity: 0.3;
	font-size: 0.6em;
}

.twoside {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
}

.twoside > div {
	max-width: 100%;
	flex: 1 0 16em;
	padding-bottom: 1em;
}

.twoside > div:nth-child(1) {
	padding-right: 1rem;
}

.editside > .buttons {
	display: flex;
	justify-content: center;
	align-items: center;
}

.app-form > * + * {
	margin-top: 0.3em;
}

.app-form xio-button {
	margin-top: 0.6em;
}

.app-options {
	border: 1px solid #fff1;
	padding: 1em;
}

.app-options > * + * {
	margin-top: 3em;
}

code {
	display: inline-block;
	font-size: 0.8em;
	padding: 0.2em;
	border-radius: 0.3em;
	background: #0002;
	overflow-wrap: anywhere;
	word-break: break-all;
}

code.id {
	opacity: 0.7;
	font-size: 0.5em;
}

.codeblock {
	display: block;
}

.htmlcode { color: #fff6; }
.htmlcode [data-syntax=tag] { color: deepskyblue; }
.htmlcode [data-syntax=attr] { color: skyblue; }
.htmlcode [data-syntax=data] { color: #aaffa0; }
.htmlcode [data-syntax=indent] {
	display: block;
	margin-left: 1em;
}

.app-code > * {
	margin-top: 1em;
}

.app-code code {
	display: block;
	font-size: 0.6em;
	padding: 1em;
	margin: 0.5em 0;
}

.delete-app-button {
	display: block;
	text-align: right;
	--xio-button-hover-color: red;
}

${Ba`

.adminmanager .adminassigner {
	display: flex;
	flex-direction: row;
	margin: 0.5em 0;
}

.adminmanager .adminassigner > * {
	display: block;
}

.adminmanager .adminassigner > xio-text-input {
	flex: 1 1 auto;
}

.adminmanager .adminassigner > xio-text-input {
	width: 100%;
	max-width: 100%;
}

.adminmanager .adminassigner > xio-text-input::part(problems) {
	min-width: unset;
}

.adminmanager .adminassigner > xio-button {
	margin-top: 1.1em;
	margin-left: 0.3em;
}

.adminmanager .adminlist ul {
	list-style: none;
	padding: 0 1em;
	border: 1px solid #fff1;
}

.adminmanager .adminlist li {
	display: flex;
	flex-direction: row;
	align-content: center;
	padding: 0.3em 0;
	font-size: 0.8em;
}

.adminmanager .adminlist li + li {
	border-top: 1px solid #fff1;
}

.adminmanager .adminlist li > * {
	display: block;
}

.adminmanager .adminlist li > span {
	flex: 1 1 auto;
	display: flex;
	align-items: center;
	word-break: break-all;
}

.adminmanager .adminlist li > xio-button {
	color: #fff3;
}

`}

.app-list {
	margin-bottom: 5rem;
}

.app-registration {
	max-width: 40em;
	margin-bottom: 5em;
}

`;const $l=e=>e.split("\n").map((e=>e.trim().toLowerCase())).filter((e=>e.length>0));function Sl({clearOnSubmit:e,submitButtonText:t,showAdditionalOrigins:i,initialValues:n={home:"",label:"",additionalOrigins:[]},query:a,submit:o,requestUpdate:r}){const s={problems:[],formDisabled:!1,draft:n,get valid(){return!this.formDisabled&&this.draft&&0===this.problems.length}};function l(){return{home:a('.app-form [data-form="home"]'),label:a('.app-form [data-form="label"]'),additionalOrigins:a('.app-form [data-form="additional-origins"]')}}const c=()=>{const{home:e,label:t,additionalOrigins:i}=l();var n;s.draft={home:e.value,label:t.value,additionalOrigins:i.value},s.problems=(n=s.draft,[...ni.label(n.label),...ni.home(n.home),...ni.additionalOrigins(n.additionalOrigins)]),r()};function d(){s.problems=[],s.formDisabled||c()}async function u(){c(),s.formDisabled=!0,r();try{await o(s.draft),e?function(e){const t=l();t.home.text=e.home,t.label.text=e.label,t.additionalOrigins.text=e.additionalOrigins.join("\n")}(n={home:"",label:"",additionalOrigins:[]}):n=s.draft}finally{s.formDisabled=!1,r()}}return{render:function({partNamespace:e}){const{formDisabled:a,draft:o,problems:r}=s,l=!al(n,o),c=!l||a||r.length>0,p=`\n\t\t\tlabel: xiotextinput-label,\n\t\t\ttextinput: xiotextinput-textinput,\n\t\t\tproblems: xiotextinput-problems,\n\n\t\t\tlabel: ${e}-appform-xiotextinput-label,\n\t\t\ttextinput: ${e}-appform-xiotextinput-textinput,\n\t\t\tproblems: ${e}-appform-xiotextinput-problems,\n\t\t`,h=({hide:t,textarea:i,label:n,dataForm:o,initialText:r,showValidationWhenEmpty:s,parser:c,validator:u})=>wo`
			<xio-text-input
				?textarea=${i}
				part="${e}-appform-xiotextinput"
				exportparts="${p}"
				data-form="${o}"
				initial="${r}"
				?hidden=${t}
				?disabled=${a}
				?hide-validation=${!l}
				?show-validation-when-empty=${s}
				.parser=${c}
				.validator=${u}
				@valuechange=${d}>
					<span part=xio-text-input-label>
						${n}
					</span>
			</xio-text-input>
		`;return wo`
			<div class=app-form>
				<slot name=create-app-heading></slot>

				${h({hide:!1,textarea:!1,dataForm:"label",label:"community name",initialText:n.label,showValidationWhenEmpty:!1,parser:void 0,validator:ni.label})}

				${h({hide:!1,textarea:!1,dataForm:"home",label:'website homepage, like "https://chasemoskal.com/"',initialText:n.home,showValidationWhenEmpty:!1,parser:void 0,validator:ni.home})}

				${h({hide:!i,textarea:!0,dataForm:"additional-origins",label:"(optional) additional domain names",initialText:n.additionalOrigins.join("\n"),showValidationWhenEmpty:!0,parser:$l,validator:ni.additionalOrigins})}

				<xio-button
					class="create-app-button"
					?disabled=${c}
					@press=${u}>
						${t}
				</xio-button>
			</div>
		`}}}function Pl({app:e,appEditService:t,query:i}){const{state:n,actions:a,subscribe:o}=function(){const e=ye({admins:re.none(),assignerDraft:{email:void 0}}),t={setAdmins(t){e.writable.admins=t},setAssignerDraft(t){e.writable.assignerDraft=t}};return{subscribe:e.subscribe,state:e.readable,actions:t}}(),r=function({app:e,state:t,actions:i,appEditService:n}){const{appId:a}=e,o=(e=Promise.resolve(void 0))=>re.operation({promise:e.then((()=>n.listAdmins({appId:a}))),setOp:e=>i.setAdmins(e)});return{listAdmins:async function(){await o()},assignAdmin:async function(){const{email:e}=t.assignerDraft;i.setAssignerDraft({email:void 0}),await o(n.assignAdmin({appId:a,email:e}))},revokeAdmin:async function(e){await o(n.revokeAdmin({appId:a,userId:e}))}}}({app:e,state:n,actions:a,appEditService:t});function s(e){var t;const i=null!==(t=e.detail.value)&&void 0!==t?t:void 0;a.setAssignerDraft({email:i})}function l(){const e=i(".adminassigner xio-text-input");r.assignAdmin(),e.text=""}function c(){return wo`
			<div class=adminassigner>
				<xio-text-input
					part=adminmanager-xiotextinput
					exportparts="${"\n\t\t\tlabel: xiotextinput-label,\n\t\t\ttextinput: xiotextinput-textinput,\n\t\t\tproblems: xiotextinput-problems,\n\n\t\t\tlabel: adminmanager-xiotextinput-label,\n\t\t\ttextinput: adminmanager-xiotextinput-textinput,\n\t\t\tproblems: adminmanager-xiotextinput-problems,\n\t\t"}"
					.validator=${Si}
					@valuechange=${s}>
						email
				</xio-text-input>
				<xio-button
					?disabled=${!n.assignerDraft.email}
					@press=${l}>
						grant
				</xio-button>
			</div>
		`}return{render:function(){return wo`
			${c()}
			${wo`
			<div class=adminlist>
				${cl(n.admins,(e=>wo`
					<ul>
						${e.map((({email:e,userId:t})=>wo`
							<li>
								<span>${e}</span>
								<xio-button @press=${()=>r.revokeAdmin(t)}>
									revoke
								</xio-button>
							</li>
						`))}
					</ul>
				`))}
			</div>
		`}
		`},controls:r,subscribe:o}}function Al(e){return{home:e.home,label:e.label,origins:(t=[new URL(e.home).origin,...e.additionalOrigins],[...new Set(t)])};var t}function Ol(){return function(e){const t=new Map;return function(i){let n;return t.has(i)?n=t.get(i):(n=e(i),t.set(i,n)),n}}}var Ml=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let Cl=class extends(er()(sr)){constructor(){super(...arguments),this.appRegistrationForm=Sl({clearOnSubmit:!0,showAdditionalOrigins:!1,submitButtonText:"create community",requestUpdate:()=>this.requestUpdate(),query:e=>this.shadowRoot.querySelector(".app-registration").querySelector(e),submit:async e=>{const t=Al(e);await this.share.appsModel.registerApp(t)}}),this.getAppState=Ol()((e=>{const t=this.share.appsModel.getApp(e),i=ye({editMode:!1}),n={toggleEditMode(){i.writable.editMode=!i.writable.editMode}};return i.subscribe((()=>this.requestUpdate())),{toggleEditMode:n.toggleEditMode,get editMode(){return i.readable.editMode},appForm:Sl({clearOnSubmit:!1,showAdditionalOrigins:!0,submitButtonText:"save changes",initialValues:(a=t,{home:a.home,label:a.label,additionalOrigins:(o=a.home,r=a.origins,r.filter((e=>e.toLowerCase()!==new URL(o.toLowerCase()).origin)).map((e=>e.toLowerCase())))}),requestUpdate:()=>{this.requestUpdate()},query:e=>this.shadowRoot.querySelector(`.app[data-app-id="${t.appId}"] .app-options`).querySelector(e),submit:async e=>{const i=Al(e);await this.share.appsModel.updateApp(t.appId,i)}}),adminManager:(()=>{const e=Pl({app:t,appEditService:this.share.appsModel.appEditService,query:e=>this.shadowRoot.querySelector(`.app[data-app-id="${t.appId}"] .adminmanager`).querySelector(e)});return e.subscribe((()=>this.requestUpdate())),e.controls.listAdmins(),e})()};var a,o,r})),this.deleteApp=async e=>{await this.share.modals.confirm({title:"are you certain?",body:`you really want to delete your community "${e.label}"?`,yes:{label:"delete whole community",vibe:"negative"},no:{label:"nevermind",vibe:"neutral"},focusNthElement:2})&&await this.share.appsModel.deleteApp(e.appId)}}init(){this.share.appsModel.loadApps()}renderAppRegistration(){return wo`
			<div class=app-registration>
				<slot name="register-app-heading"></slot>
				${this.appRegistrationForm.render({partNamespace:"appregistration"})}
			</div>
		`}renderNoApps(){return wo`
			<slot name=no-apps></slot>
			${this.renderAppRegistration()}
		`}renderAppList(e){return wo`
			<slot></slot>
			<div class=app-list>
				${Object.entries(e).map((([e,t])=>cl(t,(e=>this.renderApp(e)))))}
			</div>
			${this.renderAppRegistration()}
		`}renderAppBankLinking(e){return null}renderAppCode(e){return wo`
			<div class=app-code>
				<h4>connect your website</h4>
				<p>copy-paste this html into your website's &lt;head&gt; section:</p>
				<code class=htmlcode>
					${function(e){const t=(e,t)=>wo`<span data-syntax=${e}>${t}</span>`,i=e=>t("tag",e),n=e=>t("attr",e),a=e=>t("data",e),o=e=>t("glue",e),r=o('"');return wo`
		${o("<")}${i("script")} ${n("async")} ${n("defer")} ${n("src")}${o("=")}${r}${a("https://xiome.io/xiome.bundle.min.js")}${r}${o(">")}${o("</")}${i("script")}${o(">")}
		<br/>
		${o("<")}${i("xiome-config")} ${n("app")}${o("=")}${r}${a(e)}${r}${o(">")}${o("</")}${i("xiome-config")}${o(">")}
	`}(e)}
				</code>
				<p>then head over to the <a part=link href="./components">components page</a></p>
			</div>
		`}renderApp(e){const t=this.getAppState(e.appId);return wo`
			<div class=app data-app-id=${e.appId}>

				<div class=app-header part=app-header>
					<div class=title>
						<h3>
							<a part=link target=_blank href="${e.home}">
								${e.label}
							</a>
						</h3>
					</div>
					<div class=stats>
						<div data-stat=users>
							<span>${e.stats.users.toLocaleString()}</span>
							<span>users</span>
						</div>
						<div data-stat=monthly-active>
							<span>${e.stats.usersActiveMonthly.toLocaleString()}</span>
							<span>monthly active</span>
						</div>
						<div data-stat=active-last-day>
							<span>${e.stats.usersActiveDaily.toLocaleString()}</span>
							<span>daily active</span>
						</div>
					</div>
				</div>

				<div class=twoside>
					${this.renderAppCode(e.appId)}
					<div class=editside>
						<div class=buttons>
							<xio-button @click=${t.toggleEditMode}>edit community</xio-button>
						</div>
						<div class=app-options ?hidden=${!t.editMode}>
							<div class=app-details>
								${t.appForm.render({partNamespace:"appeditor"})}
							</div>
							<div class=adminmanager>
								<h4>manage admins</h4>
								${t.adminManager.render()}
							</div>
							${this.renderAppBankLinking(e)}
							<div class=finalbox>
								<xio-button
									class=delete-app-button
									@press=${()=>this.deleteApp(e)}>
										delete community
								</xio-button>
							</div>
						</div>
					</div>
				</div>
			</div>
		`}render(){const{appRecords:e}=this.share.appsModel.state;return wo`
			${cl(e,(e=>Object.values(e).length?this.renderAppList(e):this.renderNoApps()))}
		`}};Cl=Ml([Xo(kl)],Cl);var El=Ba`

:host {
	display: block;
	width: var(--avatar-size, 2em);
	height: var(--avatar-size, 2em);
	--op-size: calc(var(--avatar-size, 2em) * 0.5);
}

xio-op {
	display: flex;
	justify-content: center;
	align-items: center;
	width: 100%;
	height: 100%;
}

:host([logged-in]) .avatar {
	color: #fff;
}

`,_l=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let Rl=class extends(er()(sr)){render(){return cl(this.share.accessModel.getAccessOp(),(e=>{var t;return wo`
				<xio-avatar
					part=avatar
					.spec=${null===(t=null==e?void 0:e.user)||void 0===t?void 0:t.profile.avatar}
				></xio-avatar>
			`}),null,{hideErrorText:!0})}};Rl=_l([Xo(El)],Rl);var Tl=Ba`

xio-profile-card {
	--avatar-size: 7em;
}

`,Dl=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let ql=class extends(er()(sr)){constructor(){super(...arguments),this.saveProfile=async e=>{await this.share.personalModel.saveProfile(e)}}render(){const{accessOp:e}=this.share.personalModel.readable;return cl(e,(({user:e})=>wo`
			<xio-profile-card
				show-details
				.user=${e}
				.saveProfile=${this.saveProfile}
			></xio-profile-card>
			<slot></slot>
		`))}};ql=Dl([Xo(Tl)],ql);var Ll=Ba`

:host {
	display: block;
}

slot {
	display: block;
}

xio-text-input,
xio-button {
	margin-top: 0.2em;
}

xio-text-input > span {
	opacity: 0.4;
	font-size: 0.7em;
}

.buttonbar {
	margin-top: 0.5em;
	vertical-align: middle;
}

slot[name="legal"] {
	display: inline-block;
	margin: 0 1em;
}

small {
	display: block;
	opacity: 0.5;
	font-size: 0.7em;
}

`,jl=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let Ul=class extends(er()(sr)){constructor(){super(...arguments),this["show-logout"]=!1,this.status="loading",this.sentLoading=re.none(),this.emailIsValid=!1}async sendEmail(){const e=this.textInput.value;await re.operation({promise:this.share.accessModel.sendLoginLink(e).then((()=>({email:e}))),setOp:e=>this.sentLoading=e,errorReason:`failed sending email to "${e}"`})}resetSentLoading(){this.sentLoading=re.none(),this.textInput&&(this.textInput.text="")}logout(){this.share.accessModel.logout().then((()=>this.sentLoading=re.none()))}subscribe(){return this.share.accessModel.subscribe((()=>{this.resetSentLoading()}))}renderLoggedIn(e){return wo`
			<slot>
				<p>Welcome ${e.user.profile.nickname}!</p>
			</slot>
			${this["show-logout"]?wo`
					<div part=buttonbar>
						<xio-button class=logout-button @press=${this.logout}>
							Logout
						</xio-button>
					</div>
				`:null}
		`}handleEmailChange(){this.emailIsValid=0===this.textInput.problems.length}renderLegalLink(){return wo`
			<small>
				<p>
					<a
						part=link
						target=_blank
						href="https://xiome.io/legal">
							policies and terms
					</a>
				</p>
			</small>
		`}renderLoggedOut(){const{emailIsValid:e}=this;return wo`
			<xio-op .op=${this.sentLoading}>
				<div slot=none>
					<slot name=logged-out>
						<p>login with your email address</p>
					</slot>
					<xio-text-input
						.validator=${wt()}
						@valuechange=${this.handleEmailChange}
						@enterpress=${this.sendEmail}>
							<span>your email</span>
					</xio-text-input>
					<div class=buttonbar>
						<slot name=legal>
							${this.renderLegalLink()}
						</slot>
						<xio-button
							?disabled=${!e}
							@press=${this.sendEmail}>
								send login link
						</xio-button>
					</div>
				</div>
				${re.isReady(this.sentLoading)?wo`
						<p>email sent to ${re.value(this.sentLoading).email}</p>
						<p>please wait a few minutes for it to arrive</p>
						<xio-button @press=${this.resetSentLoading}>
							restart
						</xio-button>
					`:null}
			</xio-op>
		`}render(){var e;const t=this.share.accessModel.getAccessOp();return this.status="loading",re.isReady(t)&&(this.status=(null===(e=re.value(t))||void 0===e?void 0:e.user)?"logged-in":"logged-out"),cl(t,(e=>(null==e?void 0:e.user)?this.renderLoggedIn(e):this.renderLoggedOut()))}};jl([Vo({type:Boolean,reflect:!0})],Ul.prototype,"show-logout",void 0),jl([Vo({type:String,reflect:!0})],Ul.prototype,"status",void 0),jl([Vo()],Ul.prototype,"sentLoading",void 0),jl([Wo("xio-text-input")],Ul.prototype,"textInput",void 0),jl([Vo({type:String})],Ul.prototype,"emailIsValid",void 0),Ul=jl([Xo(Ll)],Ul);var Nl=Ba`

.creator {
	margin: 1em auto;
}

.privilege {
	display: inline-flex;
	flex-direction: row;
	padding: 0.2em 0.5em;
	margin: 0.2em;
	border: 1px solid;
}

.privilege .icon {
	padding-right: 0.5em;
}

.privilege xio-button {
	--xio-button-padding: 0;
	--xio-button-border: none;
}

.privilege[data-hard] {
	opacity: 0.5;
	border: 1px solid dashed;
}

`,zl=yo`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="none"><path d="M7 5a4 4 0 0 1 5.445-3.73a.5.5 0 0 1 .173.819L10.708 4L12 5.293l1.91-1.91a.5.5 0 0 1 .82.172a4 4 0 0 1-4.829 5.292L4.897 13.92a1.986 1.986 0 0 1-2.843-2.774l5.051-5.234A4.01 4.01 0 0 1 7 5zm4-3a3 3 0 0 0-2.862 3.903a.5.5 0 0 1-.117.498L2.773 11.84a.986.986 0 0 0 1.41 1.377l5.225-5.293a.5.5 0 0 1 .532-.116a3 3 0 0 0 4.046-3.088l-1.633 1.634a.5.5 0 0 1-.707 0l-2-2a.5.5 0 0 1 0-.707l1.634-1.634A3.045 3.045 0 0 0 11 2z" fill="currentColor"/></g></svg>`,Bl=yo`<svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill="currentColor" fill-rule="evenodd" d="M7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm0 1.3c1.3 0 2.5.44 3.47 1.17l-8 8A5.755 5.755 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zm0 11.41c-1.3 0-2.5-.44-3.47-1.17l8-8c.73.97 1.17 2.17 1.17 3.47 0 3.14-2.56 5.7-5.7 5.7z"/></svg>`;const Vl=lt((e=>"string"!=typeof e?["must be a string"]:[]),bt(1),gt(32));var Wl,Hl,Fl,Ql,Xl,Kl,Yl,Gl,Jl=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},Zl=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},ec=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i};let tc=class extends(er()(sr)){constructor(){super(...arguments),Wl.add(this),Hl.set(this,!1),Kl.set(this,void 0),Yl.set(this,(e=>{ec(this,Kl,e.detail.value,"f"),this.requestUpdate()}))}get model(){return this.share.permissionsModel}init(){this.model.initialize()}render(){const{readable:{permissionsDisplay:e}}=this.model,t=this.model.getUserCanCustomizePermissions();return cl(e,(e=>t?wo`
			<div class=privileges>
				${Zl(this,Wl,"m",Gl).call(this)}
				${e.privileges.map((e=>function({privilege:{hard:e,label:t,privilegeId:i},onDeleteClick:n}){return wo`
		<div
			class=privilege
			?data-hard=${e}>
				${e?wo`
			<div class="icon system">
				${zl}
			</div>
		`:wo`
			<xio-button
				title="delete privilege"
				class="icon delete"
				@press=${n}>
					${Bl}
			</xio-button>
		`}
				<span class=text>${t}</span>
		</div>
	`}({privilege:e,onDeleteClick:()=>Zl(this,Wl,"m",Xl).call(this,e)})))}
			</div>
		`:wo`
			<p>you are not permitted to customize privileges</p>
		`))}};Hl=new WeakMap,Kl=new WeakMap,Yl=new WeakMap,Wl=new WeakSet,Fl=function(){this.shadowRoot.querySelector(".creator xio-text-input").text=""},Ql=async function(){if(Zl(this,Hl,"f"))throw new Error("privilege creator is busy");const e=Zl(this,Kl,"f");Zl(this,Wl,"m",Fl).call(this),ec(this,Hl,!0,"f");try{await this.model.createPrivilege({label:e})}finally{ec(this,Hl,!1,"f")}},Xl=async function({privilegeId:e,label:t}){await this.share.modals.confirm({title:wo`delete privilege ${t}?`,body:wo`are you sure you want to delete this privilege?`})&&await this.model.deletePrivilege({privilegeId:e})},Gl=function(){const e=!Zl(this,Kl,"f");return wo`
			<div class=creator>
				<xio-text-input
					?disabled=${Zl(this,Hl,"f")}
					.validator=${Vl}
					@valuechange=${Zl(this,Yl,"f")}
					@enterpress=${Zl(this,Wl,"m",Ql)}>
						privilege label
				</xio-text-input>
				<xio-button
					?disabled=${e}
					@press=${Zl(this,Wl,"m",Ql)}>
						create privilege
				</xio-button>
			</div>
		`},tc=Jl([Xo(Nl)],tc);var ic=Ba`

* {
	ZZoutline: 1px solid #0f02;
}

:host {
	display: block;
	width: 100%;
}

.container {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	gap: 0.5em;
}

.container > * {
	flex: 3 1 10em;
	display: flex;
	flex-direction: column;
}

.roles {
	flex: 1 3 10em;
}

.roles xio-button[data-hard] {
	opacity: 0.6;
}

.container > * > p {
	padding: 0 0.5em;
}

[part=plate] {
	flex: 1 1 auto;
	padding: 0.5em;
	background: #fff2;
}

[part=plate] xio-button {
	display: inline-block;
	margin: 0.2em 0.1em;
	--xio-button-disabled-opacity: 0.6;
}

[part=plate] xio-button[data-hard] {
	opacity: 0.6;
}

[part=plate] xio-button[data-selected]::part(button) {
	border: 1px solid lime;
	background: yellow;
	color: black;
}

[part=plate] xio-button > div {
	display: flex;
	flex-direction: row;
}

[part=plate] xio-button .icon {
	margin-right: 0.2em;
}

[part=plate] xio-button svg {
	width: 0.8em;
	height: 0.8em;
}

.buttonbar {
	text-align: right;
	background: #0002;
}

.buttonbar [data-button=delete] {
	--xio-button-hover-color: red;
	--xio-button-hover-background: transparent;
}

.buttonbar [data-button=new] {
	--xio-button-hover-color: lime;
	--xio-button-hover-background: transparent;
}

`,nc=yo`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-lock"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`,ac=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let oc=class extends(er()(sr)){constructor(){super(...arguments),this.clickRole=e=>()=>{this.roleSelected=e},this.clickDeleteRole=async()=>{const{modals:e,permissionsModel:t}=this.share,i=this.roleSelected;await e.confirm({title:"Delete role?",body:`Are you sure you want to permanently delete the role "${i.label}"`,yes:{vibe:"negative",label:"Delete role"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2})&&await t.deleteRole({roleId:i.roleId})},this.clickNewRole=async()=>{const{modals:e,permissionsModel:t}=this.share,i=await e.prompt({title:"Create a new role",input:{label:"Role name",validator:Ei},yes:{vibe:"positive",label:"Create role"}});i&&await t.createRole({label:i.value})},this.clickAvailablePrivilege=e=>async()=>{const{roleSelected:t}=this;t&&await this.share.permissionsModel.assignPrivilege({privilegeId:e,roleId:t.roleId})},this.clickAssignedPrivilege=e=>async()=>{const{roleSelected:t}=this;t&&await this.share.permissionsModel.unassignPrivilege({privilegeId:e,roleId:t.roleId})}}init(){this.share.permissionsModel.initialize()}getAssignedPrivileges(e){const{roleSelected:t}=this;if(!t)return[];const i=e.rolesHavePrivileges.filter((({roleId:e})=>e===t.roleId)).map((({privilegeId:e})=>e));return e.privileges.filter((({privilegeId:e})=>i.includes(e))).map((i=>{const{active:n,immutable:a}=e.rolesHavePrivileges.find((e=>e.roleId===t.roleId&&e.privilegeId===i.privilegeId));return{...i,active:n,immutable:a}}))}renderPrivilege({privilegeId:e,label:t,hard:i,immutable:n,onPrivilegeClick:a}){return wo`
			<xio-button
				title="${e}"
				?disabled=${n}
				?data-hard=${i}
				?data-soft=${!i}
				?data-immutable=${n}
				@press=${a}>
					<div>
						${i?wo`<div class=icon>${zl}</div>`:null}
						${n?wo`<div class=icon>${nc}</div>`:null}
						${t}
					</div>
			</xio-button>
		`}renderPermissions(e){const t=this.getAssignedPrivileges(e),i=t.filter((e=>e.active)),n=this.roleSelected?[...e.privileges.filter((e=>!t.find((t=>t.privilegeId===e.privilegeId)))).map((e=>({...e,immutable:!1}))),...t.filter((e=>!e.active))]:[];return wo`
			<div class=container>
				<div class=roles>
					<p>roles</p>
					<div part=plate>
						${e.roles.map((e=>wo`
							<xio-button
								title="${e.roleId}"
								?data-selected=${this.roleSelected&&e.roleId===this.roleSelected.roleId}
								?data-hard=${e.hard}
								?disabled=${this.roleSelected&&e.roleId===this.roleSelected.roleId}
								@click=${this.clickRole(e)}>
								<div>
									${e.hard?wo`<div class=icon>${zl}</div>`:null}
									${e.label}
								</div>
							</xio-button>
						`))}
					</div>
					<div part=plate class=buttonbar>
						${this.roleSelected?wo`
								<xio-button
									data-button=delete
									?disabled=${this.roleSelected.hard}
									@press=${this.clickDeleteRole}>
										delete role
								</xio-button>
							`:null}
						<xio-button data-button=new @press=${this.clickNewRole}>
							new role
						</xio-button>
					</div>
				</div>

				<div class=assigned>
					<p>
						privileges assigned
						${this.roleSelected?` to "${this.roleSelected.label}"`:null}
					</p>
					<div part=plate>
						${i.map((e=>this.renderPrivilege({...e,onPrivilegeClick:this.clickAssignedPrivilege(e.privilegeId)})))}
					</div>
				</div>

				<div class=available>
					<p>privileges available</p>
					<div part=plate>
						${n.map((e=>this.renderPrivilege({...e,onPrivilegeClick:this.clickAvailablePrivilege(e.privilegeId)})))}
					</div>
				</div>
			</div>
		`}render(){const{permissionsModel:e}=this.share,{getUserCanCustomizePermissions:t,readable:i}=e;return t()?cl(i.permissionsDisplay,this.renderPermissions.bind(this)):wo`
				<p>you are not privileged to customize permissions</p>
			`}};function rc({models:e,modals:t}){const{accessModel:i,appsModel:n,personalModel:a,permissionsModel:o}=e;return{XiomeMyAvatar:Jo(i.subscribe)(Zo({accessModel:i})(Rl)),XiomeLoginPanel:Jo(i.subscribe)(Zo({accessModel:i})(Ul)),XiomeAppManager:Jo(n.subscribe)(Zo({modals:t,appsModel:n})(Cl)),XiomeMyAccount:Jo(a.subscribe)(Zo({personalModel:a})(ql)),XiomePermissions:Jo(o.subscribe)(Zo({modals:t,permissionsModel:o})(oc)),XiomePrivileges:Jo(o.subscribe)(Zo({modals:t,permissionsModel:o})(tc))}}ac([Vo()],oc.prototype,"roleSelected",void 0),oc=ac([Xo(ic)],oc);var sc=yo`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,lc=yo`
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`,cc=yo`
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>`,dc=yo`
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-power"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path><line x1="12" y1="2" x2="12" y2="12"></line></svg>`;function uc(e,t,i){return 1===e?t:i}var pc=yo`
<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-x"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>`,hc=yo`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-circle"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>`;var mc,fc,bc,gc,vc,wc,yc,xc,Ic,kc,$c,Sc,Pc,Ac,Oc,Mc,Cc=Ba`

:host {
	display: block;
	max-width: 56em;
	--xiome-chat-history-height: 20em;
}

.modheader {
	display: flex;
	flex-wrap: wrap;
	flex-direction: row;
	align-items: end;
	padding: 0 1em;
}

.modheader > span:nth-child(1) {
	opacity: 0.5;
	padding: 0.2em 0;
}

.modheader > span:nth-child(2) {
	margin-left: auto;
}

xio-button {
	--xio-button-disabled-border-style: none;
}

.modheader xio-button {
	--xio-button-border: none;
}

.modheader xio-button::part(button-slot) {
	display: flex;
	align-items: center;
	gap: 0.5em;
}

.history {
	padding: 1em;
	border: 1px solid;
	border-radius: 0.5em 0.5em 0 0;
	border-bottom: 0;
}

.chatbox xiome-login-panel {
	display: block;
	border: 1px solid currentColor;
	border-radius: 0 0 0.5em 0.5em;
}

.chatbox xiome-login-panel[status="logged-out"] {
	padding: 1em;
}

.chatbox slot[name="offline"],
.chatbox slot[name="muted"] {
	display: block;
	padding: 2em 1em;
	text-align: center;
}

.chatbox slot[name="offline"] {
	border: 1px solid currentColor;
	border-radius: 0.5em;
}

.chatfooter {
	display: flex;
	flex-wrap: wrap;
	align-items: center;
	margin: 0.1em 0.5em;
}

.chatfooter svg {
	width: 1.3em;
}

.chatfooter .user-count {
	margin: 0 0.5em;
}

.chatfooter .user-counting-details {
	opacity: 0.5;
}

${Ba`

.history ol,
.history slot[name="no-messages"] {
	height: var(--xiome-chat-history-height);
	overflow-y: auto;
	scrollbar-color: #0004 #0002;
	scrollbar-width: thin;
}

.history ol::-webkit-scrollbar {
	width: 0.4em;
}

.history ol::-webkit-scrollbar-thumb {
	border-radius: 1em;
	background: #0004;
}

.history ol::-webkit-scrollbar-thumb:hover {
	background: #0008;
}

.history ol::-webkit-scrollbar-thumb:active {
	background: #000a;
}

.history ol::-webkit-scrollbar-track {
	border-radius: 1em;
	background: #0002;
}

slot[name="no-messages"] {
	opacity: 0.5;
	display: flex;
	justify-content: center;
	align-items: center;
	text-align: center;
}

.history li + li {
	margin-top: 0.75em;
}

.history li > header {
	display: flex;
	flex-direction: row;
	align-items: center;
	gap: 0.5em;
}

.history li .moderation {
	opacity: 0.5;
}

.history li > header > span {
	display: flex;
	align-items: center;
}

.history li > header > span > xio-button {
	--xio-button-border: none;
	--xio-button-padding: 0 0.3em;
}

.history li .nickname {
	font-size: 1em;
	opacity: var(--xio-chat-nickname-opacity, 0.5);
	color: var(--xio-chat-nickname-color, currentColor);
}

.history li .userid {
	font-size: 1em;
	opacity: var(--xio-chat-userid-opacity, 0.5);
	color: var(--xio-chat-userid-color, currentColor);
}

.history li .content {
	font-size: 1.3em;
	word-break: break-word;
}

.history li .time {
	opacity: 0.3;
	font-size: 1rem;
}

`}

.authorship {
	display: flex;
	align-items: stretch;
	Xborder: 1px solid;
}

.authorship xio-text-input {
	border-right: 1px solid;
	--xio-text-input-height: 6em;
	--xio-text-input-label-opacity: 0.5;
	--xio-text-input-border: 0;
	--xio-text-input-pad: 1em;
}

.authorship xio-button {
	height: 6em;
	flex: 1 1 auto;
	--xio-button-border: 0;
	--xio-button-disabled-border-style: none;
}

.authorship xio-button::part(button) {
	width: 100%;
}

.authorship .inputlabel {
	display: block;
	opacity: 0.5;
	padding: 0.2em 0;
	margin-left: 1em;
}

`,Ec=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},_c=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},Rc=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i};let Tc=class extends(er()(sr)){constructor(){super(...arguments),mc.add(this),this.room="default",gc.set(this,void 0),vc.set(this,(()=>{})),wc.set(this,!0),xc.set(this,(()=>{const e=this.shadowRoot.querySelector(".history ol");e?e.scrollHeight<=e.clientHeight?Rc(this,wc,!0,"f"):_c(this,wc,"f")&&e.scrollTo(0,e.scrollHeight-e.clientHeight):Rc(this,wc,!0,"f")})),this.draftValid=!1,this.tooSoon=!1,Sc.set(this,Date.now()),Pc.set(this,(()=>{const e=Date.now()-_c(this,Sc,"f");this.tooSoon=e<3e3})),Oc.set(this,(e=>{e.preventDefault();const{tooSoon:t}=this;if(!t){const{value:e}=this.authorshipInput,t={content:e};Rc(this,Sc,Date.now(),"f"),this.authorshipInput.text="",_c(this,Pc,"f").call(this),_c(this,gc,"f").post(t)}}))}subscribe(){_c(this,mc,"a",fc).session(this.room).then((({room:e,dispose:t})=>{Rc(this,gc,e,"f"),Rc(this,vc,t,"f")})).then((()=>this.requestUpdate()));const e=[super.subscribe(),()=>_c(this,vc,"f").call(this),_c(this,mc,"m",Ac).call(this),_c(this,mc,"a",fc).subscribeToChange(_c(this,xc,"f"))];return()=>{for(const t of e)t()}}render(){return cl(_c(this,mc,"a",fc).state.connectionOp,(()=>{var e;return wo`
			<div class=chatbox>
				${_c(this,gc,"f")?wo`
						${_c(this,mc,"m",kc).call(this)}
						${(null===(e=_c(this,gc,"f"))||void 0===e?void 0:e.status)===ze.Online?[_c(this,mc,"m",$c).call(this),_c(this,mc,"m",Mc).call(this),_c(this,mc,"m",Ic).call(this)]:wo`
								<slot name=offline>
									chat is offline
								</slot>
							`}
					`:null}
			</div>
		`}))}};function Dc({models:e,modals:t}){const{chatModel:i}=e;return{XiomeChat:Jo(i.subscribe)(Zo({modals:t,chatModel:i})(Tc))}}gc=new WeakMap,vc=new WeakMap,wc=new WeakMap,xc=new WeakMap,Sc=new WeakMap,Pc=new WeakMap,Oc=new WeakMap,mc=new WeakSet,fc=function(){return this.share.chatModel},bc=function(){var e;const t=null===(e=_c(this,mc,"a",fc).state.cache.roomStats)||void 0===e?void 0:e.statsForRooms;if(t)return t[this.room]},yc=function(){const e=this.shadowRoot.querySelector("ol"),{scrollTop:t,scrollHeight:i,clientHeight:n}=e;Rc(this,wc,i-n-t<50,"f")},Ic=function(){const e=_c(this,mc,"a",bc);if(e){const{moderators:t,viewers:i,participants:n,totalUsers:a}=e;return _c(this,gc,"f")?wo`
					<p class=chatfooter>
						${sc}
						<span class=user-count>
							${a} ${uc(a,"user","users")}
						</span>
						<span class=user-counting-details>
							(${t} ${uc(t,"moderator","moderators")},
							${n} ${uc(n,"participant","participants")},
							${i} ${uc(i,"viewer","viewers")})
						</span>
					</p>
				`:null}},kc=function(){const e=_c(this,gc,"f").status,t=_c(this,gc,"f").muted.length;return _c(this,mc,"a",fc).allowance.moderateAllChats?wo`
				<header class=modheader>
					<span>room="${this.room}"</span>
					<span>
						<xio-button
							title="unmute ${t} users"
							?disabled=${0===t}
							@press=${()=>_c(this,gc,"f").unmuteAll()}>
								${cc} ${t}
						</xio-button>
						<xio-button
							title="clear chat room"
							@press=${()=>_c(this,gc,"f").clear()}>
								${lc}
						</xio-button>
						<xio-button
							title="set chat ${e===ze.Offline?"online":"offline"}"
							@press=${()=>{_c(this,gc,"f").setRoomStatus(_c(this,gc,"f").status===ze.Offline?ze.Online:ze.Offline)}}>
								${dc}
						</xio-button>
					</span>
				</header>
			`:null},$c=function(){return wo`
			<div class=history>
				${_c(this,mc,"a",fc).allowance.viewAllChats?wo`
						${_c(this,gc,"f").posts.length?wo`
								<ol @scroll=${_c(this,mc,"m",yc)}>
									${_c(this,gc,"f").posts.map((e=>function({post:e,isModerator:t,mute:i,remove:n,mutedIds:a}){const o=rl(e.time),r=a.includes(e.userId);return wo`
		<li data-post="${e.postId}">
			<header>
				<span class=nickname>${e.nickname}</span>
				${t?wo`
						<span class=moderation>
							<xio-button
								title="mute user"
								@press=${i}
								?disabled=${r}>
									${pc}
							</xio-button>
							<xio-button
								title="delete post"
								@press=${n}>
									${hc}
							</xio-button>
						</span>
					`:null}
				<xio-id class=userid title="copy user id" id="${e.userId}"></xio-id>
			</header>
			<div>
				<p class=content>
					${e.content}
					<span class=time title="${o.date} ${o.zone}">
						${o.time}
					</span>
				</p>
			</div>
		</li>
	`}({post:e,isModerator:_c(this,mc,"a",fc).allowance.moderateAllChats,mute:()=>_c(this,gc,"f").mute(e.userId),remove:()=>_c(this,gc,"f").remove([e.postId]),mutedIds:_c(this,gc,"f").muted})))}
								</ol>
							`:wo`
								<slot name=no-messages>
									no messages
								</slot>
							`}
					`:wo`
						<slot name=cannot-view>
							you are not privileged to view the chat
						</slot>
					`}
			</div>
		`},Ac=function(){const e=setInterval(_c(this,Pc,"f"),1e3);return()=>clearInterval(e)},Mc=function(){const e=()=>_c(this,gc,"f").weAreBanned?wo`<slot name=banned>you are banned</slot>`:_c(this,gc,"f").weAreMuted?wo`<slot name=muted>you are muted</slot>`:function({sendable:e,onSendClick:t,onEnterPress:i,onValidityChange:n}){return wo`
		<div class=authorship>

			<xio-text-input
				textarea
				.validator=${kt}
				@valuechange=${function(e){const t=e.detail.value;n(void 0!==t)}}
				@enterpress=${i}>
			</xio-text-input>

			<xio-button
				?disabled=${!e}
				@press=${t}>
					send message
			</xio-button>
		</div>
	`}({sendable:!!this.draftValid&&!this.tooSoon,onSendClick:_c(this,Oc,"f"),onEnterPress:_c(this,Oc,"f"),onValidityChange:e=>this.draftValid=e});return wo`
			<xiome-login-panel>
				${ll(_c(this,mc,"a",fc).state.accessOp,(()=>wo`
					<slot name=logged-out slot=logged-out>
						login to participate in the chat
					</slot>
					<div class=participation>
						${_c(this,mc,"a",fc).allowance.participateInAllChats?e():wo`
								<slot name=cannot-participate>
									you do not have privilege to participate in the chat
								</slot>
							`}
					</div>
				`))}
			</xiome-login-panel>
		`},Ec([Vo({type:String})],Tc.prototype,"room",void 0),Ec([Vo()],Tc.prototype,"draftValid",void 0),Ec([Wo(".authorship xio-text-input")],Tc.prototype,"authorshipInput",void 0),Ec([Vo()],Tc.prototype,"tooSoon",void 0),Tc=Ec([Xo(Cc)],Tc);var qc=Ba`

:host {
	display: flex;
	flex-direction: column;
	align-items: stretch;
	justify-content: center;
	max-width: 32em;
	border: solid 0.1em;
}

xio-button {
	--xio-button-border: none;
	--_disabled-border-style: none;
}

/* Note tabs new/old */

.tabs {
	display: flex;
	justify-content: space-evenly;
	padding-bottom: 1em;
	margin: 1em 2em;
	border-bottom: solid 0.1em;
}

[data-tab] {
	font-weight: normal;
}

[data-tab][data-active='true'] {
	font-weight: bold;
	border-bottom: solid 0.2em;
}

/* Individual note */

ol > li {
	display: flex;
	flex-direction: column;
	padding: 1em;
	margin: 1em 2em;
	border: solid 0.1em;
	list-style-type: none;
}

ol > li > header {
	display: flex;
	justify-content: space-between;
	align-self: flex-end;
	width: 100%;
}

ol > li > p {
	opacity: 0.6;
}

/* Pagination */

.paginationBar {
	display: flex;
	justify-content: center;
	align-items: center;
	margin: 1em 2em;
}

.paginationBar > span {
	margin: 0em 1em;
}

/* Notifications */

xio-op[mode="loading"], slot {
	display: block;
	text-align: center;
	width: 100%;
	margin-bottom: 1em;
}

/* Button bar */

.buttonbar {
	display: flex;
	justify-content: flex-end;
	padding-top: 1em;
	margin: 0 2em 1em 2em;
	border-top: solid 0.1em;
}

.buttonbar > xio-button {
	--xio-button-border: solid 0.1em;
}
`,Lc=yo`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg>`,jc=yo`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>`,Uc=yo`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>`,Nc=yo`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`;const zc=e=>1===e?"":"s";var Bc,Vc,Wc,Hc,Fc,Qc,Xc,Kc,Yc,Gc=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},Jc=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};let Zc=class extends(er()(sr)){constructor(){super(...arguments),Bc.add(this),Vc.set(this,this.share.notesModel),Wc.set(this,this.share.notesModel.createNotesCacheDetails()),Hc.set(this,Jc(this,Wc,"f").cache)}async init(){await Jc(this,Vc,"f").initialize()}subscribe(){const e=[super.subscribe(),Jc(this,Wc,"f").setup(),Jc(this,Hc,"f").subscribe((()=>this.requestUpdate()))];return Jc(this,Vc,"f").isLoggedIn&&Jc(this,Hc,"f").fetchAppropriateNotes(),()=>e.forEach((e=>e()))}render(){return cl(Jc(this,Vc,"f").state.accessOp,(e=>(null==e?void 0:e.user)?wo`
					${Jc(this,Bc,"m",Yc).call(this)}
				`:wo`
					<slot name="logged-out">
						you must be logged in to see your notifications
					</slot>
				`))}};Vc=new WeakMap,Wc=new WeakMap,Hc=new WeakMap,Bc=new WeakSet,Fc=function(){const{old:e}=Jc(this,Hc,"f").cacheState,{switchTabNew:t,switchTabOld:i}=Jc(this,Hc,"f");return wo`
			<div class=tabs>
				<xio-button
					@press=${t}
					data-tab="new"
					data-active=${!e}>
						new
				</xio-button>
				<xio-button
					@press=${i}
					data-tab="old"
					data-active=${e}>
						old
				</xio-button>
			</div>
		`},Qc=function(){const{old:e,notesOp:t}=Jc(this,Hc,"f").cacheState,{markSpecificNoteNew:i,markSpecificNoteOld:n}=Jc(this,Hc,"f"),a=Date.now();return cl(t,(t=>wo`
			<ol>
				${t.map((t=>wo`
					<li>
						<header class="note-header">
							<h2>${t.title}</h2>
							${e?wo`
								<xio-button @press=${()=>i(t.noteId)}>
									${Uc}
								</xio-button>
							`:wo`
								<xio-button @press=${()=>n(t.noteId)}>
									${Nc}
								</xio-button>
							`}
						</header>
						<p><strong>${t.type}</strong> â€“ <em>${function(e){const t=t=>{const i=Math.floor(e/t);return e%=t,i},i=t(ie),n=t(te),a=t(ee),o=t(1e3),r={days:`${i} day${zc(i)}`,hours:`${n} hour${zc(n)}`,minutes:`${a} minute${zc(a)}`,seconds:`${o} second${zc(o)}`},s=i>3?`${r.days} ago`:i>1?`${r.days} and ${r.hours} ago`:n>3?`${r.hours} ago`:n>1?`${r.hours} and ${r.minutes} ago`:a>3?`${r.minutes} ago`:a>1?`${r.minutes} and ${r.seconds} ago`:`${r.seconds} ago`;return{...r,ago:s}}(a-t.time).ago}</em></p>
					</li>
				`))}
			</ol>
		`))},Xc=function(){const{pageNumber:e}=Jc(this,Hc,"f").cacheState,{nextPage:t,previousPage:i,totalPages:n,isNextPageAvailable:a,isPreviousPageAvailable:o}=Jc(this,Hc,"f");return wo`
			${a||o?wo`
				<div class="paginationBar">
					<xio-button
						?disabled=${!o}
						@press=${i}>
							${Lc}
					</xio-button>
					<span>
						${e} / ${n}
					</span>
					<xio-button
						?disabled=${!a}
						@press=${t}>
							${jc}
					</xio-button>
				</div>
				`:null}
		`},Kc=function(){const{old:e}=Jc(this,Hc,"f").cacheState,{markAllNotesOld:t}=Jc(this,Hc,"f");return wo`
			<div class=buttonbar>
				${e?null:wo`
						<xio-button @press=${t}>
							mark all old
						</xio-button>
					`}
			</div>
		`},Yc=function(){var e;const{old:t,notesOp:i}=Jc(this,Hc,"f").cacheState;return wo`
			${0===(null===(e=re.value(i))||void 0===e?void 0:e.length)?wo`
					${Jc(this,Bc,"m",Fc).call(this)}
					<slot name="empty">
						you have no ${t?"old":"new"} notifications
					</slot>
				`:wo`
					${Jc(this,Bc,"m",Fc).call(this)}
					${Jc(this,Bc,"m",Qc).call(this)}
					${Jc(this,Bc,"m",Xc).call(this)}
					${Jc(this,Bc,"m",Kc).call(this)}
				`}
		`},Zc=Gc([Xo(qc)],Zc);var ed=Ba`

:host {
	display: inline-block;
	--xiome-notes-indicator-count-size: 1em;
	--xiome-notes-indicator-color: red;
	--xiome-notes-indicator-bleedout: 0em;
	font-size: var(--xiome-notes-indicator-size, 1em);
	width: var(--xiome-notes-indicator-icon-size, 3em);
	position: relative;
}

:host([no-icon]) .bell {
	display: none;
}

.count {
	display: flex;
	justify-content: center;
	align-items: center;
	vertical-align: top;
	position: absolute;
	height: 1em;
	width: 1em;
	background-color: var(--xiome-notes-indicator-color);
	border-radius: 50%;
	text-align: center;
	right: var(--xiome-notes-indicator-bleedout);
	top: var(--xiome-notes-indicator-bleedout);
	font-weight: bold;
	color: white;
	font-size: var(--xiome-notes-indicator-count-size);
}
`,td=yo`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bell"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>`,id=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let nd=class extends(er()(sr)){constructor(){super(...arguments),this.noIcon=!1}render(){const e=wo`<span class="bell">${td}</span>`,{stats:t}=this.share.notesModel;return wo`
				${0===t.newCount?wo`${e}`:wo`
					<span class="count">${t.newCount}</span>
					${e}
				`}
			`}};function ad({models:{notesModel:e}}){return{XiomeNotes:Jo(e.stateSubscribe)(Zo({notesModel:e})(Zc)),XiomeNotesIndicator:Jo(e.stateSubscribe)(Zo({notesModel:e})(nd))}}id([Vo({attribute:"no-icon"})],nd.prototype,"noIcon",void 0),nd=id([Xo(ed)],nd);var od=Ba`

:host {
	display: block;
}

`;function rd({view:e,onDeleteClick:t,getPrivilegeDisplay:i}){return wo`
		<div class="view">
			<div class="view-details">
				<div>
					<h4>hosting provider</h4>
					<p>${e.provider}</p>
				</div>
				<div>
					<h4>content type</h4>
					<p>${e.type}</p>
				</div>
				<div>
					<h4>content id</h4>
					<xio-id id="${e.id}"></xio-id>
				</div>
			</div>
			<h4>privileges with access</h4>
			<ul>
				${e.privileges.map(i).map((e=>e?wo`<li>${e.label}</li>`:null))}
			</ul>
			<div class=buttonbar>
			<xio-button @press=${t}>
				unassign from this display
			</xio-button>
			</div>
		</div>
	`}var sd=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let ld=class extends(er()(sr)){async init(){this.share.contentModel.initializeForModerationData()}render(){const e=this.share.contentModel;return e.allowance.canModerateVideos?cl(e.state.viewsOp,(t=>wo`
				<slot>
					<h3>all video views</h3>
				</slot>
				${t.length?wo`
					<div class=views>
						${t.map((t=>rd({view:t,onDeleteClick:()=>e.deleteView(t.label),getPrivilegeDisplay:t=>e.getPrivilege(t)})))}
					</div>
				`:wo`
					<slot name=no-views>
						<p>no video views are registered</p>
					</slot>
				`}
			`)):wo`
				<slot name=unprivileged>
					<p>you don't have sufficient privileges to moderate video views</p>
				</slot>
			`}};ld=sd([Xo(od)],ld);var cd,dd,ud,pd,hd,md,fd,bd,gd,vd,wd=yo`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>`,yd=Ba`

:host {
	display: block;
	width: 24em;
	max-width: 100%;
	border: 1px solid;
	border-radius: 5px;
	--xiome-video-hosting-warning-color: red;
}

.dacastbox {
	padding: 1em;
}

xio-text-input::part(problems) {
	width: 100%;
}

.buttonbar {
	display: flex;
	flex-direction: row;
	justify-content: flex-end;
}

.buttonbar > * {
	margin: 0.4em 0.2em;
}

.failed {
	color: var(--xiome-video-hosting-warning-color);
	display: flex;
	align-items: center;
	padding: 0.5em 0;
}

.failed svg {
	margin-right: 0.5em;
}

.linked {
	display: flex;
}

.helpbox ul {
	padding-left: 1.5em;
}

.link-time-info {
	display: inline-flex;
	align-items: center;
	padding: 0.5em 0;
}


.unlink-button {
	display: flex;
	justify-content: flex-end;
}

.link-time-info svg {
	width: 6em;
	height: 3em;
}
`,xd=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},Id=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},kd=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i};let $d=class extends(er()(sr)){constructor(){super(...arguments),cd.set(this,!1),dd.set(this,!1),ud.set(this,""),pd.set(this,(({detail:{value:e}})=>{kd(this,ud,e,"f"),this.requestUpdate()})),hd.set(this,(async()=>{const e=Id(this,ud,"f");if(e){kd(this,dd,!1,"f"),kd(this,ud,"","f");const t=await this.share.dacastModel.linkAccount({apiKey:e});kd(this,dd,!t,"f")}})),md.set(this,(async()=>{kd(this,ud,"","f"),await this.share.dacastModel.unlinkAccount()})),fd.set(this,(()=>{kd(this,cd,!Id(this,cd,"f"),"f"),this.requestUpdate()})),bd.set(this,(()=>wo`
			<div class=helpbox>
				<p>how to find your dacast api key:</p>
				<ul>
					<li>create a <a part=link target=_blank href="https://dacast.com/">dacast</a> account</li>
					<li>if you have a trial account, you must email support and ask them to activate your account's "api access"</li>
					<li>generate an api key in your <a part=link target=_blank href="https://app.dacast.com/settings/integrations">dacast integrations settings</a></li>
				</ul>
			</div>
		`)),gd.set(this,(()=>wo`
			<h2>link your dacast account</h2>
			<xio-text-input
				placeholder="api key"
				.validator=${ji}
				@enterpress=${Id(this,hd,"f")}
				@valuechange=${Id(this,pd,"f")}>
			</xio-text-input>
			${Id(this,dd,"f")?wo`<div class=failed>${mr} <p>dacast rejected the api link</p></div>`:null}
			<div class=buttonbar>
				<xio-button
					class=help-button
					@press=${Id(this,fd,"f")}>
						${Id(this,cd,"f")?"hide help":"show help"}
				</xio-button>
				<xio-button
					class=link-button
					?disabled=${!Id(this,ud,"f")}
					@press=${Id(this,hd,"f")}>
						link
				</xio-button>
			</div>
			${Id(this,cd,"f")?Id(this,bd,"f").call(this):null}
		`)),vd.set(this,(e=>wo`
			<h2>your dacast account is linked</h2>
			<div class=link-time-info>
				${wd}
				<p>linked on ${rl(e.time).full}</p>
			</div>
			<div class=unlink-button>
				<xio-button @press=${Id(this,md,"f")}>unlink</xio-button>
			</div>
		`))}get state(){return this.share.dacastModel.state}async init(){await this.share.dacastModel.initialize()}render(){return cl(this.state.accessOp,(e=>wo`
			<div class=dacastbox>
				${e.permit.privileges.includes(Me["moderate videos"])?cl(this.state.linkedAccountOp,(e=>e?Id(this,vd,"f").call(this,e):Id(this,gd,"f").call(this))):wo`<slot name=forbidden>you don't have permission to edit video hosting settings</slot>`}
			</div>
		`))}};cd=new WeakMap,dd=new WeakMap,ud=new WeakMap,pd=new WeakMap,hd=new WeakMap,md=new WeakMap,fd=new WeakMap,bd=new WeakMap,gd=new WeakMap,vd=new WeakMap,$d=xd([Xo(yd)],$d);var Sd=Ba`

:host {
	display: block;
	--_select-bg: var(--xiome-video-display-select-background, #222);
	--xiome-video-display-selected-option-color: cyan;
}

.controls-title,
.view,
.viewcreator {
	max-width: 42rem;
}

[part="iframe"] {
	width: 100%;
	border: none;
}

.mock-embed img {
	width: 100%;
}

.buttonbar {
	text-align: right;
}

.controls-title,
.viewcreator,
.view {
	border: 1px solid;
	border-radius: 0.2em;
}

.controls-title {
	padding: 0.1em 0.5em;
}
.controls-title[data-open] {
	border-bottom-left-radius: 0;
	border-bottom-right-radius: 0;
}
.view, .viewcreator {
	border-top: 0;
	border-top-left-radius: 0;
	border-top-right-radius: 0;
}

.controls-title {
	display: flex;
	align-items: center;
}
.controls-title div span {
	display: block;
}
.controls-title span:nth-of-type(2) {
	opacity: 0.8;
	font-size: 0.8em;
	font-weight: normal;
	padding-left: 0.2em;
}

.togglebutton {
	--xio-button-border: 0;
	margin-left: auto;
	transition: transform 300ms ease;
	transform: rotate(0deg);
}
[data-open] .togglebutton {
	transform: rotate(180deg);
}

.view, .viewcreator {
	display: flex;
	flex-direction: column;
	gap: 0.2em;
	padding: 0.5em;
}

.viewcreator .selectionarea {
	display: flex;
	flex-wrap: wrap;
	justify-content: space-between;
	width: 100%;
	gap: 0.5em;
	margin: 0.5em 0;
}

.viewcreator .selectionarea > * {
	flex: 1 1 auto;
}

select {
	color: inherit;
	background: transparent;
	border: 1px solid;
	width: 100%;
}

select[multiple] {
	min-height: 10em;
}

select option {
	padding: 0.1em 0.2em;
	color: inherit;
	background: var(--_select-bg);
}

.create-privileges {
	visibility: hidden;
}

.create-privileges[data-visible] {
	visibility: visible;
}

.create-privileges option[selected] {
	color: var(--xiome-video-display-selected-option-color);
}

::-webkit-scrollbar { width: 5px; }
::-webkit-scrollbar-thumb { background: currentColor; }

::scrollbar { width: 8px; }
::scrollbar-thumb { background: currentColor; }

/* When video is displayed css */

.view-details {
	display: flex;
	flex-wrap: wrap;
	justify-content: space-around;
	gap: 0.8em;
	margin: 0.5em 0;
}

.view-details > * {
	text-align: center;
}

.view ul {
	display: flex;
	justify-content: left;
	text-align: center;
	list-style-type: none;
	flex-wrap: wrap;
}

.view ul li {
	border: 1px solid;
	margin: 0.2em;
	padding: 0.1em 0.4em;
	border-radius: 1em;
}

`;function Pd(e,t){const i=document.createElement(e);for(const[e,n]of Object.entries(t))i.setAttribute(e,n);return i}const Ad=/"(https:\/\/iframe\.dacast\.com\/(\S+)\/(\S+))"/i;function Od(e){const t=e.match(Ad);if(!t)throw new Error("failed to parse dacast iframe embed code: make-dacast-iframe likely needs to be updated");const[,,i,n]=t;return`https://iframe.dacast.com/${"playlists"===i?"playlist":i}/${n}`}let Md=0;function Cd({isContentSelected:e,isCreateButtonDisabled:t,privilegesOp:i,catalogOp:n,selectedContent:a,queryAll:o,onCatalogSelect:r,onPrivilegesSelect:s,onCreateClick:l,isPrivilegeSelected:c}){const d=e=>{const t=e.target;r(parseInt(t.value))},u=()=>{s(o(".create-privileges select option").filter((e=>e.selected)).map((e=>e.value)))};function p(){const t=re.value(n);return wo`
			<div class=create-content>
				${t.length?wo`
					<h5>Select content for this view</h5>
					<select @change=${d}>
						${e?null:wo`
								<option disabled selected>
									(select video content)
								</option>
							`}
						${t.map((({provider:e,type:t,title:i},n)=>wo`
							<option value=${n} ?selected=${n===a}>
								${`${e} ${t} ${i}`}
							</option>
						`))}
					</select>
				`:wo`
					<p>no available video content (are your video accounts linked?)</p>
				`}
			</div>
		`}function h(){const t=re.value(i);return wo`
			<div class="create-privileges" ?data-visible=${e}>
				<h5>Select which privileges have access</h5>
				<select multiple @change=${u}>
					${t.map((e=>wo`
						<option
							?selected=${c(e.privilegeId)}
							value="${e.privilegeId}">
								${e.label}
						</option>
					`))}
				</select>
			</div>
		`}return cl(re.combine(n,i),(()=>wo`
		<div class=viewcreator>
			<h4>Assign Video Content</h4>
			<div class=selectionarea>
				${p()}
				${h()}
			</div>
			<div class=buttonbar>
				<xio-button
					class=create-button
					?disabled=${t}
					@press=${l}>
						Assign To This Video
				</xio-button>
			</div>
		</div>
	`))}var Ed=yo`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g transform="rotate(180 8 8)"><g fill="currentColor"><path fill-rule="evenodd" d="M7.022 1.566a1.13 1.13 0 0 1 1.96 0l6.857 11.667c.457.778-.092 1.767-.98 1.767H1.144c-.889 0-1.437-.99-.98-1.767L7.022 1.566z"/></g></g></svg>`;function _d({queryAll:e,contentModel:t,requestUpdate:i}){const{readable:n,writable:a,subscribe:o}=ye({open:!1,selectedContent:void 0,selectedPrivileges:[]}),r=()=>{a.open=!a.open};return{render:function(i){const o=t.getView(i);return wo`
			<h3 class=controls-title ?data-open=${n.open}>
				<div>
					<span>video display controls</span>
					<span>label = <em>"${i}"</em></span>
				</div>
				<xio-button
					class=togglebutton
					title="${n.open?"close":"open"} video controls"
					@press=${r}>
						${Ed}
				</xio-button>
			</h3>
			${n.open?wo`
				${o?rd({view:o,onDeleteClick:()=>t.deleteView(i),getPrivilegeDisplay:e=>t.getPrivilege(e)}):Cd({queryAll:e,catalogOp:t.state.catalogOp,privilegesOp:t.state.privilegesOp,isContentSelected:void 0!==n.selectedContent,selectedContent:n.selectedContent,isCreateButtonDisabled:void 0===n.selectedContent||0===n.selectedPrivileges.length,onCatalogSelect:e=>{a.selectedContent=e,a.selectedPrivileges=[]},isPrivilegeSelected:e=>n.selectedPrivileges.some((t=>t===e)),onPrivilegesSelect:e=>{a.selectedPrivileges=e},onCreateClick:()=>{const{selectedContent:e,selectedPrivileges:o}=n;a.selectedContent=void 0,a.selectedPrivileges=[];const r=t.catalog[e];t.setView({label:i,privileges:o,reference:{id:r.id,type:r.type,provider:r.provider}})}})}
			`:null}
		`},subscribe:()=>o(i)}}var Rd,Td,Dd,qd,Ld,jd=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},Ud=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};let Nd=class extends(er()(sr)){constructor(){super(...arguments),Rd.add(this),this.label="default",this["mock-embed"]=!1,this["show-title"]=!1,Dd.set(this,function(){const e=new Map;return{obtain(t,i){if("dacast"!==t.provider)throw new Error(`unsupported video provider "${t.provider}"`);let n=e.get(t.id);if(!n){n=Pd("div",{"data-id":t.id});const a=i?Pd("img",{part:"iframe",alt:"",src:"https://source.unsplash.com/random/480x270?"+Md++}):Pd("iframe",{src:Od(t.embed),part:"iframe",allowfullscreen:"",webkitallowfullscreen:"",mozallowfullscreen:"",oallowfullscreen:"",msallowfullscreen:"",frameborder:"0",scrolling:"no",allow:"autoplay"});n.appendChild(a),e.set(t.id,n)}return n}}}()),qd.set(this,(()=>{const e=_d({contentModel:Ud(this,Rd,"a",Td),requestUpdate:()=>this.requestUpdate(),queryAll:e=>Array.from(this.shadowRoot.querySelectorAll(e))});return this.addSubscription(e.subscribe),e})())}async init(){await Ud(this,Rd,"a",Td).initializeForVideo(this.label)}render(){return cl(Ud(this,Rd,"a",Td).state.accessOp,(()=>wo`
			${Ud(this,Rd,"a",Td).allowance.canModerateVideos?Ud(this,qd,"f").render(this.label):null}
			${Ud(this,Rd,"m",Ld).call(this)}
		`))}};Dd=new WeakMap,qd=new WeakMap,Rd=new WeakSet,Td=function(){return this.share.contentModel},Ld=function(){var e;const t=Ud(this,Rd,"a",Td).getShow(this.label);return t?t.details?wo`
					${this["show-title"]?wo`<h4 part=title>${t.details.title}</h4>`:null}
					${null!==(e=Ud(this,Dd,"f").obtain(t.details,this["mock-embed"]))&&void 0!==e?e:"(embed missing)"}
					<slot></slot>
				`:wo`<slot name=unprivileged></slot>`:wo`<slot name=unavailable></slot>`},jd([Vo({type:String})],Nd.prototype,"label",void 0),jd([Vo({type:Boolean,reflect:!0})],Nd.prototype,"mock-embed",void 0),jd([Vo({type:Boolean,reflect:!0})],Nd.prototype,"show-title",void 0),Nd=jd([Xo(Sd)],Nd);var zd,Bd,Vd=Ba`

:host {
	display: block;
}

`,Wd=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},Hd=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};let Fd=class extends(er()(sr)){constructor(){super(...arguments),zd.add(this),this.label="default"}init(){Hd(this,zd,"a",Bd).initializeForVideo(this.label)}render(){const e=Hd(this,zd,"a",Bd).getShow(this.label),{accessOp:t,showsOp:i}=Hd(this,zd,"a",Bd).state;return cl(re.combine(t,i),(()=>e?e.details?wo`<slot></slot>`:wo`<slot name=unprivileged></slot>`:wo`<slot name=unavailable></slot>`))}};function Qd({models:e}){const{dacastModel:t,contentModel:i}=e.videoModels;return{XiomeVideoHosting:Jo(t.subscribe)(Zo({dacastModel:t})($d)),XiomeVideoDisplay:Jo(i.subscribe)(Zo({contentModel:i})(Nd)),XiomeVideoViews:Jo(i.subscribe)(Zo({contentModel:i})(ld)),XiomeVideoCompanion:Jo(i.subscribe)(Zo({contentModel:i})(Fd))}}zd=new WeakSet,Bd=function(){return this.share.contentModel},Wd([Vo({type:String})],Fd.prototype,"label",void 0),Fd=Wd([Xo(Vd)],Fd);var Xd=Ba`

:host {
	display: block;
}

`,Kd=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let Yd=class extends(er()(sr)){get state(){return this.share.exampleModel.state}render(){return cl(this.state.accessOp,(e=>wo`
			<p>Example Component</p>
			${(null==e?void 0:e.user)?wo`<p>Welcome, ${e.user.profile.nickname}</p>`:wo`<p>User is not logged in.</p>`}
		`))}};function Gd({models:e,modals:t}){const{exampleModel:i}=e;return{XiomeExample:Jo(i.subscribe)(Zo({modals:t,exampleModel:i})(Yd))}}Yd=Kd([Xo(Xd)],Yd);var Jd=Ba`

/* * {
	outline: 1px solid #f002;
} */

:host {
	display: block;
	max-width: 42em;
	--like-color: var(--xiome-questions-like-color, cyan);
	--report-color: var(--xiome-questions-report-color, #f90);
}

.questions-moderation-panel {
	padding: 1em;
	border: 1px dotted;
	margin-bottom: 1em;
}

.questions-moderation-panel .purge-button {
	--xio-button-hover-color: red;
}

slot[name="empty"] {
	display: block;
	margin-top: 1em;
}

[part="questions-list"] {
	list-style: none;

}

[part="questions-list"] > li {
	margin-top: 2em;
}

${Ba`

${Ba`

[data-vote] {
	display: block;
	border: none;
	font: inherit;
	background: transparent;
	color: inherit;
}

[data-vote] {
	cursor: pointer;
	opacity: 0.6;
	user-select: none;
}

[data-vote="report"] {
	opacity: 0.4;
}

[data-vote]:not([disabled]):hover,
[data-vote]:not([disabled]):focus {
	opacity: 1;
}

[data-vote][disabled] {
	cursor: default;
}

[data-vote="like"][data-active] {
	color: var(--like-color);
}

[data-vote="report"][data-active] {
	color: var(--report-color);
}

[data-vote] > span {
	vertical-align: middle;
}

[data-vote] > span:nth-child(2) {
	font-size: 0.9em;
}

[data-vote] svg {
	width: 1.4em;
	height: 1.4em;
	position: relative;
	top: 0.1em;
}

`}

.post {
	display: grid;
	grid-template-rows: auto;
	grid-template-columns: auto 1fr auto;
	grid-template-areas:
		".... tophat    ...."
		"bar1 bubble    bar2"
		".... buttonbar ....";
}

a {
	opacity: 0.5;
	color: inherit;
	text-decoration: none;
}

a:hover, a:focus {
	opacity: 0.8;
	text-decoration: underline;
}

/*
** normal questions
*/

.post .tophat { grid-area: tophat }
.post .bar1 { grid-area: bar1 }
.post .bar2 { grid-area: bar2 }
.post .bubble { grid-area: bubble }
.post .buttonbar { grid-area: buttonbar }

.post .bar {
	padding: 0.5em;
	padding-top: 0.2em;
	display: flex;
	flex-direction: column;
}

.post .bar > * + * {
	margin-top: 0.1em;
}

.post .bar.bar2 {
	padding-top: 0;
}

.post .metabar {
	font-size: 0.7em;
	padding: 0 1.5em;
	opacity: 0.6;
}

.post .tophat xio-profile-card {
	width: 100%;
}

.post .bubble {
	flex: 1 1 auto;
	/* padding-left: 1em; */
}

.post .bubble xio-text-input {
	--xio-text-input-border-radius: 0 1em 1em 1em;
	--xio-text-input-pad: 0.5em;
}

.post .bubble .textbox p {
	border-radius: 0 1em 1em 1em;
	border: 1px solid;
	padding: 0.5em;
	min-height: 4em;
}

.post [part="bubble"] {
	white-space: pre-wrap;
}

/*
** question editor
*/

.intro {
	margin-bottom: 1em;
}

.intro .heading {
	font-size: 2em;
}

.post.editor .buttonbar {
	text-align: right;
	padding: 0.5em;
}

.post.editor {
	padding-bottom: 2em;
	margin-bottom: 2em;
	border-bottom: 1px dashed;
}

`}

[part="answers-list"] {
	list-style: none;
	margin-left: 3.4em;
	margin-right: 1em;
	margin-bottom: 1em;
}

[part="answers-list"] > li {
	
	margin-top: 1em;
}

@media (max-width: 420px) {
	[part="answers-list"] {
		margin-left: 1em;
		margin-right: 0;
	}
	[part="answers-list"] > li {
		border-left: 1px solid;
	}
}

/*
** question editor
*/

.editor .intro {
	margin-bottom: 1em;
}

.editor .intro .heading {
	font-size: 2em;
}

.editor .buttonbar {
	text-align: right;
	padding: 0.5em;
}

.question-editor {
	padding-bottom: 2em;
	margin-bottom: 2em;
	border-bottom: 1px dashed;
}

/*
** answer editor
*/

.answer-editor {
	border: 1px dashed;
	margin-left: 5em;
	margin-top: 1em;
}

.answer-editor .intro {
	padding: 1em;
}

`;const Zd=1*ie;function eu(e,t){const i=tu(e),n=tu(t);return i>n?-1:n<i?1:0}function tu({timePosted:e,likes:t,reports:i}){return e+iu(t,Zd)-iu(i,1728e5)}function iu(e,t){return(0===e?0:1+Math.log10(e))*t}function nu({content:e,editable:t,timePosted:i,handleValueChange:n=(()=>{})}){const{date:a,time:o}=rl(i);return wo`
		<div class=bubble ?data-editable=${t}>
			<div class=textbox>
				${t?wo`
						<xio-text-input
							exportparts="textinput: bubble"
							textarea
							.validator=${rn}
							@valuechange=${n}
						></xio-text-input>
					`:wo`
						<p part=bubble>${e}</p>
					`}
			</div>
			<div class=metabar>
				<p>${`${a} ${o}`}</p>
			</div>
		</div>
	`}function au(e){return t=>{t.preventDefault(),e()}}var ou;!function(e){e[e.Question=0]="Question",e[e.Answer=1]="Answer",e[e.Editor=2]="Editor"}(ou||(ou={}));var ru=yo`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M6.736 4C4.657 4 2.5 5.88 2.5 8.514c0 3.107 2.324 5.96 4.861 8.12a29.66 29.66 0 0 0 4.566 3.175l.073.041l.073-.04c.271-.153.661-.38 1.13-.674c.94-.588 2.19-1.441 3.436-2.502c2.537-2.16 4.861-5.013 4.861-8.12C21.5 5.88 19.343 4 17.264 4c-2.106 0-3.801 1.389-4.553 3.643a.75.75 0 0 1-1.422 0C10.537 5.389 8.841 4 6.736 4zM12 20.703l.343.667a.75.75 0 0 1-.686 0l.343-.667zM1 8.513C1 5.053 3.829 2.5 6.736 2.5C9.03 2.5 10.881 3.726 12 5.605C13.12 3.726 14.97 2.5 17.264 2.5C20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262a31.146 31.146 0 0 1-5.233 3.576l-.025.013l-.007.003l-.002.001l-.344-.666l-.343.667l-.003-.002l-.007-.003l-.025-.013A29.308 29.308 0 0 1 10 20.408a31.147 31.147 0 0 1-3.611-2.632C3.8 15.573 1 12.332 1 8.514z" fill="currentColor"/></svg>`,su=yo`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M14 20.408c-.492.308-.903.546-1.192.709c-.153.086-.308.17-.463.252h-.002a.75.75 0 0 1-.686 0a16.709 16.709 0 0 1-.465-.252a31.147 31.147 0 0 1-4.803-3.34C3.8 15.572 1 12.331 1 8.513C1 5.052 3.829 2.5 6.736 2.5C9.03 2.5 10.881 3.726 12 5.605C13.12 3.726 14.97 2.5 17.264 2.5C20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262A31.146 31.146 0 0 1 14 20.408z" fill="currentColor"/></svg>`;function lu({title:e,dataVote:t,voteCount:i,voteCasted:n,icon:a,castVote:o}){const r=o?n?()=>o(!1):()=>o(!0):()=>{};return wo`
		<button
			tabindex=0
			data-vote="${t}"
			?data-active=${n}
			?disabled=${!o}
			title="${e}"
			@click=${r}>
				<span>${a}</span>
				<span>${i}</span>
		</button>
	`}function cu(e){return lu({dataVote:"like",icon:e.liked?su:ru,title:e.liked?"unlike this post":"like this post",voteCount:e.likes,voteCasted:e.liked,castVote:e.castLikeVote?t=>e.castLikeVote(t):void 0})}var du=yo`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 20 20"><g fill="none"><path d="M8.686 2.852L2.127 14.777A1.5 1.5 0 0 0 3.441 17H16.56a1.5 1.5 0 0 0 1.314-2.223L11.314 2.852a1.5 1.5 0 0 0-2.628 0zM10 6.75a.75.75 0 0 1 .75.75v4a.75.75 0 0 1-1.5 0v-4a.75.75 0 0 1 .75-.75zm.75 7a.75.75 0 1 1-1.5 0a.75.75 0 0 1 1.5 0z" fill="currentColor"/></g></svg>`;function uu(e){return lu({dataVote:"report",icon:e.reported?du:mr,title:e.reported?"unreport this post":"report this post",voteCount:e.reports,voteCasted:e.reported,castVote:e.castReportVote?t=>e.castReportVote(t):void 0})}function pu({postOptions:e,bar1:t,bubble:i,bar2:n,buttonBar:a}){var o;return wo`
		<div class=post data-post-id="${null!==(o=e.postId)&&void 0!==o?o:""}">
			<div class=tophat>
				<xio-profile-card .user=${e.author} show-details></xio-profile-card>
			</div>
			<div class="bar bar1">
				${t}
			</div>
			${i}
			<div class="bar bar2">
				${n}
			</div>
			${a?wo`
					<div class=buttonbar>
						${a}
					</div>
				`:null}
		</div>
	`}function hu(e){const{author:t,content:i,timePosted:n,...a}=e;switch(a.type){case ou.Question:{const{liking:t,reporting:o,deletePost:r,toggleAnswerEditor:s}=a;return pu({postOptions:e,bar1:wo`
					${cu(t)}
				`,bubble:nu({content:i,timePosted:n,editable:!1,handleValueChange:void 0}),bar2:wo`
					${uu(o)}
					${r?wo`<a href="#" @click=${au(r)}>delete</a>`:null}
					${s?wo`<a href="#" @click=${au(s)}>answer</a>`:null}
				`,buttonBar:void 0})}case ou.Answer:{const{liking:t,reporting:o,deletePost:r}=a;return pu({postOptions:e,bar1:wo`
					${cu(t)}
				`,bubble:nu({content:i,timePosted:n,editable:!1,handleValueChange:void 0}),bar2:wo`
					${uu(o)}
					${r?wo`<a href="#" @click=${au(r)}>delete</a>`:null}
				`,buttonBar:void 0})}case ou.Editor:{const{isPostable:t,postButtonText:o,changeDraftContent:r,submitPost:s}=a;return pu({postOptions:e,bar1:null,bubble:nu({content:i,timePosted:n,editable:!0,handleValueChange:r}),bar2:null,buttonBar:wo`
					<xio-button
						?disabled=${!t}
						@click=${s}
							>${o}</xio-button>
				`})}}}function mu({now:e,question:t,modals:i,boardModel:n,answerEditor:a}){const{questionId:o}=t,r=n.getAccess(),s=n.getPermissions(),l=n.getUser(t.authorUserId),c=(()=>{const e=!(!r||!r.user)&&r.user.userId===l.userId;return{canDelete:s["moderate questions"]||e,canAnswer:s["answer questions"],canLike:s["like questions"],canReport:s["report questions"]}})(),d=a.state,u=e=>{var t;const i=(null===(t=null==r?void 0:r.user)||void 0===t?void 0:t.userId)===e.authorUserId;return s["moderate questions"]||i};return wo`
		${hu({type:ou.Question,author:l,content:t.content,deletePost:c.canDelete?async()=>{await i.confirm({title:"Delete question?",body:"Are you sure you want to delete this question? This cannot be undone.",yes:{vibe:"negative",label:"Delete question"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2})&&await n.archiveQuestion(o,!0)}:void 0,liking:{liked:t.liked,likes:t.likes,castLikeVote:c.canLike?e=>{n.likeQuestion(o,e)}:void 0},postId:t.questionId,reporting:{reported:t.reported,reports:t.reports,castReportVote:c.canReport?async e=>{(!e||await i.confirm({title:"Report question?",body:"Are you sure you want to submit a report against this question?",yes:{vibe:"negative",label:"Submit report"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2}))&&await n.reportQuestion(o,e)}:void 0},timePosted:t.timePosted,toggleAnswerEditor:c.canAnswer?a.actions.toggleEditMode:void 0})}
		${d.editMode?function({now:e,boardModel:t,answerEditor:i}){const n=i.state;return wo`
		<div class="editor answer-editor">
			<div class=intro>
				<p class=heading>Post your answer</p>
			</div>
			${hu({author:t.getAccess().user,type:ou.Editor,timePosted:e,postButtonText:"post answer",content:n.draftText,isPostable:n.isPostable,submitPost:i.submitAnswer,changeDraftContent:i.actions.handleValueChange})}
		</div>
	`}({now:e,boardModel:n,answerEditor:a}):null}
		${t.answers.length?wo`
			<ol part=answers-list>
				${t.answers.map((e=>wo`
					<li part=answer data-answer-id="${e.answerId}">
						${function({answer:e,questionId:t,modals:i,boardModel:n,canDeleteAnswer:a}){const o=n.getPermissions(),r=o["like questions"],s=o["report questions"];return hu({type:ou.Answer,postId:e.answerId,author:n.getUser(e.authorUserId),content:e.content,timePosted:e.timePosted,liking:{liked:e.liked,likes:e.likes,castLikeVote:r?i=>n.likeAnswer(t,e.answerId,i):void 0},reporting:{reported:e.reported,reports:e.reports,castReportVote:s?async a=>{(!a||await i.confirm({title:"Report answer?",body:"Are you sure you want to submit a report against this answer?",yes:{vibe:"negative",label:"Submit report"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2}))&&await n.reportAnswer(t,e.answerId,a)}:void 0},deletePost:a(e)?async()=>{await i.confirm({title:"Delete answer?",body:"Are you sure you want to delete this answer? This cannot be undone.",yes:{vibe:"negative",label:"Delete answer"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2})&&await n.archiveAnswer(t,e.answerId,!0)}:void 0})}({answer:e,modals:i,questionId:o,boardModel:n,canDeleteAnswer:u})}
					</li>
				`))}
			</ol>
		`:null}
	`}function fu(){const e=ye({editMode:!1,draftText:"",isPostable:!1});return{...e,actions:{toggleEditMode(){e.writable.editMode=!e.writable.editMode},handleValueChange(t){e.writable.draftText=t.detail.value,e.writable.isPostable=!!e.writable.draftText}}}}function bu({requestUpdate:e,getTextInput:t,getBoardModel:i}){const n=fu();n.subscribe(e);return{state:n.readable,actions:n.actions,subscribe:n.subscribe,getTextInput:t,submitQuestion:async()=>{const{draftText:e}=n.readable;t().text="",await i().postQuestion({content:e})}}}function gu({requestUpdate:e,getBoardModel:t,getTextInput:i}){const n=Ol()((n=>{const a=fu();a.subscribe(e);return{state:a.readable,actions:a.actions,subscribe:a.subscribe,submitAnswer:async()=>{const{draftText:e}=a.readable;i(n).text="",a.actions.toggleEditMode(),await t().postAnswer(n,{content:e})}}}));return e=>n(e)}var vu,wu,yu,xu,Iu=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},ku=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i},$u=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};let Su=class extends(function(e){return function(t){var i,n;return n=class extends t{constructor(){super(...arguments),i.set(this,void 0)}tick(){}connectedCallback(){super.connectedCallback(),tr(this,i,setInterval((()=>{this.tick(),this.requestUpdate()}),e),"f")}disconnectedCallback(){super.disconnectedCallback(),clearInterval(ir(this,i,"f"))}},i=new WeakMap,n}}(1e3)(er()(sr))){constructor(){super(...arguments),vu.set(this,void 0),wu.set(this,bu({getBoardModel:()=>$u(this,vu,"f"),requestUpdate:()=>this.requestUpdate(),getTextInput:()=>this.shadowRoot.querySelector(".question-editor xio-text-input")})),yu.set(this,gu({getBoardModel:()=>$u(this,vu,"f"),requestUpdate:()=>this.requestUpdate(),getTextInput:e=>this.shadowRoot.querySelector(`[part="questions-list"] li[data-question-id="${e}"] xio-text-input`)})),xu.set(this,Date.now()),this.board="default"}tick(){ku(this,xu,Date.now(),"f")}init(){ku(this,vu,this.share.questionsModel.makeBoardModel(this.board),"f"),$u(this,vu,"f").loadQuestions()}renderQuestionsBoard(){var e;const t=$u(this,xu,"f"),{modals:i}=this.share,n=$u(this,wu,"f"),{archiveBoard:a}=$u(this,vu,"f"),o=$u(this,vu,"f").getAccess(),r=$u(this,vu,"f").getBoardName(),s=$u(this,vu,"f").getBoardOp(),l=$u(this,vu,"f").getPostingOp(),c=$u(this,vu,"f").getPermissions(),d=function(e,t){const i=[],n=[];for(const a of e)t&&a.authorUserId===t?i.push(a):n.push(a);return[...i.sort(eu),...n.sort(eu)]}($u(this,vu,"f").getQuestions(),null===(e=null==o?void 0:o.user)||void 0===e?void 0:e.userId);return cl(s,(()=>wo`

			${c["moderate questions"]?function({modals:e,board:t,archiveBoard:i}){return wo`
		<div class=questions-moderation-panel>
			<h3>moderate questions board "${t}"</h3>
			<xio-button
				class=purge-button
				@press=${async()=>{await e.confirm({title:"Purge questions?",body:`Are you sure you want to delete all the questions on the board "${t}"? This cannot be undone.`,yes:{vibe:"negative",label:"Purge all"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2})&&await i()}}>
					Purge all questions
			</xio-button>
		</div>
	`}({modals:i,board:r,archiveBoard:a}):null}

			${c["post questions"]?function({now:e,access:t,postingOp:i,questionEditor:n}){const a=null==t?void 0:t.user,o=n.state;return cl(i,(()=>wo`
		<div class="editor question-editor" part=question-editor>
			<div class=intro>
				<p class=heading>Post a new question</p>
			</div>
			${hu({type:ou.Editor,author:a,content:o.draftText,isPostable:o.isPostable,timePosted:e,postButtonText:"post question",submitPost:n.submitQuestion,changeDraftContent:n.actions.handleValueChange})}
		</div>
	`))}({now:t,access:o,postingOp:l,questionEditor:n}):null}

			${d.length>0?wo`
					<ol part=questions-list>
						${d.map((e=>wo`
							<li data-question-id="${e.questionId}">
								${mu({question:e,now:$u(this,xu,"f"),modals:this.share.modals,boardModel:$u(this,vu,"f"),answerEditor:$u(this,yu,"f").call(this,e.questionId)})}
							</li>
						`))}
					</ol>
				`:wo`<slot name=empty><p>Be the first to post a question!</p></slot>`}
		`))}render(){return $u(this,vu,"f")&&$u(this,vu,"f").getBoardOp()?this.renderQuestionsBoard():null}};function Pu({models:e,modals:t}){const{questionsModel:i}=e;return{XiomeQuestions:Jo(i.subscribe)(Zo({modals:t,questionsModel:i})(Su))}}vu=new WeakMap,wu=new WeakMap,yu=new WeakMap,xu=new WeakMap,Iu([Vo({type:String,reflect:!0})],Su.prototype,"board",void 0),Su=Iu([Xo(Jd)],Su);var Au=Ba`

.container {
	display: block;
	width: 100%;
	max-width: 36em;
	padding: 0.5em !important;
	border: 1px solid;
}

.results {
	margin-top: 0.5em;
}

.userlist {
	list-style: none;
}

.userlist > li {
	display: flex;
	flex-direction: column;
	flex-wrap: wrap;
	background: #0002;
	padding: 0.5em;
	margin-top: 0.5em;
}

.userinfo {
	display: flex;
	flex-direction: row;
}

.userinfo xio-profile-card {
	flex: 1 1 auto;
}

.userinfo .controls {
	margin-left: 1em;
}

.userinfo .controls .edit[data-edit-mode] {
	color: lime;
	--xio-button-hover-color: lime;
}

.editwidget > div {
	margin-top: 1em;
}

.editwidget header + * {
	margin-top: 0.25em;
}

.editwidget header small {
	font-size: inherit;
	opacity: 0.6;
}

.editwidget ul {
	list-style: none;
}

.editwidget .allprivileges li {
	display: inline-block;
	font-size: 0.75em;
	padding: 0.1em 0.3em;
	margin: 0.2em 0.1em;
	border: 1px solid;
	border-radius: 1em;
}

`;function Ou(e){return[...e.filter((e=>e.assignable)),...e.filter((e=>!e.assignable))]}function Mu(e,t){return wo`
		<xio-button
			?disabled=${!e.assignable}
			title=${e.roleId}
			data-role-id=${e.roleId}
			@press=${()=>t(e)}>
				${e.label}
		</xio-button>
	`}function Cu(e){return wo`
		<li
			title="${e.privilegeId}"
			data-privilege-id="${e.privilegeId}">
				${e.label}
		</li>
	`}var Eu,_u,Ru=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},Tu=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},Du=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i};let qu=class extends(er()(sr)){constructor(){super(...arguments),this.userResults=re.ready([]),this.updateLocalUserResultsCache={assignRole:(e,t)=>{if(!re.ready(this.userResults))throw new Error("error updating user cache");const i=re.value(this.userResults);this.userResults=re.ready(i.map((i=>i.user.userId===e?{user:i.user,roleIds:[...i.roleIds,t]}:i)))},revokeRole:(e,t)=>{if(!re.ready(this.userResults))throw new Error("error updating user cache");const i=re.value(this.userResults);this.userResults=re.ready(i.map((i=>i.user.userId===e?{user:i.user,roleIds:i.roleIds.filter((e=>e!==t))}:i)))}},this.userStates=function({getUserResultsOp:e,rerender:t}){const i=new Map;return{cleanupObsoleteStates:function(){const t=[],n=e();if(re.ready(n)){const e=re.value(n);for(const n of i.keys())!e.find((({user:e})=>e.userId===n))&&t.push(n)}for(const e of t)i.delete(e)},obtainStateForUser:function(e){let n=i.get(e);if(!n){const a={editMode:!1,toggleEditMode(){a.editMode=!a.editMode,t()}};n=a,i.set(e,n)}return n}}}({getUserResultsOp:()=>this.userResults,rerender:()=>this.requestUpdate()}),Eu.set(this,""),_u.set(this,""),this.commitSearch=async()=>{const e=Tu(this,Eu,"f")===Tu(this,_u,"f");Du(this,_u,Tu(this,Eu,"f"),"f"),e||(this.userResults=re.ready([]),Tu(this,Eu,"f")&&await re.operation({setOp:e=>this.userResults=e,promise:this.share.administrativeModel.searchUsers({term:Tu(this,Eu,"f")})})),this.userStates.cleanupObsoleteStates()},this.commitSearchSoon=he(1e3,this.commitSearch),this.searchChange=e=>{var t;Du(this,Eu,null!==(t=e.detail.value)&&void 0!==t?t:"","f"),this.commitSearchSoon()},this.enterPress=()=>{this.commitSearch()}}init(){this.share.administrativeModel.initialize()}render(){const{permissionsOp:e}=this.share.administrativeModel.state,t=this.share.administrativeModel.isAllowed("administrate user roles"),i=t=>{const{user:i}=t,n=this.userStates.obtainStateForUser(i.userId);return wo`
				<li>
					<div class=userinfo>
						<xio-profile-card
							.user=${i}
							show-details
						></xio-profile-card>
						<div class=controls>
							<xio-button
								class=edit
								?data-edit-mode=${n.editMode}
								@press=${n.toggleEditMode}>
									${zl}
							</xio-button>
						</div>
					</div>
					${n.editMode?cl(e,(e=>function({permissions:e,administrativeModel:t,updateLocalUserResultsCache:i,userResult:{user:{userId:n},roleIds:a},blur:o,search:r}){const s=Ou(a.map((t=>e.roles.find((e=>e.roleId===t)))).filter((e=>!!e))),l=Ou(e.roles.filter((e=>!a.includes(e.roleId))).filter((e=>!!e))),c=e.privileges.filter((t=>{const i=e.rolesHavePrivileges.filter((e=>e.active&&e.privilegeId===t.privilegeId)),n=i.filter((e=>a.includes(e.roleId)));return n.length>0}));async function d(){var e,i;n===(null===(i=null===(e=t.getAccess())||void 0===e?void 0:e.user)||void 0===i?void 0:i.userId)&&await t.reauthorize()}async function u({roleId:e}){await t.assignRoleToUser({userId:n,roleId:e,isPublic:!0,timeframeEnd:void 0,timeframeStart:void 0}),i.assignRole(n,e),o(),await d(),await r()}async function p({roleId:e}){await t.revokeRoleFromUser({userId:n,roleId:e}),i.revokeRole(n,e),o(),await d(),await r()}return wo`
		<div class=editwidget>
			<div class=available>
				<header>roles available <small>(click to assign)</small></header>
				<div>
					${l.map((e=>Mu(e,u)))}
				</div>
			</div>
			<div class=assigned>
				<header>roles assigned <small>(click to revoke)</small></header>
				<div>
					${s.map((e=>Mu(e,p)))}
				</div>
			</div>
			<div class=allprivileges>
				<header>user has these privileges</header>
				<ul>
					${c.map(Cu)}
				</ul>
			</div>
		</div>
	`}({userResult:t,permissions:e,administrativeModel:this.share.administrativeModel,updateLocalUserResultsCache:this.updateLocalUserResultsCache,blur:()=>{const e=document.activeElement;e&&e.blur()},search:()=>this.commitSearch()}))):null}
				</li>
			`};return wo`
			<div class=container>

				${t?wo`
					<xio-text-input
						placeholder="search for users"
						.validator=${fn}
						@valuechange=${this.searchChange}
						@enterpress=${this.enterPress}
					></xio-text-input>

					<div class=results>
						${cl(this.userResults,(e=>e.length>0?wo`
								<ol class=userlist>
									${e.map(i)}
								</ol>
							`:wo`
								<div class=noresults>
									no results
								</div>
							`))}
					</div>
				`:wo`
					<p>you are not permitted to administrate user roles</p>
				`}

			</div>
		`}};function Lu({models:e,modals:t}){const{administrativeModel:i}=e;return{XiomeManageUsers:Jo(i.subscribe)(Zo({modals:t,administrativeModel:i})(qu))}}Eu=new WeakMap,_u=new WeakMap,Ru([Vo()],qu.prototype,"userResults",void 0),qu=Ru([Xo(Au)],qu);var ju,Uu,Nu=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class zu extends(er()(sr)){constructor(){super(...arguments),ju.add(this)}async init(){await Nu(this,ju,"a",Uu).initialize()}renderStripeConnectControls(){const e=Nu(this,ju,"a",Uu).snap.readable,{connectStatusOp:t}=e.stripeConnect,{connectDetailsOp:i}=e.stripeConnect,{isOnboardingNeeded:n,isAllowedToOnboard:a,stripeAccountOnboarding:o,stripeLogin:r}=Nu(this,ju,"a",Uu).connect,s=n&&a;return cl(t,(e=>{const t=re.value(i);function n(){return wo`
					<xio-button @press=${r}>
						Login to Stripe
					</xio-button>
					${s?wo`
							<xio-button @press=${o}>
								Onboard Stripe Account
							</xio-button>
						`:null}
				`}function a(){return wo`
					<p>details:</p>
					<ul>
						<li>charges enabled: ${t.charges_enabled?"true":"false"}</li>
						<li>details submitted: ${t.details_submitted?"true":"false"}</li>
						<li>payouts enabled: ${t.payouts_enabled?"true":"false"}</li>
						<li>email: ${t.email}</li>
						<li>paused: ${t.paused}</li>
						<li>stripe account id: ${t.stripeAccountId}</li>
						<li>time linked: ${t.timeLinked}</li>
					</ul>
				`}switch(e){case et.Unlinked:return wo`
					<p>status: unlinked</p>
					<xio-button @press=${o}>
						Onboard Stripe Account
					</xio-button>
				`;case et.Incomplete:return wo`
					<p>status: incomplete</p>
					${a()}
					${n()}
				`;case et.Paused:return wo`
					<p>status: paused</p>
					${a()}
					${n()}
				`;case et.Ready:return t?wo`
							<p>status: ready</p>
							${a()}
							${n()}
						`:wo`
							<p>status: loading</p>
						`}}))}render(){const{allowance:e}=Nu(this,ju,"a",Uu);return wo`
			<h3>Connect Stripe Account</h3>
			${e.connectStripeAccount?this.renderStripeConnectControls():wo`<p>your account is not allowed to control the linked stripe account</p>`}
		`}}ju=new WeakSet,Uu=function(){return this.share.storeModel};var Bu,Vu,Wu,Hu=Os`
:host {
	display: block;
	width: max-content;
	border-radius: 5px;
}

.billing_area {
	display: flex;
	gap: 1em;
	align-items: center;
}
`,Fu=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},Qu=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};let Xu=class extends(er()(sr)){constructor(){super(...arguments),Bu.add(this)}render(){var e;const{paymentMethodOp:t}=Qu(this,Bu,"a",Vu).billing,{connectStatusOp:i}=Qu(this,Bu,"a",Vu).stripeConnect,n=re.value(i),a=null===(e=Qu(this,Bu,"a",Wu))||void 0===e?void 0:e.cardClues;return cl(re.combine(t,i),(()=>n!==et.Ready?null:wo`
					<div class="billing_area">
						<xiome-store-customer-portal>
							<slot>billing settings</slot>
						</xiome-store-customer-portal>
						${a?wo`
								<div>
									<p>Payment Method</p>
									${a.brand} ${a.last4}
								</div>
							`:null}
					</div>
				`))}};Bu=new WeakSet,Vu=function(){return this.share.storeModel.snap.readable},Wu=function(){return re.value(Qu(this,Bu,"a",Vu).billing.paymentMethodOp)},Xu=Fu([Xo(Hu)],Xu);var Ku,Yu,Gu,Ju,Zu,ep,tp=Os``,ip=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},np=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};let ap=class extends(er()(sr)){constructor(){super(...arguments),Ku.add(this),this.op=re.ready(void 0),Gu.set(this,(async()=>{const{customerPortal:e}=np(this,Ku,"a",Yu).billing;await re.operation({promise:e(),setOp:e=>this.op=e})}))}async init(){await np(this,Ku,"a",Yu).initialize()}render(){const{accessOp:e}=np(this,Ku,"a",Yu).state.user,{connectStatusOp:t}=np(this,Ku,"a",Yu).state.stripeConnect,i=re.combine(e,t,this.op);return wo`
			${cl(i,(()=>{const{userLoggedIn:e,storeActive:t}=np(this,Ku,"a",Yu).get.is;return e?t?np(this,Ku,"m",Ju).call(this):np(this,Ku,"m",Zu).call(this):np(this,Ku,"m",ep).call(this)}))}
		`}};Gu=new WeakMap,Ku=new WeakSet,Yu=function(){return this.share.storeModel},Ju=function(){return wo`
			<xio-button @press=${np(this,Gu,"f")}>
				<slot>
					billing panel
				</slot>
			</xio-button>
		`},Zu=function(){return wo`
			<slot name="not-ready"></slot>
		`},ep=function(){return wo`
			<slot name="logged-out"></slot>
		`},ip([Vo()],ap.prototype,"op",void 0),ap=ip([Xo(tp)],ap);const op={currency:"usd",interval:"month",price:0,stripePriceId:"FAKE_STRIPE_PRICE_ID"},rp={basics:{tier:{active:!0,label:"Example Tier",pricing:[op],roleId:"FAKE_ROLE_ID",tierId:"FAKE_TIER_ID",time:Date.now()},pricing:op},context:{isSubscribedToThisTier:!0,status:tt.Active}};var sp,lp=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},cp=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i};function dp(e,t){var i,n,a,o,r,s;return s=class extends No{constructor(){var e;super(...arguments),i.set(this,0),n.set(this,0),a.set(this,new Map),o.set(this,new Set),r.set(this,{element:this,...(e=this,{attr:{string:new Proxy({},{get:(t,i)=>e.getAttribute(i),set:(t,i,n)=>(e.setAttribute(i,n.toString()),!0)}),boolean:new Proxy({},{get:(t,i)=>e.hasAttribute(i),set:(t,i,n)=>(n?e.setAttribute(i,""):e.removeAttribute(i),!0)})}}),setup:e=>{if(0===lp(this,i,"f")){const t=e(this);t&&lp(this,o,"f").add(t)}},state:e=>{const t=lp(this,n,"f");let i;cp(this,n,lp(this,n,"f")+1,"f");return lp(this,a,"f").has(t)?i=lp(this,a,"f").get(t):(i="function"==typeof e?e(this):e,lp(this,a,"f").set(t,i)),[i,e=>{lp(this,a,"f").set(t,e),this.requestUpdate()}]}})}disconnectedCallback(){for(const e of lp(this,o,"f"))e();lp(this,o,"f").clear(),cp(this,i,0,"f"),super.disconnectedCallback()}createRenderRoot(){var t;if(null===(t=e.shadow)||void 0===t||t)return super.createRenderRoot();{const t=document.createElement("style");t.textContent=e.styles.cssText;const i=document.createElement("div");return this.appendChild(t),this.appendChild(i),i}}render(){cp(this,n,0,"f");const e=t(lp(this,r,"f"));return cp(this,i,lp(this,i,"f")+1,"f"),e}},i=new WeakMap,n=new WeakMap,a=new WeakMap,o=new WeakMap,r=new WeakMap,s.styles=e.styles,s.properties=e.properties,s}function up(e){return e?Math.round(100*parseFloat(e)):void 0}function pp(e){return(e/100).toFixed(2)}!function(e){e[e.Buy=0]="Buy",e[e.Upgrade=1]="Upgrade",e[e.Downgrade=2]="Downgrade",e[e.Pay=3]="Pay",e[e.Cancel=4]="Cancel",e[e.Renew=5]="Renew"}(sp||(sp={}));const hp=dp({styles:Os`

:host {
	max-width: max-content;

	display: flex;
	flex-direction: column;
	justify-content: space-between;

	font: inherit;
	color: inherit;

	border: 1px solid;
	border-radius: 3px;
}

:host > div {
	padding: 0.5em;
}

[part~="tier_details"] {
	position: relative;

	text-align: center;
	flex-basis: 50%;

	[part~="tier_label"] {
		font-size: 1.5em;
	}

	[part~="tier_icon"] {
		position: absolute;
		top: -0.75em;
		right: -0.75em;
		width: 1.5em;
		height: 1.5em;
		padding: 0.2em;
		border-radius: 1em;
		background: currentColor;
		svg, [part~="tier_icon_content"] {
			width: 100%;
			height: 100%;
		}
		[part~="tier_icon_content"] { color: blue; }
		^[data-icon="check"] [part~="tier_icon_content"] { color: green; }
		^[data-icon="x"] [part~="tier_icon_content"] { color: red; }
		^[data-icon="warning"] [part~="tier_icon_content"] { color: orange; }
	}
}

[part~="tier_info"] {
	display: flex;
	flex-basis: 50%;
	align-items: center;
	flex-direction: column;
	justify-content: flex-end;
	gap: 0.2rem;
	background: #fff2;

	[part~="tier_button"] {
		padding: 0.3rem;
		border: 1px solid;
		border-radius: 5px;
		cursor: pointer;
		color: inherit;
		background: transparent;
		opacity: 0.7;

		^:is(:hover, :focus) {
			opacity: 1;
		}
	}
}

`,shadow:!0,properties:{basics:{type:Object},context:{type:Object},interactivity:{type:Object}}},(e=>{const{basics:{tier:t,pricing:i}=rp.basics,context:{status:n,isSubscribedToThisTier:a}=rp.context,interactivity:o}=e.element,r="month"===(null==i?void 0:i.interval)?"monthly":"yearly",s=function(e){switch(e){case tt.Unsubscribed:return;case tt.Active:return{name:"check",svg:ts};case tt.Unpaid:return{name:"warning",svg:mr};case tt.Cancelled:return{name:"x",svg:Nc}}}(n),l=function(e){switch(e){case tt.Unsubscribed:return"unsubscribed";case tt.Active:return"active";case tt.Unpaid:return"unpaid";case tt.Cancelled:return"cancelled"}}(n);return e.attr.string["data-tier"]=t.tierId,e.attr.string["data-status"]=l,e.attr.boolean["data-subscribed"]=a,wo`
		<div part=tier_details>
			${s?wo`
						<div part=tier_icon data-icon="${s.name}">
							<div part=tier_icon_content>
								${s.svg}
							</div>
						</div>
					`:null}
			<h4 part=tier_label>${t.label}</h4>
			<slot></slot>
			${i?wo`
					<xio-price-display
						unit-superscript
						value="${pp(i.price)}">
							${t.label}
					</xio-price-display>
					<p>${r}</p>
				`:wo`
					<p style="color: red">price not set</p>
				`}
		</div>

		<div part=tier_info>
			${n!==tt.Unsubscribed?wo`<span part=tier_status>${l}</span>`:void 0}
			${o?function(){const e=function(e){switch(e){case sp.Buy:return"buy";case sp.Downgrade:return"downgrade";case sp.Upgrade:return"upgrade";case sp.Pay:return"pay";case sp.Cancel:return"cancel";case sp.Renew:return"renew"}}(o.button);return wo`
			<button part="${t="tier_button",`${t} ${t}_${e}`}" @click=${o.action}>
				${e}
			</button>
		`;var t}():void 0}
		</div>
	`}));var mp,fp,bp,gp,vp,wp,yp,xp=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},Ip=function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i};class kp{constructor(e,t=(()=>{})){mp.add(this),fp.set(this,void 0),bp.set(this,new Map),gp.set(this,void 0),vp.set(this,new Set),wp.set(this,(()=>{})),Ip(this,fp,e,"f"),Ip(this,wp,t,"f"),Ip(this,gp,new MutationObserver((()=>xp(this,mp,"m",yp).call(this))),"f"),xp(this,gp,"f").observe(e,kp.parentObservationOptions),xp(this,mp,"m",yp).call(this)}get(e){const t=e?`:scope > template[slot="${e}"]`:":scope > template:not([slot])",i=xp(this,fp,"f").querySelector(t);return null==i?void 0:i.content.cloneNode(!0)}}function $p({tier:e,plan:t,subscription:i}){var n;const{tierId:a}=e,o=t.tiers.findIndex((e=>e.tierId===a)),r=i&&t.tiers.findIndex((e=>e.tierId===i.tierId)),s=!!i&&o===r,l=s&&null!==(n=null==i?void 0:i.status)&&void 0!==n?n:tt.Unsubscribed,c=i&&!s&&i.status===tt.Unpaid;return{subscription:i,status:l,tierIndex:o,subscribedTierIndex:r,isSubscribedToThisTier:s,isAnotherTierInPlanUnpaid:c}}fp=new WeakMap,bp=new WeakMap,gp=new WeakMap,vp=new WeakMap,wp=new WeakMap,mp=new WeakSet,yp=function e(){var t;for(const e of xp(this,vp,"f"))e.disconnect();xp(this,bp,"f").clear(),xp(this,vp,"f").clear();const i=Array.from(xp(this,fp,"f").querySelectorAll(":scope > template"));for(const n of i){const i=null!==(t=n.getAttribute("slot"))&&void 0!==t?t:void 0;xp(this,bp,"f").set(i,n);const a=new MutationObserver(xp(this,wp,"f")),o=new MutationObserver((()=>{xp(this,mp,"m",e).call(this),xp(this,wp,"f").call(this)}));a.observe(n.content,kp.templateDeepObserverationOptions),o.observe(n,kp.templateAttributeObserverationOptions),xp(this,vp,"f").add(a)}},kp.parentObservationOptions={childList:!0},kp.templateDeepObserverationOptions={childList:!0,attributes:!0,characterData:!0,subtree:!0},kp.templateAttributeObserverationOptions={attributes:!0};var Sp=Os`

[data-card-list] {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	gap: 1em;
}

[data-card] {
	display: flex;
	flex-direction: column;
	gap: 0.5em;
}

`;function Pp(e,t){e.setup((()=>t.subscribe((()=>e.element.requestUpdate()))))}const Ap=({storeModel:e})=>dp({styles:Sp,shadow:!1,properties:{}},(t=>{Pp(t,e.snap);const[i]=t.state((()=>new kp(t.element,(()=>t.element.requestUpdate())))),{stripeConnect:{connectStatusOp:n},subscriptions:{subscriptionPlansOp:a,mySubscriptionDetailsOp:o}}=e.state;return cl(re.combine(a,o,n),(()=>wo`
		<div data-card-list>
			${function(e){var t;return(null!==(t=e.get.subscriptions.mySubscriptionDetails)&&void 0!==t?t:[]).map((t=>{const i=e.get.subscriptions.plans.find((e=>e.planId===t.planId)),n=i.tiers.find((e=>e.tierId===t.tierId));return{plan:i,tier:n,subscription:t,pricing:t.pricing}}))}(e).map((e=>wo`
				<div data-card>
					<strong data-plan-label>${e.plan.label}</strong>
					<xiome-store-subscription-tier
						.basics=${e}
						.context=${$p(e)}>
							${i.get(e.tier.tierId)}
					</xiome-store-subscription-tier>
				</div>
			`))}
		</div>
	`))}));function Op({basics:{tier:e},context:{subscription:t,status:i,tierIndex:n,subscribedTierIndex:a,isAnotherTierInPlanUnpaid:o},modals:r,storeModel:s,setOp:l}){const{tierId:c}=e,{paymentMethod:d}=s.get.billing;switch(i){case tt.Unsubscribed:{const i=t?a>n?sp.Downgrade:sp.Upgrade:sp.Buy;if(o)return;return{button:i,async action(){const n=function({modals:e,button:t,tier:i,storeModel:n}){const{subscriptions:a}=n,{stripePriceId:o}=i.pricing[0];return{upgradeOrDowngrade:async()=>{const n=t===sp.Upgrade?"upgrade":"downgrade";await e.confirmAction({title:t===sp.Upgrade?"upgrade subscription":"downgrade subscription",message:`are you sure you want to ${n} your subscription to ${i.label} for $${pp(i.pricing[0].price)}/month?`,loadingMessage:`switching to ${i.label}`,actionWhenConfirmed:()=>a.purchase({stripePriceId:o,showLoadingSpinner:!0})})},buySubscriptionWithCheckoutPopup:async()=>{await a.purchase({stripePriceId:o})},buySubscriptionWithExistingPaymentMethod:async()=>{await e.confirmAction({title:"buy subscription",message:`are you sure you want to buy ${i.label} for $${pp(i.pricing[0].price)}/month?`,actionWhenConfirmed:()=>a.purchase({stripePriceId:o}),loadingMessage:"purchasing subscription"})}}}({button:i,modals:r,storeModel:s,tier:e});switch(Gn({hasDefaultPaymentMethod:!!d,hasExistingSubscription:!!t})){case it.Update:return n.upgradeOrDowngrade();case it.UsePaymentMethod:return n.buySubscriptionWithExistingPaymentMethod();case it.CheckoutPopup:return re.operation({setOp:l,promise:n.buySubscriptionWithCheckoutPopup()});default:throw new Error("unknown purchase scenario")}}}}case tt.Active:return{button:sp.Cancel,action:async()=>r.confirmAction({title:"Cancel subscription",message:`are you sure you want to cancel your ${e.label} subscription`,loadingMessage:"cancelling subscription",actionWhenConfirmed:()=>s.subscriptions.cancel(c)})};case tt.Unpaid:return{button:sp.Pay,action:async()=>re.operation({promise:s.billing.customerPortal(),setOp:l})};case tt.Cancelled:return{button:sp.Renew,action:async()=>await r.confirmAction({title:"Renew subscription",message:`are you sure you want to renew your ${e.label} subscription for $${pp(e.pricing[0].price)}/month?`,loadingMessage:"renewing subscription",actionWhenConfirmed:()=>s.subscriptions.uncancel(c)})};default:throw new Error("unknown subscription status")}}function Mp(e){return t=>wo`
		<li data-plan=${t.planId} data-plan>
			<h3 data-plan-label>${t.label}</h3>
			<div data-tiers>
				${t.tiers.filter((e=>e.active)).map((i=>function(e,t,i){const{slots:n,modals:a,storeModel:o,setOp:r}=e,{mySubscriptionDetails:s}=o.get.subscriptions,l=s.find((e=>e.planId===t.planId)),c={plan:t,tier:i,subscription:l,pricing:i.pricing&&i.pricing[0]},d=$p(c),u=Op({basics:c,context:d,modals:a,storeModel:o,setOp:r});return c.pricing?wo`
			<xiome-store-subscription-tier
				.basics=${c}
				.context=${d}
				.interactivity=${u}>
					${n.get(i.tierId)}
			</xiome-store-subscription-tier>
		`:null}(e,t,i)))}
			</div>
		</li>
	`}var Cp=Os`xiome-store-subscription-catalog {

:is(ol, ul) {
	list-style: none;
}

[data-plans] > li {
	margin-top: 1em;
}

[data-tiers] {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	gap: 0.5em;
	align-items: stretch;
	> span {
		display: block;
	}
	> * {
		max-width: 100%;
	}
}

[data-plan-label] {
	font-size: 1em;
	padding-bottom: 0.2em;
}

}`;const Ep=({modals:e,storeModel:t})=>dp({styles:Cp,shadow:!1,properties:{plans:{type:String}}},(i=>{var n;t.initialize(),Pp(i,t.snap);const a=function(e){const[t]=e.state((()=>new kp(e.element,(()=>e.element.requestUpdate()))));return t}(i),[o,r]=i.state(re.ready(void 0)),s=function(e){var t,i;return[...null!==(i=null===(t=null!=e?e:"")||void 0===t?void 0:t.match(/(\w+)/g))&&void 0!==i?i:[]]}(i.element.plans),l=(null!==(n=t.get.subscriptions.plans)&&void 0!==n?n:[]).filter(function(e){return t=>!(e.length>0)||e.includes(t.planId)}(s)).filter((e=>!e.archived)).filter((e=>e.tiers.length>0)).filter((e=>e.tiers.some((e=>e.active)))).filter((e=>e.tiers.some((e=>!!e.pricing))));return cl(re.combine(o,t.state.subscriptions.subscriptionPlansOp,t.state.subscriptions.mySubscriptionDetailsOp),(()=>wo`
			<ol data-plans>
				${l.map(Mp({modals:e,storeModel:t,slots:a,setOp:r}))}
			</ol>
		`))}));function _p(e,t=document){return t.querySelector(e)}function Rp(e){return{currency:"usd",interval:"month",price:up(e)}}function Tp({storeModel:e,componentSnap:t,getShadowRoot:i}){const n={store:e.snap.readable,component:t.state},a={newPlan(){const e=i(),t={planlabel:_p('.plandraft xio-text-input[data-field="planlabel"]',e),tierlabel:_p('.plandraft xio-text-input[data-field="tierlabel"]',e),tierprice:_p('.plandraft xio-price-input[data-field="tierprice"]',e)},a={planLabel:t.planlabel.value,tier:{label:t.tierlabel.value,pricing:Rp(t.tierprice.value)}},o=la(a);return n.component.draftNewPlan.problems=o,{draft:a,problems:o}},newTier(){const e=i(),t={label:_p('.tierdraft xio-text-input[data-field="tierlabel"]',e),price:_p('.tierdraft xio-price-input[data-field="tierprice"]',e)},a={label:t.label.value,pricing:Rp(t.price.value)},o=sa(a);return n.component.draftNewTier.problems=o,{draft:a,problems:o}},editedPlan(e){const t=i(),a={label:_p('.planediting [data-field="label"]',t),archived:_p('.planediting [data-field="archived"]',t)},o={planId:e.planId,label:a.label.value,archived:a.archived.checked},r=ca(o),s=o.label!==e.label||o.archived!==e.archived;return n.component.editingPlanDraft.isChanged=s,n.component.editingPlanDraft.problems=r,{draft:o,problems:r,isChanged:s}},editedTier(e){const t=e.pricing?e.pricing[0]:{stripePriceId:"",currency:"usd",interval:"month",price:up("")},a=i(),o={label:_p('.tierediting [data-field="label"]',a),active:_p('.tierediting [data-field="active"]',a),price:_p('.tierediting [data-field="price"]',a)},r={tierId:e.tierId,label:o.label.value,active:o.active.checked,pricing:Rp(o.price.value)},s=da(r),l=r.label!==e.label||r.active!==e.active||function(e,t){for(const i of[t.price!==e.price,t.currency!==e.currency,t.interval!==e.interval])if(i)return!0;return!1}(t,r.pricing);return n.component.editingTierDraft.isChanged=l,n.component.editingTierDraft.problems=s,{draft:r,problems:s,isChanged:l}}},o={newPlan:{toggleDraftPanel(){n.component.draftNewPlan=n.component.draftNewPlan?void 0:{loading:!1,problems:["cannot be empty"]}},async submit(){const{draft:t,problems:i}=a.newPlan();if(0===i.length)try{n.component.draftNewPlan.loading=!0,await e.subscriptions.addPlan(t)}finally{n.component.draftNewPlan=void 0}}},newTier:{toggleDraftPanel(e){n.component.draftNewTier=n.component.draftNewTier?void 0:{planId:e,loading:!1,problems:[]}},async submit(t){const{draft:i,problems:o}=a.newTier();if(0===o.length)try{n.component.draftNewTier.loading=!0,await e.subscriptions.addTier({...i,planId:t})}finally{n.component.draftNewTier=void 0}}},planEditing:{handleEditButtonPress(e){var t;const i=(null===(t=n.component.editingPlanDraft)||void 0===t?void 0:t.planId)===e.planId;n.component.editingPlanDraft=i?void 0:{isChanged:!1,loading:!1,planId:e.planId,problems:[]}},async submit(t){const{draft:i,problems:o}=a.editedPlan(t);if(0===o.length)try{n.component.editingPlanDraft.loading=!0,await e.subscriptions.editPlan(i)}finally{n.component.editingPlanDraft=void 0}}},tierEditing:{handleEditButtonPress(e,t){var i;const a=(null===(i=n.component.editingTierDraft)||void 0===i?void 0:i.tierId)===t.tierId;n.component.editingTierDraft=a?void 0:{isChanged:!1,loading:!1,planId:e.planId,tierId:t.tierId,problems:[]}},async submit(t,i){const{draft:o,problems:r}=a.editedTier(i);if(0===r.length)try{n.component.editingTierDraft.loading=!0,await e.subscriptions.editTier({planId:t.planId,tierId:i.tierId,label:o.label,active:o.active,pricing:o.pricing})}finally{n.component.editingTierDraft=void 0}}}},r={valuechange:a.newPlan},s={valuechange:a.newTier};function l(e,t){var i,r;const s=(null===(i=n.component.editingTierDraft)||void 0===i?void 0:i.tierId)===t.tierId,l=null===(r=n.component.editingTierDraft)||void 0===r?void 0:r.loading,c=!!t.pricing,d=c?pp(t.pricing[0].price):"";return wo`
			<li data-tier="${t.tierId}">
				<xio-button
					@press=${()=>o.tierEditing.handleEditButtonPress(e,t)}>
						edit tier
				</xio-button>
				<div class=tierdetails>
					${s?wo`
						<div
							class=tierediting
							@valuechange=${()=>a.editedTier(t)}
							@change=${()=>a.editedTier(t)}>
							<xio-text-input
								data-field="label"
								?disabled=${l}
								.text="${t.label}"
								.validator=${ta}>
									tier label
							</xio-text-input>
							<xio-price-input
								data-field="price"
								.validator=${ea}
								initial-value=${d}>
									Price</xio-price-input>
							<label>
								active:
								<input
									type=checkbox
									data-field="active"
									?disabled=${l}
									?checked=${t.active} />
							</label>
							${n.component.editingTierDraft.isChanged?wo`
									<xio-button
										?disabled=${l||!!n.component.editingTierDraft.problems.length}
										@press=${()=>o.tierEditing.submit(e,t)}>
										save tier
									</xio-button>
								`:null}
						</div>
					`:wo`
						<p class=label>tier label: ${t.label}</p>
						${c?wo`<p>price: $${pp(t.pricing[0].price)}</p>`:wo`<p style="color: red">price not set</p>`}
						<p>active: ${t.active?"true":"false"}</p>
					`}
				</div>
				<p>tier id: <xio-id id="${t.tierId}"></xio-id></p>
				<p>role id: <xio-id id="${t.roleId}"></xio-id></p>
				<p>created: ${rl(t.time).full}</p>
			</li>
		`}function c(e,t){var i,r,c;const d=(null===(i=n.component.editingPlanDraft)||void 0===i?void 0:i.planId)===e.planId,u=null===(r=n.component.editingPlanDraft)||void 0===r?void 0:r.loading,p=[],h=[];for(const t of e.tiers)t.active?p.push(t):h.push(t);return wo`
			<li data-plan="${e.planId}">
				<xio-button
					class=editplan
					@press=${()=>o.planEditing.handleEditButtonPress(e)}>
						edit plan
				</xio-button>
				<div class=plandetails>
					${d?wo`
						<div class=planediting
							@change=${()=>a.editedPlan(e)}
							@valuechange=${()=>a.editedPlan(e)}>
								<xio-text-input
									data-field="label"
									?disabled=${u}
									.text="${e.label}"
									.validator=${ta}>
										plan label
								</xio-text-input>
								<label>
									archived:
									<input
										type=checkbox
										data-field="archived"
										?disabled=${u}
										?checked=${e.archived} />
								</label>
								${n.component.editingPlanDraft.isChanged?wo`
										<xio-button
											?disabled=${u||!!n.component.editingPlanDraft.problems.length}
											@press=${()=>o.planEditing.submit(e)}>
												save plan
										</xio-button>
									`:null}
						</div>
					`:wo`
						<p class=label>plan label: ${e.label}</p>
						<p>archived: ${e.archived?"true":"false"}</p>
					`}
				</div>
				<p>plan id: <xio-id id="${e.planId}"></xio-id></p>
				<p>created: ${rl(e.time).full}</p>
				<h3 class=tiersheading>tiers</h3>
				<xio-button class=addtier @click=${()=>o.newTier.toggleDraftPanel(e.planId)}>
					+ add tier
				</xio-button>
				${(null===(c=n.component.draftNewTier)||void 0===c?void 0:c.planId)===e.planId?function(e){const{loading:t,problems:i}=n.component.draftNewTier;return wo`
			<div class=tierdraft @valuechange=${s.valuechange}>
				<xio-text-input
					data-field=tierlabel
					?disabled=${t}
					.validator=${ta}>
						tier label</xio-text-input>
				<xio-price-input
					data-field=tierprice
					.validator=${ea}>
						tier price</xio-price-input>
				<xio-button
					?disabled=${t||i.length}
					@click=${()=>o.newTier.submit(e)}>
						submit new tier</xio-button>
			</div>
		`}(e.planId):null}
				<ol>
					${p.map((t=>l(e,t)))}
				</ol>
				${h.length?wo`
						<details>
							<summary>inactive tiers</summary>
							<ol>
								${h.map((t=>l(e,t)))}
							</ol>
						</details>
					`:null}
			</li>
		`}return{renderPlanning:function(){const{subscriptionPlansOp:e}=n.store.subscriptions;return cl(e,(e=>{const t=[],i=[];for(const n of e)n.archived?i.push(n):t.push(n);return wo`
				<xio-button class=addplan @click=${o.newPlan.toggleDraftPanel}>
					+ add plan
				</xio-button>
				${n.component.draftNewPlan?function(){const{loading:e,problems:t}=n.component.draftNewPlan;return wo`
			<div class=plandraft @valuechange=${r.valuechange}>
				<xio-text-input
					data-field=planlabel
					?disabled=${e}
					.validator=${ta}>
						plan label</xio-text-input>
				<xio-text-input
					data-field=tierlabel
					?disabled=${e}
					.validator=${ta}>
						tier label</xio-text-input>
				<xio-price-input
					data-field=tierprice
					.validator=${ea}>
						tier price</xio-price-input>
				<xio-button
					?disabled=${e||t.length}
					@click=${o.newPlan.submit}>
						Submit new plan</xio-button>
			</div>
		`}():null}
				<ol>
					${t.map(c)}
				</ol>
				${i.length?wo`
						<details>
							<summary>archived plans</summary>
							<ol>
								${i.map(c)}
							</ol>
						</details>
					`:null}
			`}))}}}var Dp,qp,Lp,jp,Up=Os`

ul, ol {
	list-style: none;
}

.plandraft {
	> * {
		display: block;
		margin-top: 0.5em;
	}
}

[data-plan] {
	border: 1px solid;
	padding: 1em;
	margin-top: 1em;

	.editplan {
		margin-bottom: 1em;
	}

	.plandetails {
		margin-bottom: 1em;
	}

	.planediting > * + * {
		display: block;
		margin-top: 0.5em;
	}

	details {
		border: 1px dashed;
		padding: 0.5em;
		margin-top: 0.5em;
	}
	
	summary {
		font-size: 1.2em;
	}
	
	.tiersheading {
		margin-top: 1em;
	}
	
	.addtier {
		margin-top: 1em;
	}
	
	.tierdraft > * {
		display: block;
		margin-top: 0.5em;
	}
}

[data-tier] {
	border: 1px solid;
	padding: 1em;
	margin-top: 1em;

	.tierdetails {
		margin: 1em 0;
	}

	.tierediting > * {
		display: block;
		margin-top: 0.5em;
	}
}

[data-field="label"], .label {
	font-weight: bold;
}

`,Np=function(e,t,i,n){var a,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,i,r):a(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},zp=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};let Bp=class extends(er()(sr)){constructor(){super(...arguments),Dp.add(this),qp.set(this,ye({draftNewPlan:void 0,draftNewTier:void 0,editingPlanDraft:void 0,editingTierDraft:void 0})),jp.set(this,Tp({storeModel:zp(this,Dp,"a",Lp),componentSnap:zp(this,qp,"f"),getShadowRoot:()=>this.shadowRoot}))}async init(){this.addSubscription((()=>zp(this,qp,"f").subscribe((()=>this.requestUpdate())))),await zp(this,Dp,"a",Lp).initialize()}render(){const{snap:e,allowance:t}=zp(this,Dp,"a",Lp),i=e.readable,n=re.value(i.stripeConnect.connectStatusOp);return wo`
			${n===et.Ready?t.manageStore?zp(this,jp,"f").renderPlanning():wo`<p>your account does not have permissions to manage the store</p>`:wo`<p>store is not active</p>`}
		`}};function Vp({models:e,modals:t}){const{storeModel:i}=e;return{XiomeStoreConnect:Jo(i.snap.subscribe)(Zo({modals:t,storeModel:i})(zu)),XiomeStoreSubscriptionPlanning:Jo(i.snap.subscribe)(Zo({modals:t,storeModel:i})(Bp)),XiomeStoreSubscriptionTier:hp,XiomeStoreSubscriptionCatalog:Ep({modals:t,storeModel:i}),XiomeStoreCustomerPortal:Jo(i.snap.subscribe)(Zo({storeModel:i})(ap)),XiomeStoreSubscriptionStatus:Ap({storeModel:i}),XiomeStoreBillingArea:Jo(i.snap.subscribe)(Zo({storeModel:i})(Xu))}}function Wp(e){return((e,t)=>Vt(t,(t=>Xo(e)(t))))(lr,{XioId:pr,XioOp:gr,XioMenu:Ur,XioAvatar:Hr,XioButton:Kr,XioExample:Jr,XioCheckbox:ns,XioMenuItem:Pr,XioTextInput:ds,XioPriceInput:Bs,XioNightlight:tl,XioProfileCard:hl,XioPriceDisplay:Il,...Gd(e),...rc(e),...Pu(e),...Lu(e),...Qd(e),...Dc(e),...ad(e),...Vp(e)})}function Hp(e){return async({title:t,input:i,body:n=null,yes:a={label:"okay",vibe:"positive"},no:o={label:"nevermind",vibe:"neutral"},focusNthElement:r=1,blanketClickMeansCancel:s=!0})=>new Promise((l=>{var c;const d=document.createElement("xio-text-input");function u(){return d.value,0!==d.problems.length}function p(e){return{yes:()=>{const t=u()?void 0:{value:d.value};u()||(e.close(),l(t))},no:()=>{e.close(),l(void 0)}}}d.textarea=null!==(c=i.textarea)&&void 0!==c&&c,d.parser=i.parser,d.validator=i.validator,d.textContent=i.label;const{controls:h,modal:m}=e({focusNthElement:r,onBlanketClick:s?e=>{e.close(),l(void 0)}:()=>{},renderContent:e=>{const i=p(e);return wo`
					<div data-confirm>
						${"string"==typeof t?wo`<h2>${t}</h2>`:t}
						${"string"==typeof n?wo`<p>${n}</p>`:n}
						${d}
						<div data-buttons>
							<xio-button
								data-button=yes
								data-vibe=${a.vibe}
								?disabled=${u()}
								@press=${i.yes}>
									${a.label}
							</xio-button>
							<xio-button
								data-button=no
								data-vibe=${o.vibe}
								@press=${i.no}>
									${o.label}
							</xio-button>
						</div>
					</div>
				`}}),f=p(h);d.onvaluechange=()=>h.rerender(),d.onenterpress=()=>f.yes(),m.addEventListener("keyup",(({key:e})=>{"Escape"===e&&f.no()}))}))}qp=new WeakMap,jp=new WeakMap,Dp=new WeakSet,Lp=function(){return this.share.storeModel},Bp=Np([Xo(Up)],Bp);var Fp=Ba`

*:focus {
	outline: var(--focus-outline);
}

[data-modal-system] {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	display: block;
}

[data-modal-system] [data-blanket] {
	z-index: 101;
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	display: block;
	background: #0008;
	backdrop-filter: blur(10px);
}

[data-modal-system] [data-plate] {
	z-index: 102;
	position: absolute;
	top: 0;
	left: 0;
	right: 0;

	width: 96%;
	max-width: 32em;
	min-height: 1em;
	margin: 2em auto;

	background: linear-gradient(to bottom right, #fff, #ccc);
	color: #444;
}

[data-modal-system] [data-plate] h2 {
	padding: 0 1rem;
	margin: 1rem auto;
}

[data-modal-system] [data-content]:focus {
	outline: unset;
}

[data-modal-system] [data-confirm] {
	padding: 0 1rem;
	margin: 1rem auto;
}

[data-modal-system] [data-buttons] {
	margin-top: 1rem;
	text-align: right;
}

[data-modal-system] [data-button] {
	--xio-button-hover-color: white;
	--xio-button-hover-background: #666;
}

[data-modal-system] [data-vibe=positive] {
	color: green;
	--xio-button-hover-color: white;
	--xio-button-hover-background: green;
}

[data-modal-system] [data-vibe=negative] {
	color: #a00;
	--xio-button-hover-color: white;
	--xio-button-hover-background: #a00;
}

`;function Qp(e){return async({title:t,body:i=null,button:n={label:"ok",vibe:"neutral"},focusNthElement:a=1,blanketClickMeansNo:o=!0})=>{await e({title:t,body:i,blanketClickMeansNo:o,yes:n,no:null})}}function Xp(){let e=0;const t=new Map,{rerender:i,element:n}=function(e){const t=document.createElement("style");Lo(Fp,t);const i=document.createElement("div");return i.setAttribute("data-modal-system",""),{element:i,rerender:function(){Lo(wo`
			${t}
			${e().map((e=>e.render()))}
		`,i)}}}((()=>Array.from(t.values())));function a({focusNthElement:a,renderContent:o,onBlanketClick:r}){var s,l,c;const d=e++,u={rerender:i,close:()=>{t.delete(d),i()}},p=null!==(c=null!==(l=null!==(s=window.pageYOffset)&&void 0!==s?s:document.documentElement.scrollTop)&&void 0!==l?l:document.body.scrollTop)&&void 0!==c?c:0,h=()=>r(u);t.set(d,{render:()=>wo`
					<div data-modal="${d}">
						<div data-blanket @click=${h}></div>
						<div data-plate style="top: ${p}px">
							${o(u)}
						</div>
					</div>
				`}),i();const m=n.querySelector(`[data-modal="${d}"]`);return function(e,t){const i='\n\t\t[focusable]:not([disabled])\n\t\t[tabindex]:not([disabled])\n\t\ta[href]:not([disabled])\n\t\tbutton:not([disabled])\n\t\ttextarea:not([disabled])\n\t\tinput[type="text"]:not([disabled])\n\t\tinput[type="radio"]:not([disabled])\n\t\tinput[type="checkbox"]:not([disabled])\n\t\tselect:not([disabled])\n\t'.split("\n").map((e=>e.trim())).filter((e=>e.length)).join(", "),n=Array.from(e.querySelectorAll(i));if(0===n.length)throw new Error("cannot trap focus: no focusable element");const a=n[0],o=n[n.length-1],r=n[t-1];setTimeout((()=>r.focus()),0),e.onkeydown=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===a&&(o.focus(),e.preventDefault()):document.activeElement===o&&(a.focus(),e.preventDefault()))}}(m,a),{controls:u,modal:m}}const o=function(e){return async({title:t,body:i=null,yes:n={label:"yes",vibe:"positive"},no:a={label:"no",vibe:"neutral"},focusNthElement:o=1,blanketClickMeansNo:r=!0})=>new Promise((s=>{e({focusNthElement:o,onBlanketClick:r?e=>{e.close(),s(!1)}:()=>{},renderContent:e=>wo`
					<div data-confirm>
						${"string"==typeof t?wo`<h2>${t}</h2>`:t}
						${"string"==typeof i?wo`<p>${i}</p>`:i}
						<div data-buttons>
							<xio-button
								focusable
								data-button=yes
								data-vibe="${n.vibe}"
								@press=${()=>{e.close(),s(!0)}}>
									${n.label}
							</xio-button>
							${a?wo`
								<xio-button
									focusable
									data-button=no
									data-vibe="${a.vibe}"
									@press=${()=>{e.close(),s(!1)}}>
										${a.label}
								</xio-button>
							`:null}
						</div>
					</div>
				`})}))}(a),r=function(e){return async({title:t,message:i,loadingMessage:n,cancelButtonLabel:a="no",confirmButtonLabel:o="yes",actionWhenConfirmed:r})=>{let s=re.ready(void 0);function l(e){s=e,c.controls.rerender()}const c=e({focusNthElement:1,renderContent:e=>{const c=re.isError(s);return wo`
					<h2>${t}</h2>
					${cl(s,(()=>wo`
							<div data-confirm>
								${i}
								<div data-buttons>
									<xio-button
										focusable
										data-button=yes
										data-vibe="positive"
										@press=${async()=>{await re.operation({promise:r(),setOp:l}),e.close()}}>
											${o}
									</xio-button>
									<xio-button
										focusable
										data-button=no
										data-vibe="neutral"
										@press=${e.close}>
											${a}
									</xio-button>
								</div>
							</div>
						`),null,{loadingMessage:n})}
					${c?wo`
						<div data-buttons>
							<xio-button
								focusable
								data-button=no
								data-vibe="neutral"
								@press=${e.close}>
									ok
							</xio-button>
						</div>
						`:null}
				`},onBlanketClick:e=>{re.isLoading(s)||e.close()}})}}(a);return{modalsElement:n,modals:{popup:a,confirm:o,confirmAction:r,alert:Qp(o),prompt:Hp(a)}}}async function Kp({link:e,accessModel:t,onDone:i,onError:n}){const{hash:a}=new URL(e),{login:o}=function(e=location.search){const t={},i=(e=(e=e.startsWith("?")?e.slice(1):e).startsWith("#")?e.slice(1):e).split("&");for(const e of i){const[i,...n]=e.split("="),a=n.join("=");t[decodeURIComponent(i)]=decodeURIComponent(a)}return t}(a);if(o){try{await t.login(o)}catch(e){n(e)}i()}else try{await t.useExistingLogin()}catch(e){console.error("error with xiome login:",e)}}!async function(){const e=window.location.href,t=window.location.origin,i=await Da({root:"",appWindowLink:e,appOrigin:t,origins:[t],storage:h()});await async function({appOrigin:e,connection:t}){const{asMockPerson:i}=await async function({appOrigin:e,connection:{appId:t,backend:{emails:i,mockBrowser:n}}}){return{async asMockPerson(a,o){const r=await n({appOrigin:e}),s=await r.mockAppWindow({appId:t}),{accessModel:l}=s.models,{loginService:c}=s.remote.auth.users;i.disableEmails(),await c.sendLoginLink({email:a});const{loginToken:d}=i.recallLatestLoginEmail();await l.login(d),await o(s),await l.logout(),i.enableEmails()}}}({appOrigin:e,connection:t});let n;await i("a@xiome.io",(async e=>{const t=e.models.questionsModel.makeBoardModel("default"),i=await t.postQuestion({content:"How much wood would a woodchuck chuck if a woodchuck could chuck wood?"});n=i.questionId,await t.likeQuestion(n,!0)})),await i("creative@xiome.io",(async e=>{const t=e.models.questionsModel.makeBoardModel("default");await t.loadQuestions(),await t.likeQuestion(n,!0),await t.postAnswer(n,{content:"Researchers say,\nApproximately 700 pounds of wood."})}))}({appOrigin:t,connection:i}),i.setMockLatency({min:200,max:800});const n=await async function({appId:e,storage:t,authMediator:i,remote:n,stripePopups:a,chatConnect:o}){const{modals:r,modalsElement:s}=Xp(),l=await st({appId:e,remote:n,storage:t,authMediator:i,stripePopups:a,chatConnect:o}),c=Wp({models:l,modals:r});return await Kp({accessModel:l.accessModel,link:window.location.toString(),onError:e=>{e instanceof Je?r.alert({title:"expired login link",body:"this login link has expired, please try again"}):r.alert({title:"invalid login link",body:"something is wrong with this login link, please try again"})},onDone:()=>{window.location.hash=""}}),{appId:e,components:c,models:l,modals:r,modalsElement:s}}(i);D({connection:i,frontend:n});const a={...i,...n};document.body.prepend(a.modalsElement),await a.models.accessModel.sendLoginLink("creative@xiome.io");const o={};for(const[e,t]of Object.entries(a.components))o[`Demo${e}`]=t;!function(e){for(const[t,i]of Object.entries(e))customElements.define(t.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase(),i)}(o)}()}();